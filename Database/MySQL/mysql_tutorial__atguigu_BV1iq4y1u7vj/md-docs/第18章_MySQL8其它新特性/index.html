
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="entrycoder的软件开发记事本">
      
      
        <meta name="author" content="entrycoder">
      
      
      
        <link rel="prev" href="../%E7%AC%AC17%E7%AB%A0_%E8%A7%A6%E5%8F%91%E5%99%A8/">
      
      
        <link rel="next" href="../%E7%AC%AC19%E7%AB%A0_%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.15">
    
    
      
        <title>第18章_MySQL8其它新特性 - entrycoder的软件开发记事本</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../mkdocs/css/no-footer.css">
    
      <link rel="stylesheet" href="../../../../../mkdocs/css/unordered-list-symbols.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#18-_mysql-8" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="entrycoder的软件开发记事本" class="md-header__button md-logo" aria-label="entrycoder的软件开发记事本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            entrycoder的软件开发记事本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第18章_MySQL8其它新特性
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../Environment/" class="md-tabs__link">
        系统环境
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../" class="md-tabs__link md-tabs__link--active">
        数据库
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        关于
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="entrycoder的软件开发记事本" class="md-nav__button md-logo" aria-label="entrycoder的软件开发记事本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    entrycoder的软件开发记事本
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../Environment/">系统环境</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          系统环境
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_2" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
          前端
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          前端
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Environment/front_end/vue_on_kylin/" class="md-nav__link">
        在Kylin上安装VUE-CLI等
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../">数据库</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          RDBMS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          RDBMS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" checked>
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
          MySQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2_1">
          <span class="md-nav__icon md-icon"></span>
          MySQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1_1" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2_1_1" id="__nav_2_2_1_1_label" tabindex="0">
          MySQ教程 尚硅谷
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_1_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2_1_1">
          <span class="md-nav__icon md-icon"></span>
          MySQ教程 尚硅谷
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BD%9C%E8%80%85%E7%9A%84%E8%AF%9D/" class="md-nav__link">
        作者的话
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BF%AE%E6%94%B9%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        修改记录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../%E7%9B%AE%E5%BD%95/" class="md-nav__link">
        目录
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1_1_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2_1_1_4" id="__nav_2_2_1_1_4_label" tabindex="0">
          文档-基础篇
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_2_1_1_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2_1_1_4">
          <span class="md-nav__icon md-icon"></span>
          文档-基础篇
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC00%E7%AB%A0_%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2/" class="md-nav__link">
        第00章_写在前面
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC01%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        第01章_数据库概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC02%E7%AB%A0_MySQL%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        第02章_MySQL环境搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC03%E7%AB%A0_%E5%9F%BA%E6%9C%AC%E7%9A%84SELECT%E8%AF%AD%E5%8F%A5/" class="md-nav__link">
        第03章_基本的SELECT语句
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC04%E7%AB%A0_%E8%BF%90%E7%AE%97%E7%AC%A6/" class="md-nav__link">
        第04章_运算符
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC05%E7%AB%A0_%E6%8E%92%E5%BA%8F%E4%B8%8E%E5%88%86%E9%A1%B5/" class="md-nav__link">
        第05章_排序与分页
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC06%E7%AB%A0_%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        第06章_多表查询
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC07%E7%AB%A0_%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0/" class="md-nav__link">
        第07章_单行函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC08%E7%AB%A0_%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0/" class="md-nav__link">
        第08章_聚合函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC09%E7%AB%A0_%E5%AD%90%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        第09章_子查询
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC10%E7%AB%A0_%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8/" class="md-nav__link">
        第10章_创建和管理表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B9%8B%E5%A2%9E%E5%88%A0%E6%94%B9/" class="md-nav__link">
        第11章_数据处理之增删改
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC12%E7%AB%A0_MySQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%B2%BE%E8%AE%B2/" class="md-nav__link">
        第12章_MySQL数据类型精讲
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC13%E7%AB%A0_%E7%BA%A6%E6%9D%9F/" class="md-nav__link">
        第13章_约束
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC14%E7%AB%A0_%E8%A7%86%E5%9B%BE/" class="md-nav__link">
        第14章_视图
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC15%E7%AB%A0_%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E5%87%BD%E6%95%B0/" class="md-nav__link">
        第15章_存储过程与函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC16%E7%AB%A0_%E5%8F%98%E9%87%8F%E3%80%81%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E4%B8%8E%E6%B8%B8%E6%A0%87/" class="md-nav__link">
        第16章_变量、流程控制与游标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC17%E7%AB%A0_%E8%A7%A6%E5%8F%91%E5%99%A8/" class="md-nav__link">
        第17章_触发器
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          第18章_MySQL8其它新特性
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        第18章_MySQL8其它新特性
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    讲师：尚硅谷-宋红康（江湖人称：康师傅）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#httpwwwatguigucom" class="md-nav__link">
    官网： http://www.atguigu.com
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-mysql-8" class="md-nav__link">
    1. MySQL 8 新特性概述
  </a>
  
    <nav class="md-nav" aria-label="1. MySQL 8 新特性概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql5780mysql-8" class="md-nav__link">
    MySQL从5.7版本直接跳跃发布了8.0版本，可见这是一个令人兴奋的里程碑版本。MySQL 8版本在功能上
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmysql-optimizer" class="md-nav__link">
    做了显著的改进与增强，开发者对MySQL的源代码进行了重构，最突出的一点是多MySQL Optimizer优化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    器进行了改进。不仅在速度上得到了改善，还为用户带来了更好的性能和更棒的体验。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-1-mysql-8-0" class="md-nav__link">
    1. 1 MySQL 8. 0 新增特性
  </a>
  
    <nav class="md-nav" aria-label="1. 1 MySQL 8. 0 新增特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-nosql-nosql" class="md-nav__link">
    1. 更简便的NoSQL支持 NoSQL泛指非关系型数据库和数据存储。随着互联网平台的规模飞速发展，传统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56mysqlnosql" class="md-nav__link">
    的关系型数据库已经越来越不能满足需求。从5.6版本开始，MySQL就开始支持简单的NoSQL存储功能。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-8nosqlschema" class="md-nav__link">
    MySQL 8对这一功能做了优化，以更灵活的方式实现NoSQL功能，不再依赖模式（schema）。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mysql-8" class="md-nav__link">
    2. 更好的索引 在查询中，正确地使用索引可以提高查询的效率。MySQL 8中新增了隐藏索引和降序索
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    引。隐藏索引可以用来测试去掉索引对查询性能的影响。在查询中混合存在多列索引时，使用降序索引
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    可以提高查询的性能。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-json-mysql57jsonmysql-8" class="md-nav__link">
    3 .更完善的JSON支持 MySQL从5.7开始支持原生JSON数据的存储，MySQL 8对这一功能做了优化，增加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json_arrayaggjson_objectaggjson" class="md-nav__link">
    了聚合函数JSON_ARRAYAGG()和JSON_OBJECTAGG()，将参数聚合为JSON数组或对象，新增了行内
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-jsonjson" class="md-nav__link">
    操作符 -&gt;&gt;，是列路径运算符 -&gt;的增强，对JSON排序做了提升，并优化了JSON的更新操作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-mysql-8caching_sha2_password-fips" class="md-nav__link">
    4 .安全和账户管理 MySQL 8中新增了caching_sha2_password 授权插件、角色、密码历史记录和FIPS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    模式支持，这些特性提高了数据库的安全性和性能，使数据库管理员能够更灵活地进行账户管理工作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-innodb-innodbmysql" class="md-nav__link">
    5 .InnoDB的变化 InnoDB是MySQL默认的存储引擎，是事务型数据库的首选引擎，支持事务安全表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acidmysql-8-innodb" class="md-nav__link">
    （ACID），支持行锁定和外键。在MySQL 8 版本中，InnoDB在自增、索引、加密、死锁、共享锁等方面
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ddl" class="md-nav__link">
    做了大量的改进和优化，并且支持原子数据定义语言（DDL），提高了数据安全性，对事务提供更好的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    支持。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-mysqlmysql-8" class="md-nav__link">
    6 .数据字典 在之前的MySQL版本中，字典数据都存储在元数据文件和非事务表中。从MySQL 8开始新增
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    了事务数据字典，在这个字典里存储着数据库对象信息，这些数据字典存储在内部事务表中。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-mysql-8automic-ddlddl" class="md-nav__link">
    7. 原子数据定义语句 MySQL 8开始支持原子数据定义语句（Automic DDL），即原子DDL。目前，只有
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#innodbddlddlddl" class="md-nav__link">
    InnoDB存储引擎支持原子DDL。原子数据定义语句（DDL）将与DDL操作相关的数据字典更新、存储引擎
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    操作、二进制日志写入结合到一个单独的原子事务中，这使得即使服务器崩溃，事务也会提交或回滚。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop-tablecreate-tablealter-table" class="md-nav__link">
    使用支持原子操作的存储引擎所创建的表，在执行DROP TABLE、CREATE TABLE、ALTER TABLE、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rename-tabletruncate-tablecreate-tablespacedrop-tablespace" class="md-nav__link">
    RENAME TABLE、TRUNCATE TABLE、CREATE TABLESPACE、DROP TABLESPACE等操作时，都支持原子操
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-57mysql-8" class="md-nav__link">
    作，即事务要么完全操作成功，要么失败后回滚，不再进行部分提交。 对于从MySQL 5.7复制到MySQL 8
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-existsif-not-exists" class="md-nav__link">
    版本中的语句，可以添加IF EXISTS或IF NOT EXISTS语句来避免发生错误。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-mysql-8" class="md-nav__link">
    8 .资源管理 MySQL 8开始支持创建和管理资源组，允许将服务器内运行的线程分配给特定的分组，以便
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    线程根据组内可用资源执行。组属性能够控制组内资源，启用或限制组内资源消耗。数据库管理员能够
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpucpu" class="md-nav__link">
    根据不同的工作负载适当地更改这些属性。 目前，CPU时间是可控资源，由“虚拟CPU”这个概念来表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpucpu_1" class="md-nav__link">
    示，此术语包含CPU的核心数，超线程，硬件线程等等。服务器在启动时确定可用的虚拟CPU数量。拥有
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpu-mysql" class="md-nav__link">
    对应权限的数据库管理员可以将这些CPU与资源组关联，并为资源组分配线程。 资源组组件为MySQL中
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlmysql" class="md-nav__link">
    的资源组管理提供了SQL接口。资源组的属性用于定义资源组。MySQL中存在两个默认组，系统组和用户
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    组，默认的组不能被删除，其属性也不能被更改。对于用户自定义的组，资源组创建时可初始化所有的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    属性，除去名字和类型，其他属性都可在创建之后进行更改。 在一些平台下，或进行了某些MySQL的配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macos" class="md-nav__link">
    置时，资源管理的功能将受到限制，甚至不可用。例如，如果安装了线程池插件，或者使用的是macOS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freebsdsolarislinux" class="md-nav__link">
    系统，资源管理将处于不可用状态。在FreeBSD和Solaris系统中，资源线程优先级将失效。在Linux系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cap_sys_nice" class="md-nav__link">
    中，只有配置了CAP_SYS_NICE属性，资源管理优先级才能发挥作用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-mysql-8latin1utf8mb4" class="md-nav__link">
    9 .字符集支持 MySQL 8中默认的字符集由latin1更改为utf8mb4，并首次增加了日语所特定使用的集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utf8mb4_ja_0900_as_cs" class="md-nav__link">
    合，utf8mb4_ja_0900_as_cs。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-mysql" class="md-nav__link">
    10 .优化器增强 MySQL优化器开始支持隐藏索引和降序索引。隐藏索引不会被优化器使用，验证索引的必
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    要性时不需要删除索引，先将索引隐藏，如果优化器性能无影响就可以真正地删除索引。降序索引允许
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    优化器对多个列进行排序，并且允许排序顺序不一致。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-common-table-expressionsctemysql" class="md-nav__link">
    11 .公用表表达式 公用表表达式（Common Table Expressions）简称为CTE，MySQL现在支持递归和非递
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ctecteselectwith" class="md-nav__link">
    归两种形式的CTE。CTE通过在SELECT语句或其他特定语句前使用WITH语句对临时结果集进行命名。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    基础语法如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subquerywithcte_name" class="md-nav__link">
    Subquery代表子查询，子查询前使用WITH语句将结果集命名为cte_name，在后续的查询中即可使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cte_name" class="md-nav__link">
    cte_name进行查询。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-mysql-8mysql-8" class="md-nav__link">
    12 .窗口函数 MySQL 8开始支持窗口函数。在之前的版本中已存在的大部分聚合函数在MySQL 8中也可以
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    作为窗口函数来使用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-mysql804unicode" class="md-nav__link">
    13 .正则表达式支持 MySQL在8.0.4以后的版本中采用支持Unicode的国际化组件库实现正则表达式操作，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unicodemysqlregexp_like" class="md-nav__link">
    这种方式不仅能提供完全的Unicode支持，而且是多字节安全编码。MySQL增加了REGEXP_LIKE()、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#egexp_instrregexp_replace-regexp_substrregexp_stack_limit" class="md-nav__link">
    EGEXP_INSTR()、REGEXP_REPLACE()和 REGEXP_SUBSTR()等函数来提升性能。另外，regexp_stack_limit和
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regexp_time_limit" class="md-nav__link">
    regexp_time_limit 系统变量能够通过匹配引擎来控制资源消耗。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-temptablememorytemptable" class="md-nav__link">
    14 .内部临时表 TempTable存储引擎取代MEMORY存储引擎成为内部临时表的默认存储引擎。TempTable存储
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#varcharvarbinaryinternal_tmp_mem_storage_engine" class="md-nav__link">
    引擎为VARCHAR和VARBINARY列提供高效存储。internal_tmp_mem_storage_engine会话变量定义了内部
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temptablememorytemptable" class="md-nav__link">
    临时表的存储引擎，可选的值有两个，TempTable和MEMORY，其中TempTable为默认的存储引擎。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temptable_max_ramtemptable" class="md-nav__link">
    temptable_max_ram系统配置项定义了TempTable存储引擎可使用的最大内存数量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-mysql-8mysql" class="md-nav__link">
    15 .日志记录 在MySQL 8中错误日志子系统由一系列MySQL组件构成。这些组件的构成由系统变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log_error_services" class="md-nav__link">
    log_error_services来配置，能够实现日志事件的过滤和写入。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16" class="md-nav__link">
    16 .备份锁 新的备份锁允许在线备份期间执行数据操作语句，同时阻止可能造成快照不一致的操作。新
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-instance-for-backup-unlock-instance" class="md-nav__link">
    备份锁由 LOCK INSTANCE FOR BACKUP 和 UNLOCK INSTANCE 语法提供支持，执行这些操作需要备份管理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    员特权。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-mysql-mysql-8json" class="md-nav__link">
    17 .增强的MySQL复制 MySQL 8复制支持对JSON文档进行部分更新的二进制日志记录，该记录使用紧凑
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    的二进制格式，从而节省记录完整JSON文档的空间。当使用基于语句的日志记录时，这种紧凑的日志记
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binlog_row_value_optionspartial_json" class="md-nav__link">
    录会自动完成，并且可以通过将新的binlog_row_value_options系统变量值设置为PARTIAL_JSON来启用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-mysql-8-0" class="md-nav__link">
    1. 2 MySQL 8. 0 移除的旧特性
  </a>
  
    <nav class="md-nav" aria-label="1. 2 MySQL 8. 0 移除的旧特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql-57mysql80" class="md-nav__link">
    在MySQL 5.7版本上开发的应用程序如果使用了MySQL8.0 移除的特性，语句可能会失败，或者产生不同
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    的执行结果。为了避免这些问题，对于使用了移除特性的应用，应当尽力修正避免使用这些特性，并尽
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    可能使用替代方法。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-1-flush-query-cachereset-query" class="md-nav__link">
    1. 查询缓存 查询缓存已被移除，删除的项有： （ 1 ）语句： FLUSH QUERY CACHE和RESET QUERY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-2-query_cache_limitquery_cache_min_res_unitquery_cache_size" class="md-nav__link">
    CACHE。 （ 2 ）系统变量： query_cache_limit、query_cache_min_res_unit、query_cache_size、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query_cache_typequery_cache_wlock_invalidate-3-qcache_free_blocks" class="md-nav__link">
    query_cache_type、query_cache_wlock_invalidate。 （ 3 ）状态变量： Qcache_free_blocks、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcache_free_memoryqcache_hitsqcache_insertsqcache_lowmem_prunesqcache_not_cached" class="md-nav__link">
    Qcache_free_memory、Qcache_hits、Qcache_inserts、Qcache_lowmem_prunes、Qcache_not_cached、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcache_queries_in_cacheqcache_total_blocks-4-checking-privileges-on-cached" class="md-nav__link">
    Qcache_queries_in_cache、Qcache_total_blocks。 （ 4 ）线程状态： checking privileges on cached
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#querychecking-query-cache-for-queryinvalidating-query-cache-entriessending-cached-result-to" class="md-nav__link">
    query、checking query cache for query、invalidating query cache entries、sending cached result to
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clientstoring-result-in-query-cachewaiting-for-query-cache-lock" class="md-nav__link">
    client、storing result in query cache、waiting for query cache lock。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-encodedecodeencryptdes_encrypt" class="md-nav__link">
    2 .加密相关 删除的加密相关的内容有：ENCODE()、DECODE()、ENCRYPT()、DES_ENCRYPT()和
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#des_decryptdes-key-filehave_cryptflushdes_key_file" class="md-nav__link">
    DES_DECRYPT()函数，配置项des-key-file，系统变量have_crypt，FLUSH语句的DES_KEY_FILE选项，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#have_crypt-cmake-encryptsha2" class="md-nav__link">
    HAVE_CRYPT CMake选项。 对于移除的ENCRYPT()函数，考虑使用SHA2()替代，对于其他移除的函数，使
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aes_encryptaes_decrypt" class="md-nav__link">
    用AES_ENCRYPT()和AES_DECRYPT()替代。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-mysql-57mysql-8" class="md-nav__link">
    3 .空间函数相关 在MySQL 5.7版本中，多个空间函数已被标记为过时。这些过时函数在MySQL 8中都已被
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#st_mbr" class="md-nav__link">
    移除，只保留了对应的ST_和MBR函数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-nnull-sqlnnullsqlnulln" class="md-nav__link">
    4 .\N和NULL 在SQL语句中，解析器不再将\N视为NULL，所以在SQL语句中应使用NULL代替\N。这项变化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-data-infileselectinto-outfilenull" class="md-nav__link">
    不会影响使用LOAD DATA INFILE或者SELECT...INTO OUTFILE操作文件的导入和导出。在这类操作中，NULL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n" class="md-nav__link">
    仍等同于\N。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-mysql_install_db-mysqlmysql_install_db-" class="md-nav__link">
    5. mysql_install_db 在MySQL分布中，已移除了mysql_install_db程序，数据字典初始化需要调用带着--
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialize-initialize-insecuremysqld-bootstrapinstall_scriptdir" class="md-nav__link">
    initialize或者--initialize-insecure选项的mysqld来代替实现。另外，--bootstrap和INSTALL_SCRIPTDIR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cmake" class="md-nav__link">
    CMake也已被删除。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-mysql" class="md-nav__link">
    6 .通用分区处理程序 通用分区处理程序已从MySQL服务中被移除。为了实现给定表分区，表所使用的存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlinnodbndb" class="md-nav__link">
    储引擎需要自有的分区处理程序。 提供本地分区支持的MySQL存储引擎有两个，即InnoDB和NDB，而在
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-8innodb" class="md-nav__link">
    MySQL 8中只支持InnoDB。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-information_schema" class="md-nav__link">
    7 .系统和状态变量信息 在INFORMATION_SCHEMA数据库中，对系统和状态变量信息不再进行维护。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global_variablessession_variablesglobal_statussession_status" class="md-nav__link">
    GLOBAL_VARIABLES、SESSION_VARIABLES、GLOBAL_STATUS、SESSION_STATUS表都已被删除。另外，系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show_compatibility_56slave_heartbeat_period" class="md-nav__link">
    统变量show_compatibility_56也已被删除。被删除的状态变量有Slave_heartbeat_period、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slave_last_heartbeatslave_received_heartbeatsslave_retried_transactionsslave_running" class="md-nav__link">
    Slave_last_heartbeat,Slave_received_heartbeats、Slave_retried_transactions、Slave_running。以上被删除
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    的内容都可使用性能模式中对应的内容进行替代。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-mysql_plugin-mysql_pluginmysql-plugin-load-" class="md-nav__link">
    8 .mysql_plugin工具 mysql_plugin工具用来配置MySQL服务器插件，现已被删除，可使用--plugin-load或-
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-plugin-load-addinstall-plugin" class="md-nav__link">
    -plugin-load-add选项在服务器启动时加载插件或者在运行时使用INSTALL PLUGIN语句加载插件来替代该
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    工具。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-1" class="md-nav__link">
    2. 新特性 1 ：窗口函数
  </a>
  
    <nav class="md-nav" aria-label="2. 新特性 1 ：窗口函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-1_1" class="md-nav__link">
    2. 1 使用窗口函数前后对比
  </a>
  
    <nav class="md-nav" aria-label="2. 1 使用窗口函数前后对比">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    假设我现在有这样一个数据表，它显示了某购物网站在每个城市每个区的销售额：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    查询：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    需求： 现在计算这个网站在每个城市的销售总额、在全国的销售总额、每个区的销售额占所在城市销售
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    额中的比率，以及占总销售额中的比率。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    如果用分组和聚合函数，就需要分好几步来计算。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a" class="md-nav__link">
    第一步，计算总销售金额，并存入临时表 a：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a_1" class="md-nav__link">
    查看一下临时表 a ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b" class="md-nav__link">
    第二步，计算每个城市的销售总额并存入临时表 b：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b_1" class="md-nav__link">
    查看临时表 b ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    第三步，计算各区的销售占所在城市的总计金额的比例，和占全部销售总计金额的比例。我们可以通过
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    下面的连接查询获得需要的结果：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    结果显示：市销售金额、市销售占比、总销售金额、总销售占比都计算出来了。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    同样的查询，如果用窗口函数，就简单多了。我们可以用下面的代码来实现：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    结果显示，我们得到了与上面那种查询同样的结果。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    使用窗口函数，只用了一步就完成了查询。而且，由于没有用到临时表，执行的效率也更高了。很显
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    然， 在这种需要用到分组统计的结果对每一条记录进行计算的场景下，使用窗口函数更好 。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2" class="md-nav__link">
    2. 2 窗口函数分类
  </a>
  
    <nav class="md-nav" aria-label="2. 2 窗口函数分类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql-8-0" class="md-nav__link">
    MySQL从 8. 0 版本开始支持窗口函数。窗口函数的作用类似于在查询中对数据进行分组，不同的是，分组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    操作会把分组的结果聚合成一条记录，而窗口函数是将结果置于每一条数据记录中。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    窗口函数可以分为静态窗口函数和动态窗口函数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    静态窗口函数的窗口大小是固定的，不会因为记录的不同而不同；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    动态窗口函数的窗口大小会随着记录的不同而变化。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-httpsdevmysqlcomdocrefman80enwindow-function-descriptio" class="md-nav__link">
    MySQL官方网站窗口函数的网址为 https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nshtmlfunction_row-number" class="md-nav__link">
    ns.html#function_row-number 。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    窗口函数总体上可以分为序号函数、分布函数、前后函数、首尾函数和其他函数，如下表：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3" class="md-nav__link">
    2. 3 语法结构
  </a>
  
    <nav class="md-nav" aria-label="2. 3 语法结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    窗口函数的语法结构是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    或者是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#over" class="md-nav__link">
    OVER 关键字指定函数窗口的范围。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    如果省略后面括号中的内容，则窗口会包含满足WHERE条件的所有记录，窗口函数会基于所
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where_1" class="md-nav__link">
    有满足WHERE条件的记录进行计算。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#over_1" class="md-nav__link">
    如果OVER关键字后面的括号不为空，则可以使用如下语法设置窗口。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    窗口名：为窗口设置一个别名，用来标识窗口。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partition-by" class="md-nav__link">
    PARTITION BY子句：指定窗口函数按照哪些字段进行分组。分组后，窗口函数可以在每个分组中分
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    别执行。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-by" class="md-nav__link">
    ORDER BY子句：指定窗口函数按照哪些字段进行排序。执行排序操作使窗口函数按照排序后的数据
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    记录的顺序进行编号。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frame" class="md-nav__link">
    FRAME子句：为分区中的某个子集定义规则，可以用来作为滑动窗口使用。
  </a>
  
    <nav class="md-nav" aria-label="FRAME子句：为分区中的某个子集定义规则，可以用来作为滑动窗口使用。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overpartition-by-order-by-ascdesc" class="md-nav__link">
    函数 OVER（[PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC]）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#over-window-as-partition-by-order-by-ascdesc" class="md-nav__link">
    函数 OVER 窗口名 ... WINDOW 窗口名 AS （[PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC]）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4" class="md-nav__link">
    2. 4 分类讲解
  </a>
  
    <nav class="md-nav" aria-label="2. 4 分类讲解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    创建表：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    添加数据：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods" class="md-nav__link">
    下面针对goods表中的数据来验证每个窗口函数的功能。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 序号函数
  </a>
  
    <nav class="md-nav" aria-label="1. 序号函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-row_number" class="md-nav__link">
    1 ．ROW_NUMBER()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#row_number" class="md-nav__link">
    ROW_NUMBER()函数能够对数据中的序号进行顺序显示。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods_1" class="md-nav__link">
    举例：查询 goods 数据表中每个商品分类下价格降序排列的各个商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods-3" class="md-nav__link">
    举例：查询 goods 数据表中每个商品分类下价格最高的 3 种商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#89-90" class="md-nav__link">
    在名称为“女装/女士精品”的商品类别中，有两款商品的价格为 89. 90 元，分别是卫衣和牛仔裤。两款商品
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2-3-rankdense_rank" class="md-nav__link">
    的序号都应该为 2 ，而不是一个为 2 ，另一个为 3 。此时，可以使用RANK()函数和DENSE_RANK()函数解
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    决。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-rank" class="md-nav__link">
    2 ．RANK()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank-1-1-3" class="md-nav__link">
    使用RANK()函数能够对序号进行并列排序，并且会跳过重复的序号，比如序号为 1 、 1 、 3 。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank-goods" class="md-nav__link">
    举例：使用RANK()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank-goods-4" class="md-nav__link">
    举例：使用RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的 4 款商品信息。
  </a>
  
    <nav class="md-nav" aria-label="举例：使用RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的 4 款商品信息。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-10-2-39990-3500" class="md-nav__link">
    | 5 | 10 | 2 | 户外运动 | 骑行装备 |  399.90 | 3500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-9-2-5990-1500" class="md-nav__link">
    | 6 | 9 | 2 | 户外运动 | 登山杖 | 59.90 | 1500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_1" class="md-nav__link">
    +---------+----+-------------+---------------+------------+---------+-------+
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank-1-2-2-4" class="md-nav__link">
    可以看到，使用RANK()函数得出的序号为 1 、 2 、 2 、 4 ，相同价格的商品序号相同，后面的商品序号是不
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    连续的，跳过了重复的序号。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-dense_rank" class="md-nav__link">
    3 ．DENSE_RANK()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank-1-1-2" class="md-nav__link">
    DENSE_RANK()函数对序号进行并列排序，并且不会跳过重复的序号，比如序号为 1 、 1 、 2 。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank-goods" class="md-nav__link">
    举例：使用DENSE_RANK()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank-goods-4" class="md-nav__link">
    举例：使用DENSE_RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的 4 款商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank-1-2-2-3" class="md-nav__link">
    可以看到，使用DENSE_RANK()函数得出的行号为 1 、 2 、 2 、 3 ，相同价格的商品序号相同，后面的商品序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    号是连续的，并且没有跳过重复的序号。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 分布函数
  </a>
  
    <nav class="md-nav" aria-label="2. 分布函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-percent_rank" class="md-nav__link">
    1 ．PERCENT_RANK()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#percent_rank" class="md-nav__link">
    PERCENT_RANK()函数是等级值百分比函数。按照如下方式进行计算。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rankrankrows" class="md-nav__link">
    其中，rank的值为使用RANK()函数产生的序号，rows的值为当前窗口的总记录数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods-percent_rank" class="md-nav__link">
    举例：计算 goods 数据表中名称为“女装/女士精品”的类别下的商品的PERCENT_RANK值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-cume_dist" class="md-nav__link">
    2 ．CUME_DIST()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cume_dist" class="md-nav__link">
    CUME_DIST()函数主要用于查询小于或等于某个值的比例。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods_2" class="md-nav__link">
    举例：查询goods数据表中小于或等于当前价格的比例。
  </a>
  
    <nav class="md-nav" aria-label="举例：查询goods数据表中小于或等于当前价格的比例。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-6-1-39990-1200" class="md-nav__link">
    | 1 | 6 | 1 | 女装/女士精品 | 呢绒外套 | 399.90 | 1200 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3-1-8990-1500" class="md-nav__link">
    | 2 | 3 | 1 | 女装/女士精品 | 卫衣 |  89.90 | 1500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4-1-8990-3500" class="md-nav__link">
    | 2 | 4 | 1 | 女装/女士精品 | 牛仔裤 |  89.90 | 3500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-1-7990-2500" class="md-nav__link">
    | 3 | 2 | 1 | 女装/女士精品 | 连衣裙 |  79.90 | 2500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_2" class="md-nav__link">
    +---------+----+-------------+---------------+----------+--------+-------+
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    #写法一：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 前后函数
  </a>
  
    <nav class="md-nav" aria-label="3. 前后函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-lagexprn" class="md-nav__link">
    1 ．LAG(expr,n)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lagexprnnexpr" class="md-nav__link">
    LAG(expr,n)函数返回当前行的前n行的expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods_3" class="md-nav__link">
    举例：查询goods数据表中前一个商品价格与当前商品价格的差值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-leadexprn" class="md-nav__link">
    2 ．LEAD(expr,n)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leadexprnnexpr" class="md-nav__link">
    LEAD(expr,n)函数返回当前行的后n行的expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods_4" class="md-nav__link">
    举例：查询goods数据表中后一个商品价格与当前商品价格的差值。
  </a>
  
    <nav class="md-nav" aria-label="举例：查询goods数据表中后一个商品价格与当前商品价格的差值。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#016666666666666666-5-2990" class="md-nav__link">
    | 0.16666666666666666 | 5 | 女装/女士精品 | 百褶裙 | 29.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#03333333333333333-1-t-3990" class="md-nav__link">
    |  0.3333333333333333 | 1 | 女装/女士精品 | T恤 | 39.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#05-2-7990" class="md-nav__link">
    | 0.5 | 2 | 女装/女士精品 | 连衣裙 | 79.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#08333333333333334-3-8990" class="md-nav__link">
    |  0.8333333333333334 | 3 | 女装/女士精品 | 卫衣 | 89.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#08333333333333334-4-8990" class="md-nav__link">
    |  0.8333333333333334 | 4 | 女装/女士精品 | 牛仔裤 | 89.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-6-39990" class="md-nav__link">
    | 1 | 6 | 女装/女士精品 | 呢绒外套 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#016666666666666666-9-5990" class="md-nav__link">
    | 0.16666666666666666 | 9 | 户外运动 | 登山杖 | 59.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#05-7-39990" class="md-nav__link">
    | 0.5 | 7 | 户外运动 | 自行车 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#05-10-39990" class="md-nav__link">
    | 0.5 | 10 | 户外运动 | 骑行装备 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#06666666666666666-12-49990" class="md-nav__link">
    |  0.6666666666666666 | 12 | 户外运动 | 滑板 |  499.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#08333333333333334-11-79990" class="md-nav__link">
    |  0.8333333333333334 | 11 | 户外运动 | 运动外套 |  799.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-8-139990" class="md-nav__link">
    | 1 | 8 | 户外运动 | 山地自行车 | 1399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_3" class="md-nav__link">
    +---------------------+----+---------------+------------+---------+
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 首尾函数
  </a>
  
    <nav class="md-nav" aria-label="4. 首尾函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-first_valueexpr" class="md-nav__link">
    1 ．FIRST_VALUE(expr)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first_valueexprexpr" class="md-nav__link">
    FIRST_VALUE(expr)函数返回第一个expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    举例：按照价格排序，查询第 1 个商品的价格信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-last_valueexpr" class="md-nav__link">
    2 ．LAST_VALUE(expr)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#last_valueexprexpr" class="md-nav__link">
    LAST_VALUE(expr)函数返回最后一个expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    举例：按照价格排序，查询最后一个商品的价格信息。
  </a>
  
    <nav class="md-nav" aria-label="举例：按照价格排序，查询最后一个商品的价格信息。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-_4" class="md-nav__link">
    +----+---------------+------------+--------------+---------+------------+
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3990-2990-1000" class="md-nav__link">
    | 5 | 女装/女士精品 | 百褶裙 |  39.90 | 29.90 |  10.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-t-7990-3990-4000" class="md-nav__link">
    | 1 | 女装/女士精品 | T恤 |  79.90 | 39.90 |  40.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-8990-7990-1000" class="md-nav__link">
    | 2 | 女装/女士精品 | 连衣裙 |  89.90 | 79.90 |  10.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-8990-8990-000" class="md-nav__link">
    | 3 | 女装/女士精品 | 卫衣 |  89.90 | 89.90 | 0.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-39990-8990-31000" class="md-nav__link">
    | 4 | 女装/女士精品 | 牛仔裤 | 399.90 | 89.90 | 310.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-null-39990-null" class="md-nav__link">
    | 6 | 女装/女士精品 | 呢绒外套 | NULL |  399.90 | NULL |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-39990-5990-34000" class="md-nav__link">
    | 9 | 户外运动 | 登山杖 | 399.90 | 59.90 | 340.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-39990-39990-000" class="md-nav__link">
    | 7 | 户外运动 | 自行车 | 399.90 |  399.90 | 0.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-49990-39990-10000" class="md-nav__link">
    | 10 | 户外运动 | 骑行装备 | 499.90 |  399.90 | 100.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-79990-49990-30000" class="md-nav__link">
    | 12 | 户外运动 | 滑板 | 799.90 |  499.90 | 300.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-139990-79990-60000" class="md-nav__link">
    | 11 | 户外运动 | 运动外套 |  1399.90 |  799.90 | 600.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-null-139990-null" class="md-nav__link">
    | 8 | 户外运动 | 山地自行车 | NULL | 1399.90 | NULL |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_5" class="md-nav__link">
    +----+---------------+------------+--------------+---------+------------+
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 其他函数
  </a>
  
    <nav class="md-nav" aria-label="5. 其他函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-nth_valueexprn" class="md-nav__link">
    1 ．NTH_VALUE(expr,n)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nth_valueexprnnexpr" class="md-nav__link">
    NTH_VALUE(expr,n)函数返回第n个expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods-2-3" class="md-nav__link">
    举例：查询goods数据表中排名第 2 和第 3 的价格信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ntilen" class="md-nav__link">
    2 ．NTILE(n)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntilenn" class="md-nav__link">
    NTILE(n)函数将分区中的有序数据分为n个桶，记录桶编号。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods-3_1" class="md-nav__link">
    举例：将goods表中的商品按照价格分为 3 组。
  </a>
  
    <nav class="md-nav" aria-label="举例：将goods表中的商品按照价格分为 3 组。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-8990-1500-8990" class="md-nav__link">
    | 3 | 女装/女士精品 | 卫衣 | 89.90 | 1500 |  89.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-8990-3500-8990" class="md-nav__link">
    | 4 | 女装/女士精品 | 牛仔裤 | 89.90 | 3500 |  89.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-39990-1200-39990" class="md-nav__link">
    | 6 | 女装/女士精品 | 呢绒外套 |  399.90 | 1200 | 399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-5990-1500-5990" class="md-nav__link">
    | 9 | 户外运动 | 登山杖 | 59.90 | 1500 |  59.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-39990-1000-39990" class="md-nav__link">
    | 7 | 户外运动 | 自行车 |  399.90 | 1000 | 399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-39990-3500-39990" class="md-nav__link">
    | 10 | 户外运动 | 骑行装备 |  399.90 | 3500 | 399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-49990-1200-49990" class="md-nav__link">
    | 12 | 户外运动 | 滑板 |  499.90 | 1200 | 499.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-79990-500-79990" class="md-nav__link">
    | 11 | 户外运动 | 运动外套 |  799.90 | 500 | 799.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-139990-2500-139990" class="md-nav__link">
    | 8 | 户外运动 | 山地自行车 | 1399.90 | 2500 |  1399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_6" class="md-nav__link">
    +----+---------------+------------+---------+-------+------------+
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-5" class="md-nav__link">
    2. 5 小 结
  </a>
  
    <nav class="md-nav" aria-label="2. 5 小 结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    窗口函数的特点是可以分组，而且可以在分组内排序。另外，窗口函数不会因为分组而减少原表中的行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    数，这对我们在原表数据的基础上进行统计和排序非常有用。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-2" class="md-nav__link">
    3. 新特性 2 ：公用表表达式
  </a>
  
    <nav class="md-nav" aria-label="3. 新特性 2 ：公用表表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ctecommon-table-expressionscte" class="md-nav__link">
    公用表表达式（或通用表表达式）简称为CTE（Common Table Expressions）。CTE是一个命名的临时结
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cte" class="md-nav__link">
    果集，作用范围是当前语句。CTE可以理解成一个可以复用的子查询，当然跟子查询还是有点区别的，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ctecte" class="md-nav__link">
    CTE可以引用其他CTE，但子查询不能引用其他子查询。所以，可以考虑代替子查询。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    依据语法结构和执行方式的不同，公用表表达式分为普通公用表表达式和递归公用表表达式 2 种。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-1" class="md-nav__link">
    3. 1 普通公用表表达式
  </a>
  
    <nav class="md-nav" aria-label="3. 1 普通公用表表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    普通公用表表达式的语法结构是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    普通公用表表达式类似于子查询，不过，跟子查询不同的是，它可以被多次引用，而且可以被其他的普
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    通公用表表达式所引用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    举例：查询员工所在的部门的详细信息。
  </a>
  
    <nav class="md-nav" aria-label="举例：查询员工所在的部门的详细信息。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-7-39990" class="md-nav__link">
    | 1 | 7 | 户外运动 | 自行车 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-10-39990" class="md-nav__link">
    | 2 | 10 | 户外运动 | 骑行装备 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-12-49990" class="md-nav__link">
    | 2 | 12 | 户外运动 | 滑板 |  499.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-11-79990" class="md-nav__link">
    | 3 | 11 | 户外运动 | 运动外套 |  799.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-8-139990" class="md-nav__link">
    | 3 | 8 | 户外运动 | 山地自行车 | 1399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_7" class="md-nav__link">
    +----+----+---------------+------------+---------+
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-cte" class="md-nav__link">
    WITH CTE名称
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as" class="md-nav__link">
    AS （子查询）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selectdeleteupdate" class="md-nav__link">
    SELECT|DELETE|UPDATE 语句;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    这个查询也可以用普通公用表表达式的方式完成：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    例子说明，公用表表达式可以起到子查询的作用。以后如果遇到需要使用子查询的场景，你可以在查询
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    之前，先定义公用表表达式，然后在查询中用它来代替子查询。而且，跟子查询相比，公用表表达式有
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    一个优点，就是定义过公用表表达式之后的查询，可以像一个表一样多次引用公用表表达式，而子查询
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    则不能。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2_1" class="md-nav__link">
    3. 2 递归公用表表达式
  </a>
  
    <nav class="md-nav" aria-label="3. 2 递归公用表表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    递归公用表表达式也是一种公用表表达式，只不过，除了普通公用表表达式的特点以外，它还有自己的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    特点，就是 可以调用自己 。它的语法结构是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-union-all" class="md-nav__link">
    递归公用表表达式由 2 部分组成，分别是种子查询和递归查询，中间通过关键字 UNION [ALL]进行连接。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    这里的 种子查询，意思就是获得递归的初始值 。这个查询只会运行一次，以创建初始数据集，之后递归
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    查询会一直执行，直到没有任何新的查询数据产生，递归返回。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#employeesemployee_idlast_namemanager_idab" class="md-nav__link">
    案例： 针对于我们常用的employees表，包含employee_id，last_name和manager_id三个字段。如果a是b
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#babccba" class="md-nav__link">
    的管理者，那么，我们可以把b叫做a的下属，如果同时b又是c的管理者，那么c就是b的下属，是a的下下
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    属。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    下面我们尝试用查询语句列出所有具有下下属身份的人员信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    如果用我们之前学过的知识来解决，会比较复杂，至少要进行 4 次查询才能搞定：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    第一步，先找出初代管理者，就是不以任何别人为管理者的人，把结果存入临时表；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    第二步，找出所有以初代管理者为管理者的人，得到一个下属集，把结果存入临时表；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    第三步，找出所有以下属为管理者的人，得到一个下下属集，把结果存入临时表。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    第四步，找出所有以下下属为管理者的人，得到一个结果集。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    如果第四步的结果集为空，则计算结束，第三步的结果集就是我们需要的下下属集了，否则就必须继续
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    进行第四步，一直到结果集为空为止。比如上面的这个数据表，就需要到第五步，才能得到空结果集。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    而且，最后还要进行第六步：把第三步和第四步的结果集合并，这样才能最终获得我们需要的结果集。
  </a>
  
    <nav class="md-nav" aria-label="而且，最后还要进行第六步：把第三步和第四步的结果集合并，这样才能最终获得我们需要的结果集。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-recursive" class="md-nav__link">
    WITH RECURSIVE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cte-as" class="md-nav__link">
    CTE名称 AS （子查询）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selectdeleteupdate_1" class="md-nav__link">
    SELECT|DELETE|UPDATE 语句;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    如果用递归公用表表达式，就非常简单了。我介绍下具体的思路。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n-1" class="md-nav__link">
    用递归公用表表达式中的种子查询，找出初代管理者。字段 n 表示代次，初始值为 1 ，表示是第一
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    代管理者。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    用递归公用表表达式中的递归查询，查出以这个递归公用表表达式中的人为管理者的人，并且代次
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    的值加 1 。直到没有人以这个递归公用表表达式中的人为管理者了，递归返回。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    在最后的查询中，选出所有代次大于等于 3 的人，他们肯定是第三代及以上代次的下属了，也就是
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    下下属了。这样就得到了我们需要的结果集。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3" class="md-nav__link">
    这里看似也是 3 步，实际上是一个查询的 3 个部分，只需要执行一次就可以了。而且也不需要用临时表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    保存中间结果，比刚刚的方法简单多了。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    代码实现：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    总之，递归公用表表达式对于查询一个有共同的根节点的树形结构数据，非常有用。它可以不受层级的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    限制，轻松查出所有节点的数据。如果用其他的查询方式，就比较复杂了。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3_1" class="md-nav__link">
    3. 3 小 结
  </a>
  
    <nav class="md-nav" aria-label="3. 3 小 结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    公用表表达式的作用是可以替代子查询，而且可以被多次引用。递归公用表表达式对查询有一个共同根
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    节点的树形结构数据非常高效，可以轻松搞定其他查询方式难以处理的查询。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC19%E7%AB%A0_%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E/" class="md-nav__link">
        第19章_写在最后
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../..">关于</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          关于
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    讲师：尚硅谷-宋红康（江湖人称：康师傅）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#httpwwwatguigucom" class="md-nav__link">
    官网： http://www.atguigu.com
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-mysql-8" class="md-nav__link">
    1. MySQL 8 新特性概述
  </a>
  
    <nav class="md-nav" aria-label="1. MySQL 8 新特性概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql5780mysql-8" class="md-nav__link">
    MySQL从5.7版本直接跳跃发布了8.0版本，可见这是一个令人兴奋的里程碑版本。MySQL 8版本在功能上
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmysql-optimizer" class="md-nav__link">
    做了显著的改进与增强，开发者对MySQL的源代码进行了重构，最突出的一点是多MySQL Optimizer优化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    器进行了改进。不仅在速度上得到了改善，还为用户带来了更好的性能和更棒的体验。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-1-mysql-8-0" class="md-nav__link">
    1. 1 MySQL 8. 0 新增特性
  </a>
  
    <nav class="md-nav" aria-label="1. 1 MySQL 8. 0 新增特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-nosql-nosql" class="md-nav__link">
    1. 更简便的NoSQL支持 NoSQL泛指非关系型数据库和数据存储。随着互联网平台的规模飞速发展，传统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56mysqlnosql" class="md-nav__link">
    的关系型数据库已经越来越不能满足需求。从5.6版本开始，MySQL就开始支持简单的NoSQL存储功能。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-8nosqlschema" class="md-nav__link">
    MySQL 8对这一功能做了优化，以更灵活的方式实现NoSQL功能，不再依赖模式（schema）。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mysql-8" class="md-nav__link">
    2. 更好的索引 在查询中，正确地使用索引可以提高查询的效率。MySQL 8中新增了隐藏索引和降序索
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    引。隐藏索引可以用来测试去掉索引对查询性能的影响。在查询中混合存在多列索引时，使用降序索引
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    可以提高查询的性能。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-json-mysql57jsonmysql-8" class="md-nav__link">
    3 .更完善的JSON支持 MySQL从5.7开始支持原生JSON数据的存储，MySQL 8对这一功能做了优化，增加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json_arrayaggjson_objectaggjson" class="md-nav__link">
    了聚合函数JSON_ARRAYAGG()和JSON_OBJECTAGG()，将参数聚合为JSON数组或对象，新增了行内
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-jsonjson" class="md-nav__link">
    操作符 -&gt;&gt;，是列路径运算符 -&gt;的增强，对JSON排序做了提升，并优化了JSON的更新操作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-mysql-8caching_sha2_password-fips" class="md-nav__link">
    4 .安全和账户管理 MySQL 8中新增了caching_sha2_password 授权插件、角色、密码历史记录和FIPS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    模式支持，这些特性提高了数据库的安全性和性能，使数据库管理员能够更灵活地进行账户管理工作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-innodb-innodbmysql" class="md-nav__link">
    5 .InnoDB的变化 InnoDB是MySQL默认的存储引擎，是事务型数据库的首选引擎，支持事务安全表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acidmysql-8-innodb" class="md-nav__link">
    （ACID），支持行锁定和外键。在MySQL 8 版本中，InnoDB在自增、索引、加密、死锁、共享锁等方面
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ddl" class="md-nav__link">
    做了大量的改进和优化，并且支持原子数据定义语言（DDL），提高了数据安全性，对事务提供更好的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    支持。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-mysqlmysql-8" class="md-nav__link">
    6 .数据字典 在之前的MySQL版本中，字典数据都存储在元数据文件和非事务表中。从MySQL 8开始新增
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    了事务数据字典，在这个字典里存储着数据库对象信息，这些数据字典存储在内部事务表中。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-mysql-8automic-ddlddl" class="md-nav__link">
    7. 原子数据定义语句 MySQL 8开始支持原子数据定义语句（Automic DDL），即原子DDL。目前，只有
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#innodbddlddlddl" class="md-nav__link">
    InnoDB存储引擎支持原子DDL。原子数据定义语句（DDL）将与DDL操作相关的数据字典更新、存储引擎
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    操作、二进制日志写入结合到一个单独的原子事务中，这使得即使服务器崩溃，事务也会提交或回滚。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop-tablecreate-tablealter-table" class="md-nav__link">
    使用支持原子操作的存储引擎所创建的表，在执行DROP TABLE、CREATE TABLE、ALTER TABLE、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rename-tabletruncate-tablecreate-tablespacedrop-tablespace" class="md-nav__link">
    RENAME TABLE、TRUNCATE TABLE、CREATE TABLESPACE、DROP TABLESPACE等操作时，都支持原子操
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-57mysql-8" class="md-nav__link">
    作，即事务要么完全操作成功，要么失败后回滚，不再进行部分提交。 对于从MySQL 5.7复制到MySQL 8
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-existsif-not-exists" class="md-nav__link">
    版本中的语句，可以添加IF EXISTS或IF NOT EXISTS语句来避免发生错误。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-mysql-8" class="md-nav__link">
    8 .资源管理 MySQL 8开始支持创建和管理资源组，允许将服务器内运行的线程分配给特定的分组，以便
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    线程根据组内可用资源执行。组属性能够控制组内资源，启用或限制组内资源消耗。数据库管理员能够
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpucpu" class="md-nav__link">
    根据不同的工作负载适当地更改这些属性。 目前，CPU时间是可控资源，由“虚拟CPU”这个概念来表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpucpu_1" class="md-nav__link">
    示，此术语包含CPU的核心数，超线程，硬件线程等等。服务器在启动时确定可用的虚拟CPU数量。拥有
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpu-mysql" class="md-nav__link">
    对应权限的数据库管理员可以将这些CPU与资源组关联，并为资源组分配线程。 资源组组件为MySQL中
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlmysql" class="md-nav__link">
    的资源组管理提供了SQL接口。资源组的属性用于定义资源组。MySQL中存在两个默认组，系统组和用户
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    组，默认的组不能被删除，其属性也不能被更改。对于用户自定义的组，资源组创建时可初始化所有的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    属性，除去名字和类型，其他属性都可在创建之后进行更改。 在一些平台下，或进行了某些MySQL的配
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macos" class="md-nav__link">
    置时，资源管理的功能将受到限制，甚至不可用。例如，如果安装了线程池插件，或者使用的是macOS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freebsdsolarislinux" class="md-nav__link">
    系统，资源管理将处于不可用状态。在FreeBSD和Solaris系统中，资源线程优先级将失效。在Linux系统
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cap_sys_nice" class="md-nav__link">
    中，只有配置了CAP_SYS_NICE属性，资源管理优先级才能发挥作用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-mysql-8latin1utf8mb4" class="md-nav__link">
    9 .字符集支持 MySQL 8中默认的字符集由latin1更改为utf8mb4，并首次增加了日语所特定使用的集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utf8mb4_ja_0900_as_cs" class="md-nav__link">
    合，utf8mb4_ja_0900_as_cs。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-mysql" class="md-nav__link">
    10 .优化器增强 MySQL优化器开始支持隐藏索引和降序索引。隐藏索引不会被优化器使用，验证索引的必
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    要性时不需要删除索引，先将索引隐藏，如果优化器性能无影响就可以真正地删除索引。降序索引允许
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    优化器对多个列进行排序，并且允许排序顺序不一致。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-common-table-expressionsctemysql" class="md-nav__link">
    11 .公用表表达式 公用表表达式（Common Table Expressions）简称为CTE，MySQL现在支持递归和非递
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ctecteselectwith" class="md-nav__link">
    归两种形式的CTE。CTE通过在SELECT语句或其他特定语句前使用WITH语句对临时结果集进行命名。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    基础语法如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subquerywithcte_name" class="md-nav__link">
    Subquery代表子查询，子查询前使用WITH语句将结果集命名为cte_name，在后续的查询中即可使用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cte_name" class="md-nav__link">
    cte_name进行查询。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-mysql-8mysql-8" class="md-nav__link">
    12 .窗口函数 MySQL 8开始支持窗口函数。在之前的版本中已存在的大部分聚合函数在MySQL 8中也可以
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    作为窗口函数来使用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-mysql804unicode" class="md-nav__link">
    13 .正则表达式支持 MySQL在8.0.4以后的版本中采用支持Unicode的国际化组件库实现正则表达式操作，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unicodemysqlregexp_like" class="md-nav__link">
    这种方式不仅能提供完全的Unicode支持，而且是多字节安全编码。MySQL增加了REGEXP_LIKE()、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#egexp_instrregexp_replace-regexp_substrregexp_stack_limit" class="md-nav__link">
    EGEXP_INSTR()、REGEXP_REPLACE()和 REGEXP_SUBSTR()等函数来提升性能。另外，regexp_stack_limit和
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regexp_time_limit" class="md-nav__link">
    regexp_time_limit 系统变量能够通过匹配引擎来控制资源消耗。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-temptablememorytemptable" class="md-nav__link">
    14 .内部临时表 TempTable存储引擎取代MEMORY存储引擎成为内部临时表的默认存储引擎。TempTable存储
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#varcharvarbinaryinternal_tmp_mem_storage_engine" class="md-nav__link">
    引擎为VARCHAR和VARBINARY列提供高效存储。internal_tmp_mem_storage_engine会话变量定义了内部
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temptablememorytemptable" class="md-nav__link">
    临时表的存储引擎，可选的值有两个，TempTable和MEMORY，其中TempTable为默认的存储引擎。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temptable_max_ramtemptable" class="md-nav__link">
    temptable_max_ram系统配置项定义了TempTable存储引擎可使用的最大内存数量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-mysql-8mysql" class="md-nav__link">
    15 .日志记录 在MySQL 8中错误日志子系统由一系列MySQL组件构成。这些组件的构成由系统变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log_error_services" class="md-nav__link">
    log_error_services来配置，能够实现日志事件的过滤和写入。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16" class="md-nav__link">
    16 .备份锁 新的备份锁允许在线备份期间执行数据操作语句，同时阻止可能造成快照不一致的操作。新
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-instance-for-backup-unlock-instance" class="md-nav__link">
    备份锁由 LOCK INSTANCE FOR BACKUP 和 UNLOCK INSTANCE 语法提供支持，执行这些操作需要备份管理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    员特权。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-mysql-mysql-8json" class="md-nav__link">
    17 .增强的MySQL复制 MySQL 8复制支持对JSON文档进行部分更新的二进制日志记录，该记录使用紧凑
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    的二进制格式，从而节省记录完整JSON文档的空间。当使用基于语句的日志记录时，这种紧凑的日志记
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binlog_row_value_optionspartial_json" class="md-nav__link">
    录会自动完成，并且可以通过将新的binlog_row_value_options系统变量值设置为PARTIAL_JSON来启用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-mysql-8-0" class="md-nav__link">
    1. 2 MySQL 8. 0 移除的旧特性
  </a>
  
    <nav class="md-nav" aria-label="1. 2 MySQL 8. 0 移除的旧特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql-57mysql80" class="md-nav__link">
    在MySQL 5.7版本上开发的应用程序如果使用了MySQL8.0 移除的特性，语句可能会失败，或者产生不同
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    的执行结果。为了避免这些问题，对于使用了移除特性的应用，应当尽力修正避免使用这些特性，并尽
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    可能使用替代方法。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-1-flush-query-cachereset-query" class="md-nav__link">
    1. 查询缓存 查询缓存已被移除，删除的项有： （ 1 ）语句： FLUSH QUERY CACHE和RESET QUERY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-2-query_cache_limitquery_cache_min_res_unitquery_cache_size" class="md-nav__link">
    CACHE。 （ 2 ）系统变量： query_cache_limit、query_cache_min_res_unit、query_cache_size、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query_cache_typequery_cache_wlock_invalidate-3-qcache_free_blocks" class="md-nav__link">
    query_cache_type、query_cache_wlock_invalidate。 （ 3 ）状态变量： Qcache_free_blocks、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcache_free_memoryqcache_hitsqcache_insertsqcache_lowmem_prunesqcache_not_cached" class="md-nav__link">
    Qcache_free_memory、Qcache_hits、Qcache_inserts、Qcache_lowmem_prunes、Qcache_not_cached、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qcache_queries_in_cacheqcache_total_blocks-4-checking-privileges-on-cached" class="md-nav__link">
    Qcache_queries_in_cache、Qcache_total_blocks。 （ 4 ）线程状态： checking privileges on cached
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#querychecking-query-cache-for-queryinvalidating-query-cache-entriessending-cached-result-to" class="md-nav__link">
    query、checking query cache for query、invalidating query cache entries、sending cached result to
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clientstoring-result-in-query-cachewaiting-for-query-cache-lock" class="md-nav__link">
    client、storing result in query cache、waiting for query cache lock。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-encodedecodeencryptdes_encrypt" class="md-nav__link">
    2 .加密相关 删除的加密相关的内容有：ENCODE()、DECODE()、ENCRYPT()、DES_ENCRYPT()和
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#des_decryptdes-key-filehave_cryptflushdes_key_file" class="md-nav__link">
    DES_DECRYPT()函数，配置项des-key-file，系统变量have_crypt，FLUSH语句的DES_KEY_FILE选项，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#have_crypt-cmake-encryptsha2" class="md-nav__link">
    HAVE_CRYPT CMake选项。 对于移除的ENCRYPT()函数，考虑使用SHA2()替代，对于其他移除的函数，使
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aes_encryptaes_decrypt" class="md-nav__link">
    用AES_ENCRYPT()和AES_DECRYPT()替代。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-mysql-57mysql-8" class="md-nav__link">
    3 .空间函数相关 在MySQL 5.7版本中，多个空间函数已被标记为过时。这些过时函数在MySQL 8中都已被
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#st_mbr" class="md-nav__link">
    移除，只保留了对应的ST_和MBR函数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-nnull-sqlnnullsqlnulln" class="md-nav__link">
    4 .\N和NULL 在SQL语句中，解析器不再将\N视为NULL，所以在SQL语句中应使用NULL代替\N。这项变化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-data-infileselectinto-outfilenull" class="md-nav__link">
    不会影响使用LOAD DATA INFILE或者SELECT...INTO OUTFILE操作文件的导入和导出。在这类操作中，NULL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n" class="md-nav__link">
    仍等同于\N。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-mysql_install_db-mysqlmysql_install_db-" class="md-nav__link">
    5. mysql_install_db 在MySQL分布中，已移除了mysql_install_db程序，数据字典初始化需要调用带着--
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialize-initialize-insecuremysqld-bootstrapinstall_scriptdir" class="md-nav__link">
    initialize或者--initialize-insecure选项的mysqld来代替实现。另外，--bootstrap和INSTALL_SCRIPTDIR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cmake" class="md-nav__link">
    CMake也已被删除。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-mysql" class="md-nav__link">
    6 .通用分区处理程序 通用分区处理程序已从MySQL服务中被移除。为了实现给定表分区，表所使用的存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlinnodbndb" class="md-nav__link">
    储引擎需要自有的分区处理程序。 提供本地分区支持的MySQL存储引擎有两个，即InnoDB和NDB，而在
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-8innodb" class="md-nav__link">
    MySQL 8中只支持InnoDB。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-information_schema" class="md-nav__link">
    7 .系统和状态变量信息 在INFORMATION_SCHEMA数据库中，对系统和状态变量信息不再进行维护。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global_variablessession_variablesglobal_statussession_status" class="md-nav__link">
    GLOBAL_VARIABLES、SESSION_VARIABLES、GLOBAL_STATUS、SESSION_STATUS表都已被删除。另外，系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show_compatibility_56slave_heartbeat_period" class="md-nav__link">
    统变量show_compatibility_56也已被删除。被删除的状态变量有Slave_heartbeat_period、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slave_last_heartbeatslave_received_heartbeatsslave_retried_transactionsslave_running" class="md-nav__link">
    Slave_last_heartbeat,Slave_received_heartbeats、Slave_retried_transactions、Slave_running。以上被删除
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    的内容都可使用性能模式中对应的内容进行替代。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-mysql_plugin-mysql_pluginmysql-plugin-load-" class="md-nav__link">
    8 .mysql_plugin工具 mysql_plugin工具用来配置MySQL服务器插件，现已被删除，可使用--plugin-load或-
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-plugin-load-addinstall-plugin" class="md-nav__link">
    -plugin-load-add选项在服务器启动时加载插件或者在运行时使用INSTALL PLUGIN语句加载插件来替代该
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    工具。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-1" class="md-nav__link">
    2. 新特性 1 ：窗口函数
  </a>
  
    <nav class="md-nav" aria-label="2. 新特性 1 ：窗口函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-1_1" class="md-nav__link">
    2. 1 使用窗口函数前后对比
  </a>
  
    <nav class="md-nav" aria-label="2. 1 使用窗口函数前后对比">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    假设我现在有这样一个数据表，它显示了某购物网站在每个城市每个区的销售额：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    查询：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    需求： 现在计算这个网站在每个城市的销售总额、在全国的销售总额、每个区的销售额占所在城市销售
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    额中的比率，以及占总销售额中的比率。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    如果用分组和聚合函数，就需要分好几步来计算。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a" class="md-nav__link">
    第一步，计算总销售金额，并存入临时表 a：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a_1" class="md-nav__link">
    查看一下临时表 a ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b" class="md-nav__link">
    第二步，计算每个城市的销售总额并存入临时表 b：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b_1" class="md-nav__link">
    查看临时表 b ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    第三步，计算各区的销售占所在城市的总计金额的比例，和占全部销售总计金额的比例。我们可以通过
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    下面的连接查询获得需要的结果：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    结果显示：市销售金额、市销售占比、总销售金额、总销售占比都计算出来了。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    同样的查询，如果用窗口函数，就简单多了。我们可以用下面的代码来实现：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    结果显示，我们得到了与上面那种查询同样的结果。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    使用窗口函数，只用了一步就完成了查询。而且，由于没有用到临时表，执行的效率也更高了。很显
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    然， 在这种需要用到分组统计的结果对每一条记录进行计算的场景下，使用窗口函数更好 。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2" class="md-nav__link">
    2. 2 窗口函数分类
  </a>
  
    <nav class="md-nav" aria-label="2. 2 窗口函数分类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql-8-0" class="md-nav__link">
    MySQL从 8. 0 版本开始支持窗口函数。窗口函数的作用类似于在查询中对数据进行分组，不同的是，分组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    操作会把分组的结果聚合成一条记录，而窗口函数是将结果置于每一条数据记录中。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    窗口函数可以分为静态窗口函数和动态窗口函数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    静态窗口函数的窗口大小是固定的，不会因为记录的不同而不同；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    动态窗口函数的窗口大小会随着记录的不同而变化。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-httpsdevmysqlcomdocrefman80enwindow-function-descriptio" class="md-nav__link">
    MySQL官方网站窗口函数的网址为 https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nshtmlfunction_row-number" class="md-nav__link">
    ns.html#function_row-number 。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    窗口函数总体上可以分为序号函数、分布函数、前后函数、首尾函数和其他函数，如下表：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3" class="md-nav__link">
    2. 3 语法结构
  </a>
  
    <nav class="md-nav" aria-label="2. 3 语法结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    窗口函数的语法结构是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    或者是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#over" class="md-nav__link">
    OVER 关键字指定函数窗口的范围。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    如果省略后面括号中的内容，则窗口会包含满足WHERE条件的所有记录，窗口函数会基于所
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where_1" class="md-nav__link">
    有满足WHERE条件的记录进行计算。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#over_1" class="md-nav__link">
    如果OVER关键字后面的括号不为空，则可以使用如下语法设置窗口。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    窗口名：为窗口设置一个别名，用来标识窗口。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partition-by" class="md-nav__link">
    PARTITION BY子句：指定窗口函数按照哪些字段进行分组。分组后，窗口函数可以在每个分组中分
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    别执行。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-by" class="md-nav__link">
    ORDER BY子句：指定窗口函数按照哪些字段进行排序。执行排序操作使窗口函数按照排序后的数据
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    记录的顺序进行编号。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frame" class="md-nav__link">
    FRAME子句：为分区中的某个子集定义规则，可以用来作为滑动窗口使用。
  </a>
  
    <nav class="md-nav" aria-label="FRAME子句：为分区中的某个子集定义规则，可以用来作为滑动窗口使用。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overpartition-by-order-by-ascdesc" class="md-nav__link">
    函数 OVER（[PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC]）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#over-window-as-partition-by-order-by-ascdesc" class="md-nav__link">
    函数 OVER 窗口名 ... WINDOW 窗口名 AS （[PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC]）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4" class="md-nav__link">
    2. 4 分类讲解
  </a>
  
    <nav class="md-nav" aria-label="2. 4 分类讲解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    创建表：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    添加数据：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods" class="md-nav__link">
    下面针对goods表中的数据来验证每个窗口函数的功能。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 序号函数
  </a>
  
    <nav class="md-nav" aria-label="1. 序号函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-row_number" class="md-nav__link">
    1 ．ROW_NUMBER()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#row_number" class="md-nav__link">
    ROW_NUMBER()函数能够对数据中的序号进行顺序显示。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods_1" class="md-nav__link">
    举例：查询 goods 数据表中每个商品分类下价格降序排列的各个商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods-3" class="md-nav__link">
    举例：查询 goods 数据表中每个商品分类下价格最高的 3 种商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#89-90" class="md-nav__link">
    在名称为“女装/女士精品”的商品类别中，有两款商品的价格为 89. 90 元，分别是卫衣和牛仔裤。两款商品
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2-3-rankdense_rank" class="md-nav__link">
    的序号都应该为 2 ，而不是一个为 2 ，另一个为 3 。此时，可以使用RANK()函数和DENSE_RANK()函数解
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    决。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-rank" class="md-nav__link">
    2 ．RANK()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank-1-1-3" class="md-nav__link">
    使用RANK()函数能够对序号进行并列排序，并且会跳过重复的序号，比如序号为 1 、 1 、 3 。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank-goods" class="md-nav__link">
    举例：使用RANK()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank-goods-4" class="md-nav__link">
    举例：使用RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的 4 款商品信息。
  </a>
  
    <nav class="md-nav" aria-label="举例：使用RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的 4 款商品信息。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-10-2-39990-3500" class="md-nav__link">
    | 5 | 10 | 2 | 户外运动 | 骑行装备 |  399.90 | 3500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-9-2-5990-1500" class="md-nav__link">
    | 6 | 9 | 2 | 户外运动 | 登山杖 | 59.90 | 1500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_1" class="md-nav__link">
    +---------+----+-------------+---------------+------------+---------+-------+
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rank-1-2-2-4" class="md-nav__link">
    可以看到，使用RANK()函数得出的序号为 1 、 2 、 2 、 4 ，相同价格的商品序号相同，后面的商品序号是不
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    连续的，跳过了重复的序号。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-dense_rank" class="md-nav__link">
    3 ．DENSE_RANK()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank-1-1-2" class="md-nav__link">
    DENSE_RANK()函数对序号进行并列排序，并且不会跳过重复的序号，比如序号为 1 、 1 、 2 。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank-goods" class="md-nav__link">
    举例：使用DENSE_RANK()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank-goods-4" class="md-nav__link">
    举例：使用DENSE_RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的 4 款商品信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dense_rank-1-2-2-3" class="md-nav__link">
    可以看到，使用DENSE_RANK()函数得出的行号为 1 、 2 、 2 、 3 ，相同价格的商品序号相同，后面的商品序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    号是连续的，并且没有跳过重复的序号。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 分布函数
  </a>
  
    <nav class="md-nav" aria-label="2. 分布函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-percent_rank" class="md-nav__link">
    1 ．PERCENT_RANK()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#percent_rank" class="md-nav__link">
    PERCENT_RANK()函数是等级值百分比函数。按照如下方式进行计算。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rankrankrows" class="md-nav__link">
    其中，rank的值为使用RANK()函数产生的序号，rows的值为当前窗口的总记录数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods-percent_rank" class="md-nav__link">
    举例：计算 goods 数据表中名称为“女装/女士精品”的类别下的商品的PERCENT_RANK值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-cume_dist" class="md-nav__link">
    2 ．CUME_DIST()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cume_dist" class="md-nav__link">
    CUME_DIST()函数主要用于查询小于或等于某个值的比例。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods_2" class="md-nav__link">
    举例：查询goods数据表中小于或等于当前价格的比例。
  </a>
  
    <nav class="md-nav" aria-label="举例：查询goods数据表中小于或等于当前价格的比例。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-6-1-39990-1200" class="md-nav__link">
    | 1 | 6 | 1 | 女装/女士精品 | 呢绒外套 | 399.90 | 1200 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3-1-8990-1500" class="md-nav__link">
    | 2 | 3 | 1 | 女装/女士精品 | 卫衣 |  89.90 | 1500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4-1-8990-3500" class="md-nav__link">
    | 2 | 4 | 1 | 女装/女士精品 | 牛仔裤 |  89.90 | 3500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-1-7990-2500" class="md-nav__link">
    | 3 | 2 | 1 | 女装/女士精品 | 连衣裙 |  79.90 | 2500 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_2" class="md-nav__link">
    +---------+----+-------------+---------------+----------+--------+-------+
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    #写法一：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 前后函数
  </a>
  
    <nav class="md-nav" aria-label="3. 前后函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-lagexprn" class="md-nav__link">
    1 ．LAG(expr,n)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lagexprnnexpr" class="md-nav__link">
    LAG(expr,n)函数返回当前行的前n行的expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods_3" class="md-nav__link">
    举例：查询goods数据表中前一个商品价格与当前商品价格的差值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-leadexprn" class="md-nav__link">
    2 ．LEAD(expr,n)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leadexprnnexpr" class="md-nav__link">
    LEAD(expr,n)函数返回当前行的后n行的expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods_4" class="md-nav__link">
    举例：查询goods数据表中后一个商品价格与当前商品价格的差值。
  </a>
  
    <nav class="md-nav" aria-label="举例：查询goods数据表中后一个商品价格与当前商品价格的差值。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#016666666666666666-5-2990" class="md-nav__link">
    | 0.16666666666666666 | 5 | 女装/女士精品 | 百褶裙 | 29.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#03333333333333333-1-t-3990" class="md-nav__link">
    |  0.3333333333333333 | 1 | 女装/女士精品 | T恤 | 39.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#05-2-7990" class="md-nav__link">
    | 0.5 | 2 | 女装/女士精品 | 连衣裙 | 79.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#08333333333333334-3-8990" class="md-nav__link">
    |  0.8333333333333334 | 3 | 女装/女士精品 | 卫衣 | 89.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#08333333333333334-4-8990" class="md-nav__link">
    |  0.8333333333333334 | 4 | 女装/女士精品 | 牛仔裤 | 89.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-6-39990" class="md-nav__link">
    | 1 | 6 | 女装/女士精品 | 呢绒外套 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#016666666666666666-9-5990" class="md-nav__link">
    | 0.16666666666666666 | 9 | 户外运动 | 登山杖 | 59.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#05-7-39990" class="md-nav__link">
    | 0.5 | 7 | 户外运动 | 自行车 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#05-10-39990" class="md-nav__link">
    | 0.5 | 10 | 户外运动 | 骑行装备 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#06666666666666666-12-49990" class="md-nav__link">
    |  0.6666666666666666 | 12 | 户外运动 | 滑板 |  499.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#08333333333333334-11-79990" class="md-nav__link">
    |  0.8333333333333334 | 11 | 户外运动 | 运动外套 |  799.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-8-139990" class="md-nav__link">
    | 1 | 8 | 户外运动 | 山地自行车 | 1399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_3" class="md-nav__link">
    +---------------------+----+---------------+------------+---------+
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 首尾函数
  </a>
  
    <nav class="md-nav" aria-label="4. 首尾函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-first_valueexpr" class="md-nav__link">
    1 ．FIRST_VALUE(expr)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first_valueexprexpr" class="md-nav__link">
    FIRST_VALUE(expr)函数返回第一个expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    举例：按照价格排序，查询第 1 个商品的价格信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-last_valueexpr" class="md-nav__link">
    2 ．LAST_VALUE(expr)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#last_valueexprexpr" class="md-nav__link">
    LAST_VALUE(expr)函数返回最后一个expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    举例：按照价格排序，查询最后一个商品的价格信息。
  </a>
  
    <nav class="md-nav" aria-label="举例：按照价格排序，查询最后一个商品的价格信息。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-_4" class="md-nav__link">
    +----+---------------+------------+--------------+---------+------------+
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3990-2990-1000" class="md-nav__link">
    | 5 | 女装/女士精品 | 百褶裙 |  39.90 | 29.90 |  10.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-t-7990-3990-4000" class="md-nav__link">
    | 1 | 女装/女士精品 | T恤 |  79.90 | 39.90 |  40.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-8990-7990-1000" class="md-nav__link">
    | 2 | 女装/女士精品 | 连衣裙 |  89.90 | 79.90 |  10.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-8990-8990-000" class="md-nav__link">
    | 3 | 女装/女士精品 | 卫衣 |  89.90 | 89.90 | 0.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-39990-8990-31000" class="md-nav__link">
    | 4 | 女装/女士精品 | 牛仔裤 | 399.90 | 89.90 | 310.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-null-39990-null" class="md-nav__link">
    | 6 | 女装/女士精品 | 呢绒外套 | NULL |  399.90 | NULL |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-39990-5990-34000" class="md-nav__link">
    | 9 | 户外运动 | 登山杖 | 399.90 | 59.90 | 340.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-39990-39990-000" class="md-nav__link">
    | 7 | 户外运动 | 自行车 | 399.90 |  399.90 | 0.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-49990-39990-10000" class="md-nav__link">
    | 10 | 户外运动 | 骑行装备 | 499.90 |  399.90 | 100.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-79990-49990-30000" class="md-nav__link">
    | 12 | 户外运动 | 滑板 | 799.90 |  499.90 | 300.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-139990-79990-60000" class="md-nav__link">
    | 11 | 户外运动 | 运动外套 |  1399.90 |  799.90 | 600.00 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-null-139990-null" class="md-nav__link">
    | 8 | 户外运动 | 山地自行车 | NULL | 1399.90 | NULL |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_5" class="md-nav__link">
    +----+---------------+------------+--------------+---------+------------+
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 其他函数
  </a>
  
    <nav class="md-nav" aria-label="5. 其他函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-nth_valueexprn" class="md-nav__link">
    1 ．NTH_VALUE(expr,n)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nth_valueexprnnexpr" class="md-nav__link">
    NTH_VALUE(expr,n)函数返回第n个expr的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods-2-3" class="md-nav__link">
    举例：查询goods数据表中排名第 2 和第 3 的价格信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ntilen" class="md-nav__link">
    2 ．NTILE(n)函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntilenn" class="md-nav__link">
    NTILE(n)函数将分区中的有序数据分为n个桶，记录桶编号。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goods-3_1" class="md-nav__link">
    举例：将goods表中的商品按照价格分为 3 组。
  </a>
  
    <nav class="md-nav" aria-label="举例：将goods表中的商品按照价格分为 3 组。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-8990-1500-8990" class="md-nav__link">
    | 3 | 女装/女士精品 | 卫衣 | 89.90 | 1500 |  89.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-8990-3500-8990" class="md-nav__link">
    | 4 | 女装/女士精品 | 牛仔裤 | 89.90 | 3500 |  89.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-39990-1200-39990" class="md-nav__link">
    | 6 | 女装/女士精品 | 呢绒外套 |  399.90 | 1200 | 399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-5990-1500-5990" class="md-nav__link">
    | 9 | 户外运动 | 登山杖 | 59.90 | 1500 |  59.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-39990-1000-39990" class="md-nav__link">
    | 7 | 户外运动 | 自行车 |  399.90 | 1000 | 399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-39990-3500-39990" class="md-nav__link">
    | 10 | 户外运动 | 骑行装备 |  399.90 | 3500 | 399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-49990-1200-49990" class="md-nav__link">
    | 12 | 户外运动 | 滑板 |  499.90 | 1200 | 499.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-79990-500-79990" class="md-nav__link">
    | 11 | 户外运动 | 运动外套 |  799.90 | 500 | 799.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-139990-2500-139990" class="md-nav__link">
    | 8 | 户外运动 | 山地自行车 | 1399.90 | 2500 |  1399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_6" class="md-nav__link">
    +----+---------------+------------+---------+-------+------------+
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-5" class="md-nav__link">
    2. 5 小 结
  </a>
  
    <nav class="md-nav" aria-label="2. 5 小 结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    窗口函数的特点是可以分组，而且可以在分组内排序。另外，窗口函数不会因为分组而减少原表中的行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    数，这对我们在原表数据的基础上进行统计和排序非常有用。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-2" class="md-nav__link">
    3. 新特性 2 ：公用表表达式
  </a>
  
    <nav class="md-nav" aria-label="3. 新特性 2 ：公用表表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ctecommon-table-expressionscte" class="md-nav__link">
    公用表表达式（或通用表表达式）简称为CTE（Common Table Expressions）。CTE是一个命名的临时结
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cte" class="md-nav__link">
    果集，作用范围是当前语句。CTE可以理解成一个可以复用的子查询，当然跟子查询还是有点区别的，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ctecte" class="md-nav__link">
    CTE可以引用其他CTE，但子查询不能引用其他子查询。所以，可以考虑代替子查询。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    依据语法结构和执行方式的不同，公用表表达式分为普通公用表表达式和递归公用表表达式 2 种。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-1" class="md-nav__link">
    3. 1 普通公用表表达式
  </a>
  
    <nav class="md-nav" aria-label="3. 1 普通公用表表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    普通公用表表达式的语法结构是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    普通公用表表达式类似于子查询，不过，跟子查询不同的是，它可以被多次引用，而且可以被其他的普
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    通公用表表达式所引用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    举例：查询员工所在的部门的详细信息。
  </a>
  
    <nav class="md-nav" aria-label="举例：查询员工所在的部门的详细信息。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-7-39990" class="md-nav__link">
    | 1 | 7 | 户外运动 | 自行车 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-10-39990" class="md-nav__link">
    | 2 | 10 | 户外运动 | 骑行装备 |  399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-12-49990" class="md-nav__link">
    | 2 | 12 | 户外运动 | 滑板 |  499.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-11-79990" class="md-nav__link">
    | 3 | 11 | 户外运动 | 运动外套 |  799.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-8-139990" class="md-nav__link">
    | 3 | 8 | 户外运动 | 山地自行车 | 1399.90 |
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_7" class="md-nav__link">
    +----+----+---------------+------------+---------+
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-cte" class="md-nav__link">
    WITH CTE名称
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as" class="md-nav__link">
    AS （子查询）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selectdeleteupdate" class="md-nav__link">
    SELECT|DELETE|UPDATE 语句;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    这个查询也可以用普通公用表表达式的方式完成：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    例子说明，公用表表达式可以起到子查询的作用。以后如果遇到需要使用子查询的场景，你可以在查询
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    之前，先定义公用表表达式，然后在查询中用它来代替子查询。而且，跟子查询相比，公用表表达式有
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    一个优点，就是定义过公用表表达式之后的查询，可以像一个表一样多次引用公用表表达式，而子查询
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    则不能。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2_1" class="md-nav__link">
    3. 2 递归公用表表达式
  </a>
  
    <nav class="md-nav" aria-label="3. 2 递归公用表表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    递归公用表表达式也是一种公用表表达式，只不过，除了普通公用表表达式的特点以外，它还有自己的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    特点，就是 可以调用自己 。它的语法结构是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-union-all" class="md-nav__link">
    递归公用表表达式由 2 部分组成，分别是种子查询和递归查询，中间通过关键字 UNION [ALL]进行连接。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    这里的 种子查询，意思就是获得递归的初始值 。这个查询只会运行一次，以创建初始数据集，之后递归
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    查询会一直执行，直到没有任何新的查询数据产生，递归返回。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#employeesemployee_idlast_namemanager_idab" class="md-nav__link">
    案例： 针对于我们常用的employees表，包含employee_id，last_name和manager_id三个字段。如果a是b
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#babccba" class="md-nav__link">
    的管理者，那么，我们可以把b叫做a的下属，如果同时b又是c的管理者，那么c就是b的下属，是a的下下
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    属。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    下面我们尝试用查询语句列出所有具有下下属身份的人员信息。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    如果用我们之前学过的知识来解决，会比较复杂，至少要进行 4 次查询才能搞定：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    第一步，先找出初代管理者，就是不以任何别人为管理者的人，把结果存入临时表；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    第二步，找出所有以初代管理者为管理者的人，得到一个下属集，把结果存入临时表；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    第三步，找出所有以下属为管理者的人，得到一个下下属集，把结果存入临时表。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    第四步，找出所有以下下属为管理者的人，得到一个结果集。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    如果第四步的结果集为空，则计算结束，第三步的结果集就是我们需要的下下属集了，否则就必须继续
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    进行第四步，一直到结果集为空为止。比如上面的这个数据表，就需要到第五步，才能得到空结果集。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    而且，最后还要进行第六步：把第三步和第四步的结果集合并，这样才能最终获得我们需要的结果集。
  </a>
  
    <nav class="md-nav" aria-label="而且，最后还要进行第六步：把第三步和第四步的结果集合并，这样才能最终获得我们需要的结果集。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-recursive" class="md-nav__link">
    WITH RECURSIVE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cte-as" class="md-nav__link">
    CTE名称 AS （子查询）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selectdeleteupdate_1" class="md-nav__link">
    SELECT|DELETE|UPDATE 语句;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    如果用递归公用表表达式，就非常简单了。我介绍下具体的思路。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n-1" class="md-nav__link">
    用递归公用表表达式中的种子查询，找出初代管理者。字段 n 表示代次，初始值为 1 ，表示是第一
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    代管理者。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    用递归公用表表达式中的递归查询，查出以这个递归公用表表达式中的人为管理者的人，并且代次
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    的值加 1 。直到没有人以这个递归公用表表达式中的人为管理者了，递归返回。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    在最后的查询中，选出所有代次大于等于 3 的人，他们肯定是第三代及以上代次的下属了，也就是
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    下下属了。这样就得到了我们需要的结果集。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3" class="md-nav__link">
    这里看似也是 3 步，实际上是一个查询的 3 个部分，只需要执行一次就可以了。而且也不需要用临时表
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    保存中间结果，比刚刚的方法简单多了。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    代码实现：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    总之，递归公用表表达式对于查询一个有共同的根节点的树形结构数据，非常有用。它可以不受层级的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    限制，轻松查出所有节点的数据。如果用其他的查询方式，就比较复杂了。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3_1" class="md-nav__link">
    3. 3 小 结
  </a>
  
    <nav class="md-nav" aria-label="3. 3 小 结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    公用表表达式的作用是可以替代子查询，而且可以被多次引用。递归公用表表达式对查询有一个共同根
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    节点的树形结构数据非常高效，可以轻松搞定其他查询方式难以处理的查询。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  




<h1 id="18-_mysql-8">第 18 章_MySQL 8 其它新特性<a class="headerlink" href="#18-_mysql-8" title="Permanent link">&para;</a></h1>
<h5 id="-">讲师：尚硅谷-宋红康（江湖人称：康师傅）<a class="headerlink" href="#-" title="Permanent link">&para;</a></h5>
<h5 id="httpwwwatguigucom">官网： http://www.atguigu.com<a class="headerlink" href="#httpwwwatguigucom" title="Permanent link">&para;</a></h5>
<h2 id="1-mysql-8">1. MySQL 8 新特性概述<a class="headerlink" href="#1-mysql-8" title="Permanent link">&para;</a></h2>
<h5 id="mysql5780mysql-8">MySQL从5.7版本直接跳跃发布了8.0版本，可见这是一个令人兴奋的里程碑版本。MySQL 8版本在功能上<a class="headerlink" href="#mysql5780mysql-8" title="Permanent link">&para;</a></h5>
<h5 id="mysqlmysql-optimizer">做了显著的改进与增强，开发者对MySQL的源代码进行了重构，最突出的一点是多MySQL Optimizer优化<a class="headerlink" href="#mysqlmysql-optimizer" title="Permanent link">&para;</a></h5>
<h5 id="_1">器进行了改进。不仅在速度上得到了改善，还为用户带来了更好的性能和更棒的体验。<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h5>
<h2 id="1-1-mysql-8-0">1. 1 MySQL 8. 0 新增特性<a class="headerlink" href="#1-1-mysql-8-0" title="Permanent link">&para;</a></h2>
<h5 id="1-nosql-nosql">1. 更简便的NoSQL支持 NoSQL泛指非关系型数据库和数据存储。随着互联网平台的规模飞速发展，传统<a class="headerlink" href="#1-nosql-nosql" title="Permanent link">&para;</a></h5>
<h5 id="56mysqlnosql">的关系型数据库已经越来越不能满足需求。从5.6版本开始，MySQL就开始支持简单的NoSQL存储功能。<a class="headerlink" href="#56mysqlnosql" title="Permanent link">&para;</a></h5>
<h5 id="mysql-8nosqlschema">MySQL 8对这一功能做了优化，以更灵活的方式实现NoSQL功能，不再依赖模式（schema）。<a class="headerlink" href="#mysql-8nosqlschema" title="Permanent link">&para;</a></h5>
<h5 id="2-mysql-8">2. 更好的索引 在查询中，正确地使用索引可以提高查询的效率。MySQL 8中新增了隐藏索引和降序索<a class="headerlink" href="#2-mysql-8" title="Permanent link">&para;</a></h5>
<h5 id="_2">引。隐藏索引可以用来测试去掉索引对查询性能的影响。在查询中混合存在多列索引时，使用降序索引<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h5>
<h5 id="_3">可以提高查询的性能。<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h5>
<h5 id="3-json-mysql57jsonmysql-8">3 .更完善的JSON支持 MySQL从5.7开始支持原生JSON数据的存储，MySQL 8对这一功能做了优化，增加<a class="headerlink" href="#3-json-mysql57jsonmysql-8" title="Permanent link">&para;</a></h5>
<h5 id="json_arrayaggjson_objectaggjson">了聚合函数JSON_ARRAYAGG()和JSON_OBJECTAGG()，将参数聚合为JSON数组或对象，新增了行内<a class="headerlink" href="#json_arrayaggjson_objectaggjson" title="Permanent link">&para;</a></h5>
<h5 id="-jsonjson">操作符 -&gt;&gt;，是列路径运算符 -&gt;的增强，对JSON排序做了提升，并优化了JSON的更新操作。<a class="headerlink" href="#-jsonjson" title="Permanent link">&para;</a></h5>
<h5 id="4-mysql-8caching_sha2_password-fips">4 .安全和账户管理 MySQL 8中新增了caching_sha2_password 授权插件、角色、密码历史记录和FIPS<a class="headerlink" href="#4-mysql-8caching_sha2_password-fips" title="Permanent link">&para;</a></h5>
<h5 id="_4">模式支持，这些特性提高了数据库的安全性和性能，使数据库管理员能够更灵活地进行账户管理工作。<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h5>
<h5 id="5-innodb-innodbmysql">5 .InnoDB的变化 InnoDB是MySQL默认的存储引擎，是事务型数据库的首选引擎，支持事务安全表<a class="headerlink" href="#5-innodb-innodbmysql" title="Permanent link">&para;</a></h5>
<h5 id="acidmysql-8-innodb">（ACID），支持行锁定和外键。在MySQL 8 版本中，InnoDB在自增、索引、加密、死锁、共享锁等方面<a class="headerlink" href="#acidmysql-8-innodb" title="Permanent link">&para;</a></h5>
<h5 id="ddl">做了大量的改进和优化，并且支持原子数据定义语言（DDL），提高了数据安全性，对事务提供更好的<a class="headerlink" href="#ddl" title="Permanent link">&para;</a></h5>
<h5 id="_5">支持。<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h5>
<h5 id="6-mysqlmysql-8">6 .数据字典 在之前的MySQL版本中，字典数据都存储在元数据文件和非事务表中。从MySQL 8开始新增<a class="headerlink" href="#6-mysqlmysql-8" title="Permanent link">&para;</a></h5>
<h5 id="_6">了事务数据字典，在这个字典里存储着数据库对象信息，这些数据字典存储在内部事务表中。<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h5>
<h5 id="7-mysql-8automic-ddlddl">7. 原子数据定义语句 MySQL 8开始支持原子数据定义语句（Automic DDL），即原子DDL。目前，只有<a class="headerlink" href="#7-mysql-8automic-ddlddl" title="Permanent link">&para;</a></h5>
<h5 id="innodbddlddlddl">InnoDB存储引擎支持原子DDL。原子数据定义语句（DDL）将与DDL操作相关的数据字典更新、存储引擎<a class="headerlink" href="#innodbddlddlddl" title="Permanent link">&para;</a></h5>
<h5 id="_7">操作、二进制日志写入结合到一个单独的原子事务中，这使得即使服务器崩溃，事务也会提交或回滚。<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h5>
<h5 id="drop-tablecreate-tablealter-table">使用支持原子操作的存储引擎所创建的表，在执行DROP TABLE、CREATE TABLE、ALTER TABLE、<a class="headerlink" href="#drop-tablecreate-tablealter-table" title="Permanent link">&para;</a></h5>
<h5 id="rename-tabletruncate-tablecreate-tablespacedrop-tablespace">RENAME TABLE、TRUNCATE TABLE、CREATE TABLESPACE、DROP TABLESPACE等操作时，都支持原子操<a class="headerlink" href="#rename-tabletruncate-tablecreate-tablespacedrop-tablespace" title="Permanent link">&para;</a></h5>
<h5 id="mysql-57mysql-8">作，即事务要么完全操作成功，要么失败后回滚，不再进行部分提交。 对于从MySQL 5.7复制到MySQL 8<a class="headerlink" href="#mysql-57mysql-8" title="Permanent link">&para;</a></h5>
<h5 id="if-existsif-not-exists">版本中的语句，可以添加IF EXISTS或IF NOT EXISTS语句来避免发生错误。<a class="headerlink" href="#if-existsif-not-exists" title="Permanent link">&para;</a></h5>
<h5 id="8-mysql-8">8 .资源管理 MySQL 8开始支持创建和管理资源组，允许将服务器内运行的线程分配给特定的分组，以便<a class="headerlink" href="#8-mysql-8" title="Permanent link">&para;</a></h5>
<h5 id="_8">线程根据组内可用资源执行。组属性能够控制组内资源，启用或限制组内资源消耗。数据库管理员能够<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h5>
<h5 id="cpucpu">根据不同的工作负载适当地更改这些属性。 目前，CPU时间是可控资源，由“虚拟CPU”这个概念来表<a class="headerlink" href="#cpucpu" title="Permanent link">&para;</a></h5>
<h5 id="cpucpu_1">示，此术语包含CPU的核心数，超线程，硬件线程等等。服务器在启动时确定可用的虚拟CPU数量。拥有<a class="headerlink" href="#cpucpu_1" title="Permanent link">&para;</a></h5>
<h5 id="cpu-mysql">对应权限的数据库管理员可以将这些CPU与资源组关联，并为资源组分配线程。 资源组组件为MySQL中<a class="headerlink" href="#cpu-mysql" title="Permanent link">&para;</a></h5>
<h5 id="sqlmysql">的资源组管理提供了SQL接口。资源组的属性用于定义资源组。MySQL中存在两个默认组，系统组和用户<a class="headerlink" href="#sqlmysql" title="Permanent link">&para;</a></h5>
<h5 id="_9">组，默认的组不能被删除，其属性也不能被更改。对于用户自定义的组，资源组创建时可初始化所有的<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h5>
<h5 id="mysql">属性，除去名字和类型，其他属性都可在创建之后进行更改。 在一些平台下，或进行了某些MySQL的配<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h5>
<h5 id="macos">置时，资源管理的功能将受到限制，甚至不可用。例如，如果安装了线程池插件，或者使用的是macOS<a class="headerlink" href="#macos" title="Permanent link">&para;</a></h5>
<h5 id="freebsdsolarislinux">系统，资源管理将处于不可用状态。在FreeBSD和Solaris系统中，资源线程优先级将失效。在Linux系统<a class="headerlink" href="#freebsdsolarislinux" title="Permanent link">&para;</a></h5>
<h5 id="cap_sys_nice">中，只有配置了CAP_SYS_NICE属性，资源管理优先级才能发挥作用。<a class="headerlink" href="#cap_sys_nice" title="Permanent link">&para;</a></h5>
<h5 id="9-mysql-8latin1utf8mb4">9 .字符集支持 MySQL 8中默认的字符集由latin1更改为utf8mb4，并首次增加了日语所特定使用的集<a class="headerlink" href="#9-mysql-8latin1utf8mb4" title="Permanent link">&para;</a></h5>
<h5 id="utf8mb4_ja_0900_as_cs">合，utf8mb4_ja_0900_as_cs。<a class="headerlink" href="#utf8mb4_ja_0900_as_cs" title="Permanent link">&para;</a></h5>
<h5 id="10-mysql">10 .优化器增强 MySQL优化器开始支持隐藏索引和降序索引。隐藏索引不会被优化器使用，验证索引的必<a class="headerlink" href="#10-mysql" title="Permanent link">&para;</a></h5>
<h5 id="_10">要性时不需要删除索引，先将索引隐藏，如果优化器性能无影响就可以真正地删除索引。降序索引允许<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h5>
<h5 id="_11">优化器对多个列进行排序，并且允许排序顺序不一致。<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h5>
<h5 id="11-common-table-expressionsctemysql">11 .公用表表达式 公用表表达式（Common Table Expressions）简称为CTE，MySQL现在支持递归和非递<a class="headerlink" href="#11-common-table-expressionsctemysql" title="Permanent link">&para;</a></h5>
<h5 id="ctecteselectwith">归两种形式的CTE。CTE通过在SELECT语句或其他特定语句前使用WITH语句对临时结果集进行命名。<a class="headerlink" href="#ctecteselectwith" title="Permanent link">&para;</a></h5>
<h5 id="_12">基础语法如下：<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h5>
<h5 id="subquerywithcte_name">Subquery代表子查询，子查询前使用WITH语句将结果集命名为cte_name，在后续的查询中即可使用<a class="headerlink" href="#subquerywithcte_name" title="Permanent link">&para;</a></h5>
<h5 id="cte_name">cte_name进行查询。<a class="headerlink" href="#cte_name" title="Permanent link">&para;</a></h5>
<h5 id="12-mysql-8mysql-8">12 .窗口函数 MySQL 8开始支持窗口函数。在之前的版本中已存在的大部分聚合函数在MySQL 8中也可以<a class="headerlink" href="#12-mysql-8mysql-8" title="Permanent link">&para;</a></h5>
<h5 id="_13">作为窗口函数来使用。<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h5>
<h5 id="13-mysql804unicode">13 .正则表达式支持 MySQL在8.0.4以后的版本中采用支持Unicode的国际化组件库实现正则表达式操作，<a class="headerlink" href="#13-mysql804unicode" title="Permanent link">&para;</a></h5>
<h5 id="unicodemysqlregexp_like">这种方式不仅能提供完全的Unicode支持，而且是多字节安全编码。MySQL增加了REGEXP_LIKE()、<a class="headerlink" href="#unicodemysqlregexp_like" title="Permanent link">&para;</a></h5>
<h5 id="egexp_instrregexp_replace-regexp_substrregexp_stack_limit">EGEXP_INSTR()、REGEXP_REPLACE()和 REGEXP_SUBSTR()等函数来提升性能。另外，regexp_stack_limit和<a class="headerlink" href="#egexp_instrregexp_replace-regexp_substrregexp_stack_limit" title="Permanent link">&para;</a></h5>
<h5 id="regexp_time_limit">regexp_time_limit 系统变量能够通过匹配引擎来控制资源消耗。<a class="headerlink" href="#regexp_time_limit" title="Permanent link">&para;</a></h5>
<h5 id="14-temptablememorytemptable">14 .内部临时表 TempTable存储引擎取代MEMORY存储引擎成为内部临时表的默认存储引擎。TempTable存储<a class="headerlink" href="#14-temptablememorytemptable" title="Permanent link">&para;</a></h5>
<h5 id="varcharvarbinaryinternal_tmp_mem_storage_engine">引擎为VARCHAR和VARBINARY列提供高效存储。internal_tmp_mem_storage_engine会话变量定义了内部<a class="headerlink" href="#varcharvarbinaryinternal_tmp_mem_storage_engine" title="Permanent link">&para;</a></h5>
<h5 id="temptablememorytemptable">临时表的存储引擎，可选的值有两个，TempTable和MEMORY，其中TempTable为默认的存储引擎。<a class="headerlink" href="#temptablememorytemptable" title="Permanent link">&para;</a></h5>
<h5 id="temptable_max_ramtemptable">temptable_max_ram系统配置项定义了TempTable存储引擎可使用的最大内存数量。<a class="headerlink" href="#temptable_max_ramtemptable" title="Permanent link">&para;</a></h5>
<h5 id="15-mysql-8mysql">15 .日志记录 在MySQL 8中错误日志子系统由一系列MySQL组件构成。这些组件的构成由系统变量<a class="headerlink" href="#15-mysql-8mysql" title="Permanent link">&para;</a></h5>
<h5 id="log_error_services">log_error_services来配置，能够实现日志事件的过滤和写入。<a class="headerlink" href="#log_error_services" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>WITH cte_name (col_name1,col_name2 ...) AS (Subquery)
SELECT * FROM cte_name;
</code></pre></div>
<h5 id="16">16 .备份锁 新的备份锁允许在线备份期间执行数据操作语句，同时阻止可能造成快照不一致的操作。新<a class="headerlink" href="#16" title="Permanent link">&para;</a></h5>
<h5 id="lock-instance-for-backup-unlock-instance">备份锁由 LOCK INSTANCE FOR BACKUP 和 UNLOCK INSTANCE 语法提供支持，执行这些操作需要备份管理<a class="headerlink" href="#lock-instance-for-backup-unlock-instance" title="Permanent link">&para;</a></h5>
<h5 id="_14">员特权。<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h5>
<h5 id="17-mysql-mysql-8json">17 .增强的MySQL复制 MySQL 8复制支持对JSON文档进行部分更新的二进制日志记录，该记录使用紧凑<a class="headerlink" href="#17-mysql-mysql-8json" title="Permanent link">&para;</a></h5>
<h5 id="json">的二进制格式，从而节省记录完整JSON文档的空间。当使用基于语句的日志记录时，这种紧凑的日志记<a class="headerlink" href="#json" title="Permanent link">&para;</a></h5>
<h5 id="binlog_row_value_optionspartial_json">录会自动完成，并且可以通过将新的binlog_row_value_options系统变量值设置为PARTIAL_JSON来启用。<a class="headerlink" href="#binlog_row_value_optionspartial_json" title="Permanent link">&para;</a></h5>
<h3 id="1-2-mysql-8-0">1. 2 MySQL 8. 0 移除的旧特性<a class="headerlink" href="#1-2-mysql-8-0" title="Permanent link">&para;</a></h3>
<h5 id="mysql-57mysql80">在MySQL 5.7版本上开发的应用程序如果使用了MySQL8.0 移除的特性，语句可能会失败，或者产生不同<a class="headerlink" href="#mysql-57mysql80" title="Permanent link">&para;</a></h5>
<h5 id="_15">的执行结果。为了避免这些问题，对于使用了移除特性的应用，应当尽力修正避免使用这些特性，并尽<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h5>
<h5 id="_16">可能使用替代方法。<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h5>
<h5 id="1-1-flush-query-cachereset-query">1. 查询缓存 查询缓存已被移除，删除的项有： （ 1 ）语句： FLUSH QUERY CACHE和RESET QUERY<a class="headerlink" href="#1-1-flush-query-cachereset-query" title="Permanent link">&para;</a></h5>
<h5 id="cache-2-query_cache_limitquery_cache_min_res_unitquery_cache_size">CACHE。 （ 2 ）系统变量： query_cache_limit、query_cache_min_res_unit、query_cache_size、<a class="headerlink" href="#cache-2-query_cache_limitquery_cache_min_res_unitquery_cache_size" title="Permanent link">&para;</a></h5>
<h5 id="query_cache_typequery_cache_wlock_invalidate-3-qcache_free_blocks">query_cache_type、query_cache_wlock_invalidate。 （ 3 ）状态变量： Qcache_free_blocks、<a class="headerlink" href="#query_cache_typequery_cache_wlock_invalidate-3-qcache_free_blocks" title="Permanent link">&para;</a></h5>
<h5 id="qcache_free_memoryqcache_hitsqcache_insertsqcache_lowmem_prunesqcache_not_cached">Qcache_free_memory、Qcache_hits、Qcache_inserts、Qcache_lowmem_prunes、Qcache_not_cached、<a class="headerlink" href="#qcache_free_memoryqcache_hitsqcache_insertsqcache_lowmem_prunesqcache_not_cached" title="Permanent link">&para;</a></h5>
<h5 id="qcache_queries_in_cacheqcache_total_blocks-4-checking-privileges-on-cached">Qcache_queries_in_cache、Qcache_total_blocks。 （ 4 ）线程状态： checking privileges on cached<a class="headerlink" href="#qcache_queries_in_cacheqcache_total_blocks-4-checking-privileges-on-cached" title="Permanent link">&para;</a></h5>
<h5 id="querychecking-query-cache-for-queryinvalidating-query-cache-entriessending-cached-result-to">query、checking query cache for query、invalidating query cache entries、sending cached result to<a class="headerlink" href="#querychecking-query-cache-for-queryinvalidating-query-cache-entriessending-cached-result-to" title="Permanent link">&para;</a></h5>
<h5 id="clientstoring-result-in-query-cachewaiting-for-query-cache-lock">client、storing result in query cache、waiting for query cache lock。<a class="headerlink" href="#clientstoring-result-in-query-cachewaiting-for-query-cache-lock" title="Permanent link">&para;</a></h5>
<h5 id="2-encodedecodeencryptdes_encrypt">2 .加密相关 删除的加密相关的内容有：ENCODE()、DECODE()、ENCRYPT()、DES_ENCRYPT()和<a class="headerlink" href="#2-encodedecodeencryptdes_encrypt" title="Permanent link">&para;</a></h5>
<h5 id="des_decryptdes-key-filehave_cryptflushdes_key_file">DES_DECRYPT()函数，配置项des-key-file，系统变量have_crypt，FLUSH语句的DES_KEY_FILE选项，<a class="headerlink" href="#des_decryptdes-key-filehave_cryptflushdes_key_file" title="Permanent link">&para;</a></h5>
<h5 id="have_crypt-cmake-encryptsha2">HAVE_CRYPT CMake选项。 对于移除的ENCRYPT()函数，考虑使用SHA2()替代，对于其他移除的函数，使<a class="headerlink" href="#have_crypt-cmake-encryptsha2" title="Permanent link">&para;</a></h5>
<h5 id="aes_encryptaes_decrypt">用AES_ENCRYPT()和AES_DECRYPT()替代。<a class="headerlink" href="#aes_encryptaes_decrypt" title="Permanent link">&para;</a></h5>
<h5 id="3-mysql-57mysql-8">3 .空间函数相关 在MySQL 5.7版本中，多个空间函数已被标记为过时。这些过时函数在MySQL 8中都已被<a class="headerlink" href="#3-mysql-57mysql-8" title="Permanent link">&para;</a></h5>
<h5 id="st_mbr">移除，只保留了对应的ST_和MBR函数。<a class="headerlink" href="#st_mbr" title="Permanent link">&para;</a></h5>
<h5 id="4-nnull-sqlnnullsqlnulln">4 .\N和NULL 在SQL语句中，解析器不再将\N视为NULL，所以在SQL语句中应使用NULL代替\N。这项变化<a class="headerlink" href="#4-nnull-sqlnnullsqlnulln" title="Permanent link">&para;</a></h5>
<h5 id="load-data-infileselectinto-outfilenull">不会影响使用LOAD DATA INFILE或者SELECT...INTO OUTFILE操作文件的导入和导出。在这类操作中，NULL<a class="headerlink" href="#load-data-infileselectinto-outfilenull" title="Permanent link">&para;</a></h5>
<h5 id="n">仍等同于\N。<a class="headerlink" href="#n" title="Permanent link">&para;</a></h5>
<h5 id="5-mysql_install_db-mysqlmysql_install_db-">5. mysql_install_db 在MySQL分布中，已移除了mysql_install_db程序，数据字典初始化需要调用带着--<a class="headerlink" href="#5-mysql_install_db-mysqlmysql_install_db-" title="Permanent link">&para;</a></h5>
<h5 id="initialize-initialize-insecuremysqld-bootstrapinstall_scriptdir">initialize或者--initialize-insecure选项的mysqld来代替实现。另外，--bootstrap和INSTALL_SCRIPTDIR<a class="headerlink" href="#initialize-initialize-insecuremysqld-bootstrapinstall_scriptdir" title="Permanent link">&para;</a></h5>
<h5 id="cmake">CMake也已被删除。<a class="headerlink" href="#cmake" title="Permanent link">&para;</a></h5>
<h5 id="6-mysql">6 .通用分区处理程序 通用分区处理程序已从MySQL服务中被移除。为了实现给定表分区，表所使用的存<a class="headerlink" href="#6-mysql" title="Permanent link">&para;</a></h5>
<h5 id="mysqlinnodbndb">储引擎需要自有的分区处理程序。 提供本地分区支持的MySQL存储引擎有两个，即InnoDB和NDB，而在<a class="headerlink" href="#mysqlinnodbndb" title="Permanent link">&para;</a></h5>
<h5 id="mysql-8innodb">MySQL 8中只支持InnoDB。<a class="headerlink" href="#mysql-8innodb" title="Permanent link">&para;</a></h5>
<h5 id="7-information_schema">7 .系统和状态变量信息 在INFORMATION_SCHEMA数据库中，对系统和状态变量信息不再进行维护。<a class="headerlink" href="#7-information_schema" title="Permanent link">&para;</a></h5>
<h5 id="global_variablessession_variablesglobal_statussession_status">GLOBAL_VARIABLES、SESSION_VARIABLES、GLOBAL_STATUS、SESSION_STATUS表都已被删除。另外，系<a class="headerlink" href="#global_variablessession_variablesglobal_statussession_status" title="Permanent link">&para;</a></h5>
<h5 id="show_compatibility_56slave_heartbeat_period">统变量show_compatibility_56也已被删除。被删除的状态变量有Slave_heartbeat_period、<a class="headerlink" href="#show_compatibility_56slave_heartbeat_period" title="Permanent link">&para;</a></h5>
<h5 id="slave_last_heartbeatslave_received_heartbeatsslave_retried_transactionsslave_running">Slave_last_heartbeat,Slave_received_heartbeats、Slave_retried_transactions、Slave_running。以上被删除<a class="headerlink" href="#slave_last_heartbeatslave_received_heartbeatsslave_retried_transactionsslave_running" title="Permanent link">&para;</a></h5>
<h5 id="_17">的内容都可使用性能模式中对应的内容进行替代。<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h5>
<h5 id="8-mysql_plugin-mysql_pluginmysql-plugin-load-">8 .mysql_plugin工具 mysql_plugin工具用来配置MySQL服务器插件，现已被删除，可使用--plugin-load或-<a class="headerlink" href="#8-mysql_plugin-mysql_pluginmysql-plugin-load-" title="Permanent link">&para;</a></h5>
<h5 id="-plugin-load-addinstall-plugin">-plugin-load-add选项在服务器启动时加载插件或者在运行时使用INSTALL PLUGIN语句加载插件来替代该<a class="headerlink" href="#-plugin-load-addinstall-plugin" title="Permanent link">&para;</a></h5>
<h5 id="_18">工具。<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h5>
<h2 id="2-1">2. 新特性 1 ：窗口函数<a class="headerlink" href="#2-1" title="Permanent link">&para;</a></h2>
<h3 id="2-1_1">2. 1 使用窗口函数前后对比<a class="headerlink" href="#2-1_1" title="Permanent link">&para;</a></h3>
<h5 id="_19">假设我现在有这样一个数据表，它显示了某购物网站在每个城市每个区的销售额：<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h5>
<h5 id="_20">查询：<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h5>
<h5 id="_21">需求： 现在计算这个网站在每个城市的销售总额、在全国的销售总额、每个区的销售额占所在城市销售<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h5>
<h5 id="_22">额中的比率，以及占总销售额中的比率。<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h5>
<h5 id="_23">如果用分组和聚合函数，就需要分好几步来计算。<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h5>
<h5 id="a">第一步，计算总销售金额，并存入临时表 a：<a class="headerlink" href="#a" title="Permanent link">&para;</a></h5>
<h5 id="a_1">查看一下临时表 a ：<a class="headerlink" href="#a_1" title="Permanent link">&para;</a></h5>
<h5 id="b">第二步，计算每个城市的销售总额并存入临时表 b：<a class="headerlink" href="#b" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>CREATE TABLE sales(
id INT PRIMARY KEY AUTO_INCREMENT,
city VARCHAR( 15 ),
county VARCHAR( 15 ),
sales_value DECIMAL
</code></pre></div>
<div class="highlight"><pre><span></span><code>);
</code></pre></div>
<div class="highlight"><pre><span></span><code>INSERT INTO sales(city,county,sales_value)
VALUES
(&#39;北京&#39;,&#39;海淀&#39;,10.00),
(&#39;北京&#39;,&#39;朝阳&#39;,20.00),
(&#39;上海&#39;,&#39;黄埔&#39;,30.00),
(&#39;上海&#39;,&#39;长宁&#39;,10.00);
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT * FROM sales;
+----+------+--------+-------------+
| id | city | county | sales_value |
+----+------+--------+-------------+
| 1 | 北京 | 海淀 | 10 |
| 2 | 北京 | 朝阳 | 20 |
| 3 | 上海 | 黄埔 | 30 |
| 4 | 上海 | 长宁 | 10 |
+----+------+--------+-------------+
4 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>CREATE TEMPORARY TABLE a -- 创建临时表
SELECT SUM(sales_value) AS sales_value -- 计算总计金额
FROM sales;
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT * FROM a;
+-------------+
| sales_value |
+-------------+
| 70 |
+-------------+
1 row in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>CREATE TEMPORARY TABLE b  -- 创建临时表
SELECT city,SUM(sales_value) AS sales_value  -- 计算城市销售合计
FROM sales
GROUP BY city;
</code></pre></div>
<h5 id="b_1">查看临时表 b ：<a class="headerlink" href="#b_1" title="Permanent link">&para;</a></h5>
<h5 id="_24">第三步，计算各区的销售占所在城市的总计金额的比例，和占全部销售总计金额的比例。我们可以通过<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h5>
<h5 id="_25">下面的连接查询获得需要的结果：<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h5>
<h5 id="_26">结果显示：市销售金额、市销售占比、总销售金额、总销售占比都计算出来了。<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h5>
<h5 id="_27">同样的查询，如果用窗口函数，就简单多了。我们可以用下面的代码来实现：<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h5>
<h5 id="_28">结果显示，我们得到了与上面那种查询同样的结果。<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h5>
<h5 id="_29">使用窗口函数，只用了一步就完成了查询。而且，由于没有用到临时表，执行的效率也更高了。很显<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h5>
<h5 id="_30">然， 在这种需要用到分组统计的结果对每一条记录进行计算的场景下，使用窗口函数更好 。<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT * FROM b;
+------+-------------+
| city | sales_value |
+------+-------------+
| 北京 | 30 |
| 上海 | 40 |
+------+-------------+
2 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT s.city AS 城市,s.county AS 区,s.sales_value AS 区销售额,
-&gt; b.sales_value AS 市销售额,s.sales_value/b.sales_value AS 市比率,
-&gt; a.sales_value AS 总销售额,s.sales_value/a.sales_value AS 总比率
-&gt; FROM sales s
-&gt; JOIN b ON (s.city=b.city) -- 连接市统计结果临时表
-&gt; JOIN a -- 连接总计金额临时表
-&gt; ORDER BY s.city,s.county;
+------+------+----------+----------+--------+----------+--------+
| 城市 | 区 | 区销售额 | 市销售额 | 市比率 | 总销售额 | 总比率 |
+------+------+----------+----------+--------+----------+--------+
| 上海 | 长宁 | 10 | 40 | 0.2500 | 70 | 0.1429 |
| 上海 | 黄埔 | 30 | 40 | 0.7500 | 70 | 0.4286 |
| 北京 | 朝阳 | 20 | 30 | 0.6667 | 70 | 0.2857 |
| 北京 | 海淀 | 10 | 30 | 0.3333 | 70 | 0.1429 |
+------+------+----------+----------+--------+----------+--------+
4 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT city AS 城市,county AS 区,sales_value AS 区销售额,
-&gt; SUM(sales_value) OVER(PARTITION BY city) AS 市销售额,  -- 计算市销售额
-&gt; sales_value/SUM(sales_value) OVER(PARTITION BY city) AS 市比率,
-&gt; SUM(sales_value) OVER() AS 总销售额, -- 计算总销售额
-&gt; sales_value/SUM(sales_value) OVER() AS 总比率
-&gt; FROM sales
-&gt; ORDER BY city,county;
+------+------+----------+----------+--------+----------+--------+
| 城市 | 区 | 区销售额 | 市销售额 | 市比率 | 总销售额 | 总比率 |
+------+------+----------+----------+--------+----------+--------+
| 上海 | 长宁 | 10 | 40 | 0.2500 | 70 | 0.1429 |
| 上海 | 黄埔 | 30 | 40 | 0.7500 | 70 | 0.4286 |
| 北京 | 朝阳 | 20 | 30 | 0.6667 | 70 | 0.2857 |
| 北京 | 海淀 | 10 | 30 | 0.3333 | 70 | 0.1429 |
+------+------+----------+-----------+--------+----------+--------+
4 rows in set (0.00 sec)
</code></pre></div>
<h3 id="2-2">2. 2 窗口函数分类<a class="headerlink" href="#2-2" title="Permanent link">&para;</a></h3>
<h5 id="mysql-8-0">MySQL从 8. 0 版本开始支持窗口函数。窗口函数的作用类似于在查询中对数据进行分组，不同的是，分组<a class="headerlink" href="#mysql-8-0" title="Permanent link">&para;</a></h5>
<h5 id="_31">操作会把分组的结果聚合成一条记录，而窗口函数是将结果置于每一条数据记录中。<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h5>
<h5 id="_32">窗口函数可以分为静态窗口函数和动态窗口函数。<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h5>
<h5 id="_33">静态窗口函数的窗口大小是固定的，不会因为记录的不同而不同；<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h5>
<h5 id="_34">动态窗口函数的窗口大小会随着记录的不同而变化。<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h5>
<h5 id="mysql-httpsdevmysqlcomdocrefman80enwindow-function-descriptio">MySQL官方网站窗口函数的网址为 https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptio<a class="headerlink" href="#mysql-httpsdevmysqlcomdocrefman80enwindow-function-descriptio" title="Permanent link">&para;</a></h5>
<h5 id="nshtmlfunction_row-number">ns.html#function_row-number 。<a class="headerlink" href="#nshtmlfunction_row-number" title="Permanent link">&para;</a></h5>
<h5 id="_35">窗口函数总体上可以分为序号函数、分布函数、前后函数、首尾函数和其他函数，如下表：<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h5>
<h3 id="2-3">2. 3 语法结构<a class="headerlink" href="#2-3" title="Permanent link">&para;</a></h3>
<h5 id="_36">窗口函数的语法结构是：<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h5>
<h5 id="_37">或者是：<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h5>
<h5 id="over">OVER 关键字指定函数窗口的范围。<a class="headerlink" href="#over" title="Permanent link">&para;</a></h5>
<h5 id="where">如果省略后面括号中的内容，则窗口会包含满足WHERE条件的所有记录，窗口函数会基于所<a class="headerlink" href="#where" title="Permanent link">&para;</a></h5>
<h5 id="where_1">有满足WHERE条件的记录进行计算。<a class="headerlink" href="#where_1" title="Permanent link">&para;</a></h5>
<h5 id="over_1">如果OVER关键字后面的括号不为空，则可以使用如下语法设置窗口。<a class="headerlink" href="#over_1" title="Permanent link">&para;</a></h5>
<h5 id="_38">窗口名：为窗口设置一个别名，用来标识窗口。<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h5>
<h5 id="partition-by">PARTITION BY子句：指定窗口函数按照哪些字段进行分组。分组后，窗口函数可以在每个分组中分<a class="headerlink" href="#partition-by" title="Permanent link">&para;</a></h5>
<h5 id="_39">别执行。<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h5>
<h5 id="order-by">ORDER BY子句：指定窗口函数按照哪些字段进行排序。执行排序操作使窗口函数按照排序后的数据<a class="headerlink" href="#order-by" title="Permanent link">&para;</a></h5>
<h5 id="_40">记录的顺序进行编号。<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h5>
<h5 id="frame">FRAME子句：为分区中的某个子集定义规则，可以用来作为滑动窗口使用。<a class="headerlink" href="#frame" title="Permanent link">&para;</a></h5>
<h6 id="overpartition-by-order-by-ascdesc">函数 OVER（[PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC]）<a class="headerlink" href="#overpartition-by-order-by-ascdesc" title="Permanent link">&para;</a></h6>
<h6 id="over-window-as-partition-by-order-by-ascdesc">函数 OVER 窗口名 ... WINDOW 窗口名 AS （[PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC]）<a class="headerlink" href="#over-window-as-partition-by-order-by-ascdesc" title="Permanent link">&para;</a></h6>
<h3 id="2-4">2. 4 分类讲解<a class="headerlink" href="#2-4" title="Permanent link">&para;</a></h3>
<h5 id="_41">创建表：<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h5>
<h5 id="_42">添加数据：<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h5>
<h5 id="goods">下面针对goods表中的数据来验证每个窗口函数的功能。<a class="headerlink" href="#goods" title="Permanent link">&para;</a></h5>
<h4 id="1">1. 序号函数<a class="headerlink" href="#1" title="Permanent link">&para;</a></h4>
<h5 id="1-row_number">1 ．ROW_NUMBER()函数<a class="headerlink" href="#1-row_number" title="Permanent link">&para;</a></h5>
<h5 id="row_number">ROW_NUMBER()函数能够对数据中的序号进行顺序显示。<a class="headerlink" href="#row_number" title="Permanent link">&para;</a></h5>
<h5 id="goods_1">举例：查询 goods 数据表中每个商品分类下价格降序排列的各个商品信息。<a class="headerlink" href="#goods_1" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>CREATE TABLE goods(
id INT PRIMARY KEY AUTO_INCREMENT,
category_id INT,
category VARCHAR( 15 ),
NAME VARCHAR( 30 ),
price DECIMAL( 10 , 2 ),
stock INT,
upper_time DATETIME
</code></pre></div>
<div class="highlight"><pre><span></span><code>);
</code></pre></div>
<div class="highlight"><pre><span></span><code>INSERT INTO goods(category_id,category,NAME,price,stock,upper_time)
VALUES
( 1 , &#39;女装/女士精品&#39;, &#39;T恤&#39;, 39.90, 1000 , &#39;2020-11-10 00:00:00&#39;),
( 1 , &#39;女装/女士精品&#39;, &#39;连衣裙&#39;, 79.90, 2500 , &#39;2020-11-10 00:00:00&#39;),
( 1 , &#39;女装/女士精品&#39;, &#39;卫衣&#39;, 89.90, 1500 , &#39;2020-11-10 00:00:00&#39;),
( 1 , &#39;女装/女士精品&#39;, &#39;牛仔裤&#39;, 89.90, 3500 , &#39;2020-11-10 00:00:00&#39;),
( 1 , &#39;女装/女士精品&#39;, &#39;百褶裙&#39;, 29.90, 500 , &#39;2020-11-10 00:00:00&#39;),
( 1 , &#39;女装/女士精品&#39;, &#39;呢绒外套&#39;, 399.90, 1200 , &#39;2020-11-10 00:00:00&#39;),
( 2 , &#39;户外运动&#39;, &#39;自行车&#39;, 399.90, 1000 , &#39;2020-11-10 00:00:00&#39;),
( 2 , &#39;户外运动&#39;, &#39;山地自行车&#39;, 1399.90, 2500 , &#39;2020-11-10 00:00:00&#39;),
( 2 , &#39;户外运动&#39;, &#39;登山杖&#39;, 59.90, 1500 , &#39;2020-11-10 00:00:00&#39;),
( 2 , &#39;户外运动&#39;, &#39;骑行装备&#39;, 399.90, 3500 , &#39;2020-11-10 00:00:00&#39;),
( 2 , &#39;户外运动&#39;, &#39;运动外套&#39;, 799.90, 500 , &#39;2020-11-10 00:00:00&#39;),
( 2 , &#39;户外运动&#39;, &#39;滑板&#39;, 499.90, 1200 , &#39;2020-11-10 00:00:00&#39;);
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT ROW_NUMBER() OVER(PARTITION BY category_id ORDER BY price DESC) AS
row_num,
-&gt; id, category_id, category, NAME, price, stock
-&gt; FROM goods;
+---------+----+-------------+---------------+------------+---------+-------+
| row_num | id | category_id | category | NAME | price | stock |
+---------+----+-------------+---------------+------------+---------+-------+
| 1 | 6 | 1 | 女装/女士精品 | 呢绒外套 |  399.90 | 1200 |
| 2 | 3 | 1 | 女装/女士精品 | 卫衣 | 89.90 | 1500 |
| 3 | 4 | 1 | 女装/女士精品 | 牛仔裤 | 89.90 | 3500 |
| 4 | 2 | 1 | 女装/女士精品 | 连衣裙 | 79.90 | 2500 |
| 5 | 1 | 1 | 女装/女士精品 | T恤 | 39.90 | 1000 |
| 6 | 5 | 1 | 女装/女士精品 | 百褶裙 | 29.90 | 500 |
| 1 | 8 | 2 | 户外运动 | 山地自行车 | 1399.90 | 2500 |
| 2 | 11 | 2 | 户外运动 | 运动外套 |  799.90 | 500 |
| 3 | 12 | 2 | 户外运动 | 滑板 |  499.90 | 1200 |
| 4 | 7 | 2 | 户外运动 | 自行车 |  399.90 | 1000 |
</code></pre></div>
<h5 id="goods-3">举例：查询 goods 数据表中每个商品分类下价格最高的 3 种商品信息。<a class="headerlink" href="#goods-3" title="Permanent link">&para;</a></h5>
<h5 id="89-90">在名称为“女装/女士精品”的商品类别中，有两款商品的价格为 89. 90 元，分别是卫衣和牛仔裤。两款商品<a class="headerlink" href="#89-90" title="Permanent link">&para;</a></h5>
<h5 id="2-2-3-rankdense_rank">的序号都应该为 2 ，而不是一个为 2 ，另一个为 3 。此时，可以使用RANK()函数和DENSE_RANK()函数解<a class="headerlink" href="#2-2-3-rankdense_rank" title="Permanent link">&para;</a></h5>
<h5 id="_43">决。<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h5>
<h5 id="2-rank">2 ．RANK()函数<a class="headerlink" href="#2-rank" title="Permanent link">&para;</a></h5>
<h5 id="rank-1-1-3">使用RANK()函数能够对序号进行并列排序，并且会跳过重复的序号，比如序号为 1 、 1 、 3 。<a class="headerlink" href="#rank-1-1-3" title="Permanent link">&para;</a></h5>
<h5 id="rank-goods">举例：使用RANK()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。<a class="headerlink" href="#rank-goods" title="Permanent link">&para;</a></h5>
<h5 id="rank-goods-4">举例：使用RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的 4 款商品信息。<a class="headerlink" href="#rank-goods-4" title="Permanent link">&para;</a></h5>
<h6 id="5-10-2-39990-3500">| 5 | 10 | 2 | 户外运动 | 骑行装备 |  399.90 | 3500 |<a class="headerlink" href="#5-10-2-39990-3500" title="Permanent link">&para;</a></h6>
<h6 id="6-9-2-5990-1500">| 6 | 9 | 2 | 户外运动 | 登山杖 | 59.90 | 1500 |<a class="headerlink" href="#6-9-2-5990-1500" title="Permanent link">&para;</a></h6>
<h6 id="-_1">+---------+----+-------------+---------------+------------+---------+-------+<a class="headerlink" href="#-_1" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>12 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT *
-&gt; FROM (
-&gt;  SELECT ROW_NUMBER() OVER(PARTITION BY category_id ORDER BY price DESC) AS
row_num,
-&gt; id, category_id, category, NAME, price, stock
-&gt;  FROM goods) t
-&gt; WHERE row_num &lt;= 3 ;
+---------+----+-------------+---------------+------------+---------+-------+
| row_num | id | category_id | category | NAME | price | stock |
+---------+----+-------------+---------------+------------+---------+-------+
| 1 | 6 | 1 | 女装/女士精品 | 呢绒外套 |  399.90 | 1200 |
| 2 | 3 | 1 | 女装/女士精品 | 卫衣 | 89.90 | 1500 |
| 3 | 4 | 1 | 女装/女士精品 | 牛仔裤 | 89.90 | 3500 |
| 1 | 8 | 2 | 户外运动 | 山地自行车 | 1399.90 | 2500 |
| 2 | 11 | 2 | 户外运动 | 运动外套 |  799.90 | 500 |
| 3 | 12 | 2 | 户外运动 | 滑板 |  499.90 | 1200 |
+---------+----+-------------+---------------+------------+----------+-------+
6 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,
-&gt; id, category_id, category, NAME, price, stock
-&gt; FROM goods;
+---------+----+-------------+---------------+------------+---------+-------+
| row_num | id | category_id | category | NAME | price | stock |
+---------+----+-------------+---------------+------------+---------+-------+
| 1 | 6 | 1 | 女装/女士精品 | 呢绒外套 | 399.90 | 1200 |
| 2 | 3 | 1 | 女装/女士精品 | 卫衣 | 89.90 | 1500 |
| 2 | 4 | 1 | 女装/女士精品 | 牛仔裤 | 89.90 | 3500 |
| 4 | 2 | 1 | 女装/女士精品 | 连衣裙 | 79.90 | 2500 |
| 5 | 1 | 1 | 女装/女士精品 | T恤 | 39.90 | 1000 |
| 6 | 5 | 1 | 女装/女士精品 | 百褶裙 | 29.90 | 500 |
| 1 | 8 | 2 | 户外运动 | 山地自行车 | 1399.90 | 2500 |
| 2 | 11 | 2 | 户外运动 | 运动外套 | 799.90 | 500 |
| 3 | 12 | 2 | 户外运动 | 滑板 | 499.90 | 1200 |
| 4 | 7 | 2 | 户外运动 | 自行车 | 399.90 | 1000 |
| 4 | 10 | 2 | 户外运动 | 骑行装备 | 399.90 | 3500 |
| 6 | 9 | 2 | 户外运动 | 登山杖 | 59.90 | 1500 |
+---------+----+-------------+---------------+------------+---------+-------+
12 rows in set (0.00 sec)
</code></pre></div>
<h5 id="rank-1-2-2-4">可以看到，使用RANK()函数得出的序号为 1 、 2 、 2 、 4 ，相同价格的商品序号相同，后面的商品序号是不<a class="headerlink" href="#rank-1-2-2-4" title="Permanent link">&para;</a></h5>
<h5 id="_44">连续的，跳过了重复的序号。<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h5>
<h5 id="3-dense_rank">3 ．DENSE_RANK()函数<a class="headerlink" href="#3-dense_rank" title="Permanent link">&para;</a></h5>
<h5 id="dense_rank-1-1-2">DENSE_RANK()函数对序号进行并列排序，并且不会跳过重复的序号，比如序号为 1 、 1 、 2 。<a class="headerlink" href="#dense_rank-1-1-2" title="Permanent link">&para;</a></h5>
<h5 id="dense_rank-goods">举例：使用DENSE_RANK()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。<a class="headerlink" href="#dense_rank-goods" title="Permanent link">&para;</a></h5>
<h5 id="dense_rank-goods-4">举例：使用DENSE_RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的 4 款商品信息。<a class="headerlink" href="#dense_rank-goods-4" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT *
-&gt; FROM(
-&gt;  SELECT RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,
-&gt; id, category_id, category, NAME, price, stock
-&gt;  FROM goods) t
-&gt; WHERE category_id = 1 AND row_num &lt;= 4 ;
+---------+----+-------------+---------------+----------+--------+-------+
| row_num | id | category_id | category | NAME | price | stock |
+---------+----+-------------+---------------+----------+--------+-------+
| 1 | 6 | 1 | 女装/女士精品 | 呢绒外套 | 399.90 | 1200 |
| 2 | 3 | 1 | 女装/女士精品 | 卫衣 |  89.90 | 1500 |
| 2 | 4 | 1 | 女装/女士精品 | 牛仔裤 |  89.90 | 3500 |
| 4 | 2 | 1 | 女装/女士精品 | 连衣裙 |  79.90 | 2500 |
+---------+----+-------------+---------------+----------+--------+-------+
4 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT DENSE_RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS
row_num,
-&gt; id, category_id, category, NAME, price, stock
-&gt; FROM goods;
+---------+----+-------------+---------------+------------+---------+-------+
| row_num | id | category_id | category | NAME | price | stock |
+---------+----+-------------+---------------+------------+---------+-------+
| 1 | 6 | 1 | 女装/女士精品 | 呢绒外套 | 399.90 | 1200 |
| 2 | 3 | 1 | 女装/女士精品 | 卫衣 | 89.90 | 1500 |
| 2 | 4 | 1 | 女装/女士精品 | 牛仔裤 | 89.90 | 3500 |
| 3 | 2 | 1 | 女装/女士精品 | 连衣裙 | 79.90 | 2500 |
| 4 | 1 | 1 | 女装/女士精品 | T恤 | 39.90 | 1000 |
| 5 | 5 | 1 | 女装/女士精品 | 百褶裙 | 29.90 | 500 |
| 1 | 8 | 2 | 户外运动 | 山地自行车 | 1399.90 | 2500 |
| 2 | 11 | 2 | 户外运动 | 运动外套 | 799.90 | 500 |
| 3 | 12 | 2 | 户外运动 | 滑板 | 499.90 | 1200 |
| 4 | 7 | 2 | 户外运动 | 自行车 | 399.90 | 1000 |
| 4 | 10 | 2 | 户外运动 | 骑行装备 | 399.90 | 3500 |
| 5 | 9 | 2 | 户外运动 | 登山杖 | 59.90 | 1500 |
+---------+----+-------------+---------------+------------+---------+-------+
12 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT *
-&gt; FROM(
-&gt;  SELECT DENSE_RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS
row_num,
-&gt; id, category_id, category, NAME, price, stock
-&gt;  FROM goods) t
-&gt; WHERE category_id = 1 AND row_num &lt;= 3 ;
+---------+----+-------------+---------------+----------+--------+-------+
| row_num | id | category_id | category | NAME | price | stock |
+---------+----+-------------+---------------+----------+--------+-------+
</code></pre></div>
<h5 id="dense_rank-1-2-2-3">可以看到，使用DENSE_RANK()函数得出的行号为 1 、 2 、 2 、 3 ，相同价格的商品序号相同，后面的商品序<a class="headerlink" href="#dense_rank-1-2-2-3" title="Permanent link">&para;</a></h5>
<h5 id="_45">号是连续的，并且没有跳过重复的序号。<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h5>
<h4 id="2">2. 分布函数<a class="headerlink" href="#2" title="Permanent link">&para;</a></h4>
<h5 id="1-percent_rank">1 ．PERCENT_RANK()函数<a class="headerlink" href="#1-percent_rank" title="Permanent link">&para;</a></h5>
<h5 id="percent_rank">PERCENT_RANK()函数是等级值百分比函数。按照如下方式进行计算。<a class="headerlink" href="#percent_rank" title="Permanent link">&para;</a></h5>
<h5 id="rankrankrows">其中，rank的值为使用RANK()函数产生的序号，rows的值为当前窗口的总记录数。<a class="headerlink" href="#rankrankrows" title="Permanent link">&para;</a></h5>
<h5 id="goods-percent_rank">举例：计算 goods 数据表中名称为“女装/女士精品”的类别下的商品的PERCENT_RANK值。<a class="headerlink" href="#goods-percent_rank" title="Permanent link">&para;</a></h5>
<h5 id="2-cume_dist">2 ．CUME_DIST()函数<a class="headerlink" href="#2-cume_dist" title="Permanent link">&para;</a></h5>
<h5 id="cume_dist">CUME_DIST()函数主要用于查询小于或等于某个值的比例。<a class="headerlink" href="#cume_dist" title="Permanent link">&para;</a></h5>
<h5 id="goods_2">举例：查询goods数据表中小于或等于当前价格的比例。<a class="headerlink" href="#goods_2" title="Permanent link">&para;</a></h5>
<h6 id="1-6-1-39990-1200">| 1 | 6 | 1 | 女装/女士精品 | 呢绒外套 | 399.90 | 1200 |<a class="headerlink" href="#1-6-1-39990-1200" title="Permanent link">&para;</a></h6>
<h6 id="2-3-1-8990-1500">| 2 | 3 | 1 | 女装/女士精品 | 卫衣 |  89.90 | 1500 |<a class="headerlink" href="#2-3-1-8990-1500" title="Permanent link">&para;</a></h6>
<h6 id="2-4-1-8990-3500">| 2 | 4 | 1 | 女装/女士精品 | 牛仔裤 |  89.90 | 3500 |<a class="headerlink" href="#2-4-1-8990-3500" title="Permanent link">&para;</a></h6>
<h6 id="3-2-1-7990-2500">| 3 | 2 | 1 | 女装/女士精品 | 连衣裙 |  79.90 | 2500 |<a class="headerlink" href="#3-2-1-7990-2500" title="Permanent link">&para;</a></h6>
<h6 id="-_2">+---------+----+-------------+---------------+----------+--------+-------+<a class="headerlink" href="#-_2" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>4 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>(rank - 1 ) / (rows - 1 )
</code></pre></div>
<h6 id="_46">#写法一：<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SELECT RANK() OVER (PARTITION BY category_id ORDER BY price DESC) AS r,
PERCENT_RANK() OVER (PARTITION BY category_id ORDER BY price DESC) AS pr,
id, category_id, category, NAME, price, stock
FROM goods
WHERE category_id = 1 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>#写法二：
mysql&gt; SELECT RANK() OVER w AS r,
-&gt; PERCENT_RANK() OVER w AS pr,
-&gt; id, category_id, category, NAME, price, stock
-&gt; FROM goods
-&gt; WHERE category_id = 1 WINDOW w AS (PARTITION BY category_id ORDER BY price
DESC);
+---+-----+----+-------------+---------------+----------+--------+-------+
| r | pr | id | category_id | category | NAME | price | stock |
+---+-----+----+-------------+---------------+----------+--------+-------+
| 1 | 0 | 6 | 1 | 女装/女士精品 | 呢绒外套 | 399.90 | 1200 |
| 2 | 0.2 | 3 | 1 | 女装/女士精品 | 卫衣 |  89.90 | 1500 |
| 2 | 0.2 | 4 | 1 | 女装/女士精品 | 牛仔裤 |  89.90 | 3500 |
| 4 | 0.6 | 2 | 1 | 女装/女士精品 | 连衣裙 |  79.90 | 2500 |
| 5 | 0.8 | 1 | 1 | 女装/女士精品 | T恤 |  39.90 | 1000 |
| 6 | 1 | 5 | 1 | 女装/女士精品 | 百褶裙 |  29.90 | 500 |
+---+-----+----+-------------+---------------+----------+--------+-------+
6 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT CUME_DIST() OVER(PARTITION BY category_id ORDER BY price ASC) AS cd,
-&gt; id, category, NAME, price
-&gt; FROM goods;
+---------------------+----+---------------+------------+---------+
| cd | id | category | NAME | price |
+---------------------+----+---------------+------------+---------+
</code></pre></div>
<h4 id="3">3. 前后函数<a class="headerlink" href="#3" title="Permanent link">&para;</a></h4>
<h5 id="1-lagexprn">1 ．LAG(expr,n)函数<a class="headerlink" href="#1-lagexprn" title="Permanent link">&para;</a></h5>
<h5 id="lagexprnnexpr">LAG(expr,n)函数返回当前行的前n行的expr的值。<a class="headerlink" href="#lagexprnnexpr" title="Permanent link">&para;</a></h5>
<h5 id="goods_3">举例：查询goods数据表中前一个商品价格与当前商品价格的差值。<a class="headerlink" href="#goods_3" title="Permanent link">&para;</a></h5>
<h5 id="2-leadexprn">2 ．LEAD(expr,n)函数<a class="headerlink" href="#2-leadexprn" title="Permanent link">&para;</a></h5>
<h5 id="leadexprnnexpr">LEAD(expr,n)函数返回当前行的后n行的expr的值。<a class="headerlink" href="#leadexprnnexpr" title="Permanent link">&para;</a></h5>
<h5 id="goods_4">举例：查询goods数据表中后一个商品价格与当前商品价格的差值。<a class="headerlink" href="#goods_4" title="Permanent link">&para;</a></h5>
<h6 id="016666666666666666-5-2990">| 0.16666666666666666 | 5 | 女装/女士精品 | 百褶裙 | 29.90 |<a class="headerlink" href="#016666666666666666-5-2990" title="Permanent link">&para;</a></h6>
<h6 id="03333333333333333-1-t-3990">|  0.3333333333333333 | 1 | 女装/女士精品 | T恤 | 39.90 |<a class="headerlink" href="#03333333333333333-1-t-3990" title="Permanent link">&para;</a></h6>
<h6 id="05-2-7990">| 0.5 | 2 | 女装/女士精品 | 连衣裙 | 79.90 |<a class="headerlink" href="#05-2-7990" title="Permanent link">&para;</a></h6>
<h6 id="08333333333333334-3-8990">|  0.8333333333333334 | 3 | 女装/女士精品 | 卫衣 | 89.90 |<a class="headerlink" href="#08333333333333334-3-8990" title="Permanent link">&para;</a></h6>
<h6 id="08333333333333334-4-8990">|  0.8333333333333334 | 4 | 女装/女士精品 | 牛仔裤 | 89.90 |<a class="headerlink" href="#08333333333333334-4-8990" title="Permanent link">&para;</a></h6>
<h6 id="1-6-39990">| 1 | 6 | 女装/女士精品 | 呢绒外套 |  399.90 |<a class="headerlink" href="#1-6-39990" title="Permanent link">&para;</a></h6>
<h6 id="016666666666666666-9-5990">| 0.16666666666666666 | 9 | 户外运动 | 登山杖 | 59.90 |<a class="headerlink" href="#016666666666666666-9-5990" title="Permanent link">&para;</a></h6>
<h6 id="05-7-39990">| 0.5 | 7 | 户外运动 | 自行车 |  399.90 |<a class="headerlink" href="#05-7-39990" title="Permanent link">&para;</a></h6>
<h6 id="05-10-39990">| 0.5 | 10 | 户外运动 | 骑行装备 |  399.90 |<a class="headerlink" href="#05-10-39990" title="Permanent link">&para;</a></h6>
<h6 id="06666666666666666-12-49990">|  0.6666666666666666 | 12 | 户外运动 | 滑板 |  499.90 |<a class="headerlink" href="#06666666666666666-12-49990" title="Permanent link">&para;</a></h6>
<h6 id="08333333333333334-11-79990">|  0.8333333333333334 | 11 | 户外运动 | 运动外套 |  799.90 |<a class="headerlink" href="#08333333333333334-11-79990" title="Permanent link">&para;</a></h6>
<h6 id="1-8-139990">| 1 | 8 | 户外运动 | 山地自行车 | 1399.90 |<a class="headerlink" href="#1-8-139990" title="Permanent link">&para;</a></h6>
<h6 id="-_3">+---------------------+----+---------------+------------+---------+<a class="headerlink" href="#-_3" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>12 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT id, category, NAME, price, pre_price, price - pre_price AS diff_price
-&gt; FROM (
-&gt;  SELECT id, category, NAME, price,LAG(price, 1 ) OVER w AS pre_price
-&gt;  FROM goods
-&gt; WINDOW w AS (PARTITION BY category_id ORDER BY price)) t;
+----+---------------+------------+---------+-----------+------------+
| id | category | NAME | price | pre_price | diff_price |
+----+---------------+------------+---------+-----------+------------+
| 5 | 女装/女士精品 | 百褶裙 | 29.90 |  NULL | NULL |
| 1 | 女装/女士精品 | T恤 | 39.90 | 29.90 |  10.00 |
| 2 | 女装/女士精品 | 连衣裙 | 79.90 | 39.90 |  40.00 |
| 3 | 女装/女士精品 | 卫衣 | 89.90 | 79.90 |  10.00 |
| 4 | 女装/女士精品 | 牛仔裤 | 89.90 | 89.90 | 0.00 |
| 6 | 女装/女士精品 | 呢绒外套 |  399.90 | 89.90 | 310.00 |
| 9 | 户外运动 | 登山杖 | 59.90 |  NULL | NULL |
| 7 | 户外运动 | 自行车 |  399.90 | 59.90 | 340.00 |
| 10 | 户外运动 | 骑行装备 |  399.90 |  399.90 | 0.00 |
| 12 | 户外运动 | 滑板 |  499.90 |  399.90 | 100.00 |
| 11 | 户外运动 | 运动外套 |  799.90 |  499.90 | 300.00 |
| 8 | 户外运动 | 山地自行车 | 1399.90 |  799.90 | 600.00 |
+----+---------------+------------+---------+-----------+------------+
12 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT id, category, NAME, behind_price, price,behind_price - price AS
diff_price
-&gt; FROM(
-&gt;  SELECT id, category, NAME, price,LEAD(price, 1 ) OVER w AS behind_price
-&gt;  FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price)) t;
+----+---------------+------------+--------------+---------+------------+
| id | category | NAME | behind_price | price | diff_price |
</code></pre></div>
<h4 id="4">4. 首尾函数<a class="headerlink" href="#4" title="Permanent link">&para;</a></h4>
<h5 id="1-first_valueexpr">1 ．FIRST_VALUE(expr)函数<a class="headerlink" href="#1-first_valueexpr" title="Permanent link">&para;</a></h5>
<h5 id="first_valueexprexpr">FIRST_VALUE(expr)函数返回第一个expr的值。<a class="headerlink" href="#first_valueexprexpr" title="Permanent link">&para;</a></h5>
<h5 id="1_1">举例：按照价格排序，查询第 1 个商品的价格信息。<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h5>
<h5 id="2-last_valueexpr">2 ．LAST_VALUE(expr)函数<a class="headerlink" href="#2-last_valueexpr" title="Permanent link">&para;</a></h5>
<h5 id="last_valueexprexpr">LAST_VALUE(expr)函数返回最后一个expr的值。<a class="headerlink" href="#last_valueexprexpr" title="Permanent link">&para;</a></h5>
<h5 id="_47">举例：按照价格排序，查询最后一个商品的价格信息。<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h5>
<h6 id="-_4">+----+---------------+------------+--------------+---------+------------+<a class="headerlink" href="#-_4" title="Permanent link">&para;</a></h6>
<h6 id="5-3990-2990-1000">| 5 | 女装/女士精品 | 百褶裙 |  39.90 | 29.90 |  10.00 |<a class="headerlink" href="#5-3990-2990-1000" title="Permanent link">&para;</a></h6>
<h6 id="1-t-7990-3990-4000">| 1 | 女装/女士精品 | T恤 |  79.90 | 39.90 |  40.00 |<a class="headerlink" href="#1-t-7990-3990-4000" title="Permanent link">&para;</a></h6>
<h6 id="2-8990-7990-1000">| 2 | 女装/女士精品 | 连衣裙 |  89.90 | 79.90 |  10.00 |<a class="headerlink" href="#2-8990-7990-1000" title="Permanent link">&para;</a></h6>
<h6 id="3-8990-8990-000">| 3 | 女装/女士精品 | 卫衣 |  89.90 | 89.90 | 0.00 |<a class="headerlink" href="#3-8990-8990-000" title="Permanent link">&para;</a></h6>
<h6 id="4-39990-8990-31000">| 4 | 女装/女士精品 | 牛仔裤 | 399.90 | 89.90 | 310.00 |<a class="headerlink" href="#4-39990-8990-31000" title="Permanent link">&para;</a></h6>
<h6 id="6-null-39990-null">| 6 | 女装/女士精品 | 呢绒外套 | NULL |  399.90 | NULL |<a class="headerlink" href="#6-null-39990-null" title="Permanent link">&para;</a></h6>
<h6 id="9-39990-5990-34000">| 9 | 户外运动 | 登山杖 | 399.90 | 59.90 | 340.00 |<a class="headerlink" href="#9-39990-5990-34000" title="Permanent link">&para;</a></h6>
<h6 id="7-39990-39990-000">| 7 | 户外运动 | 自行车 | 399.90 |  399.90 | 0.00 |<a class="headerlink" href="#7-39990-39990-000" title="Permanent link">&para;</a></h6>
<h6 id="10-49990-39990-10000">| 10 | 户外运动 | 骑行装备 | 499.90 |  399.90 | 100.00 |<a class="headerlink" href="#10-49990-39990-10000" title="Permanent link">&para;</a></h6>
<h6 id="12-79990-49990-30000">| 12 | 户外运动 | 滑板 | 799.90 |  499.90 | 300.00 |<a class="headerlink" href="#12-79990-49990-30000" title="Permanent link">&para;</a></h6>
<h6 id="11-139990-79990-60000">| 11 | 户外运动 | 运动外套 |  1399.90 |  799.90 | 600.00 |<a class="headerlink" href="#11-139990-79990-60000" title="Permanent link">&para;</a></h6>
<h6 id="8-null-139990-null">| 8 | 户外运动 | 山地自行车 | NULL | 1399.90 | NULL |<a class="headerlink" href="#8-null-139990-null" title="Permanent link">&para;</a></h6>
<h6 id="-_5">+----+---------------+------------+--------------+---------+------------+<a class="headerlink" href="#-_5" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>12 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT id, category, NAME, price, stock,FIRST_VALUE(price) OVER w AS
first_price
-&gt; FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price);
+----+---------------+------------+---------+-------+-------------+
| id | category | NAME | price | stock | first_price |
+----+---------------+------------+---------+-------+-------------+
| 5 | 女装/女士精品 | 百褶裙 | 29.90 | 500 | 29.90 |
| 1 | 女装/女士精品 | T恤 | 39.90 | 1000 | 29.90 |
| 2 | 女装/女士精品 | 连衣裙 | 79.90 | 2500 | 29.90 |
| 3 | 女装/女士精品 | 卫衣 | 89.90 | 1500 | 29.90 |
| 4 | 女装/女士精品 | 牛仔裤 | 89.90 | 3500 | 29.90 |
| 6 | 女装/女士精品 | 呢绒外套 |  399.90 | 1200 | 29.90 |
| 9 | 户外运动 | 登山杖 | 59.90 | 1500 | 59.90 |
| 7 | 户外运动 | 自行车 |  399.90 | 1000 | 59.90 |
| 10 | 户外运动 | 骑行装备 |  399.90 | 3500 | 59.90 |
| 12 | 户外运动 | 滑板 |  499.90 | 1200 | 59.90 |
| 11 | 户外运动 | 运动外套 |  799.90 | 500 | 59.90 |
| 8 | 户外运动 | 山地自行车 | 1399.90 | 2500 | 59.90 |
+----+---------------+------------+---------+-------+-------------+
12 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT id, category, NAME, price, stock,LAST_VALUE(price) OVER w AS last_price
-&gt; FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price);
+----+---------------+------------+---------+-------+------------+
| id | category | NAME | price | stock | last_price |
+----+---------------+------------+---------+-------+------------+
| 5 | 女装/女士精品 | 百褶裙 | 29.90 | 500 |  29.90 |
| 1 | 女装/女士精品 | T恤 | 39.90 | 1000 |  39.90 |
| 2 | 女装/女士精品 | 连衣裙 | 79.90 | 2500 |  79.90 |
</code></pre></div>
<h4 id="5">5. 其他函数<a class="headerlink" href="#5" title="Permanent link">&para;</a></h4>
<h5 id="1-nth_valueexprn">1 ．NTH_VALUE(expr,n)函数<a class="headerlink" href="#1-nth_valueexprn" title="Permanent link">&para;</a></h5>
<h5 id="nth_valueexprnnexpr">NTH_VALUE(expr,n)函数返回第n个expr的值。<a class="headerlink" href="#nth_valueexprnnexpr" title="Permanent link">&para;</a></h5>
<h5 id="goods-2-3">举例：查询goods数据表中排名第 2 和第 3 的价格信息。<a class="headerlink" href="#goods-2-3" title="Permanent link">&para;</a></h5>
<h5 id="2-ntilen">2 ．NTILE(n)函数<a class="headerlink" href="#2-ntilen" title="Permanent link">&para;</a></h5>
<h5 id="ntilenn">NTILE(n)函数将分区中的有序数据分为n个桶，记录桶编号。<a class="headerlink" href="#ntilenn" title="Permanent link">&para;</a></h5>
<h5 id="goods-3_1">举例：将goods表中的商品按照价格分为 3 组。<a class="headerlink" href="#goods-3_1" title="Permanent link">&para;</a></h5>
<h6 id="3-8990-1500-8990">| 3 | 女装/女士精品 | 卫衣 | 89.90 | 1500 |  89.90 |<a class="headerlink" href="#3-8990-1500-8990" title="Permanent link">&para;</a></h6>
<h6 id="4-8990-3500-8990">| 4 | 女装/女士精品 | 牛仔裤 | 89.90 | 3500 |  89.90 |<a class="headerlink" href="#4-8990-3500-8990" title="Permanent link">&para;</a></h6>
<h6 id="6-39990-1200-39990">| 6 | 女装/女士精品 | 呢绒外套 |  399.90 | 1200 | 399.90 |<a class="headerlink" href="#6-39990-1200-39990" title="Permanent link">&para;</a></h6>
<h6 id="9-5990-1500-5990">| 9 | 户外运动 | 登山杖 | 59.90 | 1500 |  59.90 |<a class="headerlink" href="#9-5990-1500-5990" title="Permanent link">&para;</a></h6>
<h6 id="7-39990-1000-39990">| 7 | 户外运动 | 自行车 |  399.90 | 1000 | 399.90 |<a class="headerlink" href="#7-39990-1000-39990" title="Permanent link">&para;</a></h6>
<h6 id="10-39990-3500-39990">| 10 | 户外运动 | 骑行装备 |  399.90 | 3500 | 399.90 |<a class="headerlink" href="#10-39990-3500-39990" title="Permanent link">&para;</a></h6>
<h6 id="12-49990-1200-49990">| 12 | 户外运动 | 滑板 |  499.90 | 1200 | 499.90 |<a class="headerlink" href="#12-49990-1200-49990" title="Permanent link">&para;</a></h6>
<h6 id="11-79990-500-79990">| 11 | 户外运动 | 运动外套 |  799.90 | 500 | 799.90 |<a class="headerlink" href="#11-79990-500-79990" title="Permanent link">&para;</a></h6>
<h6 id="8-139990-2500-139990">| 8 | 户外运动 | 山地自行车 | 1399.90 | 2500 |  1399.90 |<a class="headerlink" href="#8-139990-2500-139990" title="Permanent link">&para;</a></h6>
<h6 id="-_6">+----+---------------+------------+---------+-------+------------+<a class="headerlink" href="#-_6" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>12 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT id, category, NAME, price,NTH_VALUE(price, 2 ) OVER w AS second_price,
-&gt; NTH_VALUE(price, 3 ) OVER w AS third_price
-&gt; FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price);
+----+---------------+------------+---------+--------------+-------------+
| id | category | NAME | price | second_price | third_price |
+----+---------------+------------+---------+--------------+-------------+
| 5 | 女装/女士精品 | 百褶裙 | 29.90 | NULL |  NULL |
| 1 | 女装/女士精品 | T恤 | 39.90 |  39.90 |  NULL |
| 2 | 女装/女士精品 | 连衣裙 | 79.90 |  39.90 | 79.90 |
| 3 | 女装/女士精品 | 卫衣 | 89.90 |  39.90 | 79.90 |
| 4 | 女装/女士精品 | 牛仔裤 | 89.90 |  39.90 | 79.90 |
| 6 | 女装/女士精品 | 呢绒外套 |  399.90 |  39.90 | 79.90 |
| 9 | 户外运动 | 登山杖 | 59.90 | NULL |  NULL |
| 7 | 户外运动 | 自行车 |  399.90 | 399.90 |  399.90 |
| 10 | 户外运动 | 骑行装备 |  399.90 | 399.90 |  399.90 |
| 12 | 户外运动 | 滑板 |  499.90 | 399.90 |  399.90 |
| 11 | 户外运动 | 运动外套 |  799.90 | 399.90 |  399.90 |
| 8 | 户外运动 | 山地自行车 | 1399.90 | 399.90 |  399.90 |
+----+---------------+------------+---------+--------------+-------------+
12 rows in set (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT NTILE( 3 ) OVER w AS nt,id, category, NAME, price
-&gt; FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price);
+----+----+---------------+------------+---------+
| nt | id | category | NAME | price |
+----+----+---------------+------------+---------+
| 1 | 5 | 女装/女士精品 | 百褶裙 | 29.90 |
| 1 | 1 | 女装/女士精品 | T恤 | 39.90 |
| 2 | 2 | 女装/女士精品 | 连衣裙 | 79.90 |
| 2 | 3 | 女装/女士精品 | 卫衣 | 89.90 |
| 3 | 4 | 女装/女士精品 | 牛仔裤 | 89.90 |
| 3 | 6 | 女装/女士精品 | 呢绒外套 |  399.90 |
| 1 | 9 | 户外运动 | 登山杖 | 59.90 |
</code></pre></div>
<h3 id="2-5">2. 5 小 结<a class="headerlink" href="#2-5" title="Permanent link">&para;</a></h3>
<h5 id="_48">窗口函数的特点是可以分组，而且可以在分组内排序。另外，窗口函数不会因为分组而减少原表中的行<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h5>
<h5 id="_49">数，这对我们在原表数据的基础上进行统计和排序非常有用。<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h5>
<h2 id="3-2">3. 新特性 2 ：公用表表达式<a class="headerlink" href="#3-2" title="Permanent link">&para;</a></h2>
<h5 id="ctecommon-table-expressionscte">公用表表达式（或通用表表达式）简称为CTE（Common Table Expressions）。CTE是一个命名的临时结<a class="headerlink" href="#ctecommon-table-expressionscte" title="Permanent link">&para;</a></h5>
<h5 id="cte">果集，作用范围是当前语句。CTE可以理解成一个可以复用的子查询，当然跟子查询还是有点区别的，<a class="headerlink" href="#cte" title="Permanent link">&para;</a></h5>
<h5 id="ctecte">CTE可以引用其他CTE，但子查询不能引用其他子查询。所以，可以考虑代替子查询。<a class="headerlink" href="#ctecte" title="Permanent link">&para;</a></h5>
<h5 id="2_1">依据语法结构和执行方式的不同，公用表表达式分为普通公用表表达式和递归公用表表达式 2 种。<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h5>
<h3 id="3-1">3. 1 普通公用表表达式<a class="headerlink" href="#3-1" title="Permanent link">&para;</a></h3>
<h5 id="_50">普通公用表表达式的语法结构是：<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h5>
<h5 id="_51">普通公用表表达式类似于子查询，不过，跟子查询不同的是，它可以被多次引用，而且可以被其他的普<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h5>
<h5 id="_52">通公用表表达式所引用。<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h5>
<h5 id="_53">举例：查询员工所在的部门的详细信息。<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h5>
<h6 id="1-7-39990">| 1 | 7 | 户外运动 | 自行车 |  399.90 |<a class="headerlink" href="#1-7-39990" title="Permanent link">&para;</a></h6>
<h6 id="2-10-39990">| 2 | 10 | 户外运动 | 骑行装备 |  399.90 |<a class="headerlink" href="#2-10-39990" title="Permanent link">&para;</a></h6>
<h6 id="2-12-49990">| 2 | 12 | 户外运动 | 滑板 |  499.90 |<a class="headerlink" href="#2-12-49990" title="Permanent link">&para;</a></h6>
<h6 id="3-11-79990">| 3 | 11 | 户外运动 | 运动外套 |  799.90 |<a class="headerlink" href="#3-11-79990" title="Permanent link">&para;</a></h6>
<h6 id="3-8-139990">| 3 | 8 | 户外运动 | 山地自行车 | 1399.90 |<a class="headerlink" href="#3-8-139990" title="Permanent link">&para;</a></h6>
<h6 id="-_7">+----+----+---------------+------------+---------+<a class="headerlink" href="#-_7" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>12 rows in set (0.00 sec)
</code></pre></div>
<h6 id="with-cte">WITH CTE名称<a class="headerlink" href="#with-cte" title="Permanent link">&para;</a></h6>
<h6 id="as">AS （子查询）<a class="headerlink" href="#as" title="Permanent link">&para;</a></h6>
<h6 id="selectdeleteupdate">SELECT|DELETE|UPDATE 语句;<a class="headerlink" href="#selectdeleteupdate" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT * FROM departments
-&gt; WHERE department_id IN (
-&gt;  SELECT DISTINCT department_id
-&gt;  FROM employees
-&gt; );
+---------------+------------------+------------+-------------+
| department_id | department_name | manager_id | location_id |
+---------------+------------------+------------+-------------+
| 10 | Administration | 200 | 1700 |
| 20 | Marketing | 201 | 1800 |
| 30 | Purchasing | 114 | 1700 |
| 40 | Human Resources | 203 | 2400 |
| 50 | Shipping | 121 | 1500 |
| 60 | IT | 103 | 1400 |
| 70 | Public Relations | 204 | 2700 |
| 80 | Sales | 145 | 2500 |
| 90 | Executive | 100 | 1700 |
| 100 | Finance | 108 | 1700 |
| 110 | Accounting | 205 | 1700 |
+---------------+------------------+------------+-------------+
11 rows in set (0.00 sec)
</code></pre></div>
<h5 id="_54">这个查询也可以用普通公用表表达式的方式完成：<a class="headerlink" href="#_54" title="Permanent link">&para;</a></h5>
<h5 id="_55">例子说明，公用表表达式可以起到子查询的作用。以后如果遇到需要使用子查询的场景，你可以在查询<a class="headerlink" href="#_55" title="Permanent link">&para;</a></h5>
<h5 id="_56">之前，先定义公用表表达式，然后在查询中用它来代替子查询。而且，跟子查询相比，公用表表达式有<a class="headerlink" href="#_56" title="Permanent link">&para;</a></h5>
<h5 id="_57">一个优点，就是定义过公用表表达式之后的查询，可以像一个表一样多次引用公用表表达式，而子查询<a class="headerlink" href="#_57" title="Permanent link">&para;</a></h5>
<h5 id="_58">则不能。<a class="headerlink" href="#_58" title="Permanent link">&para;</a></h5>
<h3 id="3-2_1">3. 2 递归公用表表达式<a class="headerlink" href="#3-2_1" title="Permanent link">&para;</a></h3>
<h5 id="_59">递归公用表表达式也是一种公用表表达式，只不过，除了普通公用表表达式的特点以外，它还有自己的<a class="headerlink" href="#_59" title="Permanent link">&para;</a></h5>
<h5 id="_60">特点，就是 可以调用自己 。它的语法结构是：<a class="headerlink" href="#_60" title="Permanent link">&para;</a></h5>
<h5 id="2-union-all">递归公用表表达式由 2 部分组成，分别是种子查询和递归查询，中间通过关键字 UNION [ALL]进行连接。<a class="headerlink" href="#2-union-all" title="Permanent link">&para;</a></h5>
<h5 id="_61">这里的 种子查询，意思就是获得递归的初始值 。这个查询只会运行一次，以创建初始数据集，之后递归<a class="headerlink" href="#_61" title="Permanent link">&para;</a></h5>
<h5 id="_62">查询会一直执行，直到没有任何新的查询数据产生，递归返回。<a class="headerlink" href="#_62" title="Permanent link">&para;</a></h5>
<h5 id="employeesemployee_idlast_namemanager_idab">案例： 针对于我们常用的employees表，包含employee_id，last_name和manager_id三个字段。如果a是b<a class="headerlink" href="#employeesemployee_idlast_namemanager_idab" title="Permanent link">&para;</a></h5>
<h5 id="babccba">的管理者，那么，我们可以把b叫做a的下属，如果同时b又是c的管理者，那么c就是b的下属，是a的下下<a class="headerlink" href="#babccba" title="Permanent link">&para;</a></h5>
<h5 id="_63">属。<a class="headerlink" href="#_63" title="Permanent link">&para;</a></h5>
<h5 id="_64">下面我们尝试用查询语句列出所有具有下下属身份的人员信息。<a class="headerlink" href="#_64" title="Permanent link">&para;</a></h5>
<h5 id="4_1">如果用我们之前学过的知识来解决，会比较复杂，至少要进行 4 次查询才能搞定：<a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h5>
<h5 id="_65">第一步，先找出初代管理者，就是不以任何别人为管理者的人，把结果存入临时表；<a class="headerlink" href="#_65" title="Permanent link">&para;</a></h5>
<h5 id="_66">第二步，找出所有以初代管理者为管理者的人，得到一个下属集，把结果存入临时表；<a class="headerlink" href="#_66" title="Permanent link">&para;</a></h5>
<h5 id="_67">第三步，找出所有以下属为管理者的人，得到一个下下属集，把结果存入临时表。<a class="headerlink" href="#_67" title="Permanent link">&para;</a></h5>
<h5 id="_68">第四步，找出所有以下下属为管理者的人，得到一个结果集。<a class="headerlink" href="#_68" title="Permanent link">&para;</a></h5>
<h5 id="_69">如果第四步的结果集为空，则计算结束，第三步的结果集就是我们需要的下下属集了，否则就必须继续<a class="headerlink" href="#_69" title="Permanent link">&para;</a></h5>
<h5 id="_70">进行第四步，一直到结果集为空为止。比如上面的这个数据表，就需要到第五步，才能得到空结果集。<a class="headerlink" href="#_70" title="Permanent link">&para;</a></h5>
<h5 id="_71">而且，最后还要进行第六步：把第三步和第四步的结果集合并，这样才能最终获得我们需要的结果集。<a class="headerlink" href="#_71" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>mysql&gt; WITH emp_dept_id
-&gt; AS (SELECT DISTINCT department_id FROM employees)
-&gt; SELECT *
-&gt; FROM departments d JOIN emp_dept_id e
-&gt; ON d.department_id = e.department_id;
+---------------+------------------+------------+-------------+---------------+
| department_id | department_name | manager_id | location_id | department_id |
+---------------+------------------+------------+-------------+---------------+
| 90 | Executive | 100 | 1700 | 90 |
| 60 | IT | 103 | 1400 | 60 |
| 100 | Finance | 108 | 1700 | 100 |
| 30 | Purchasing | 114 | 1700 | 30 |
| 50 | Shipping | 121 | 1500 | 50 |
| 80 | Sales | 145 | 2500 | 80 |
| 10 | Administration | 200 | 1700 | 10 |
| 20 | Marketing | 201 | 1800 | 20 |
| 40 | Human Resources | 203 | 2400 | 40 |
| 70 | Public Relations | 204 | 2700 | 70 |
| 110 | Accounting | 205 | 1700 | 110 |
+---------------+------------------+------------+-------------+---------------+
11 rows in set (0.00 sec)
</code></pre></div>
<h6 id="with-recursive">WITH RECURSIVE<a class="headerlink" href="#with-recursive" title="Permanent link">&para;</a></h6>
<h6 id="cte-as">CTE名称 AS （子查询）<a class="headerlink" href="#cte-as" title="Permanent link">&para;</a></h6>
<h6 id="selectdeleteupdate_1">SELECT|DELETE|UPDATE 语句;<a class="headerlink" href="#selectdeleteupdate_1" title="Permanent link">&para;</a></h6>
<h5 id="_72">如果用递归公用表表达式，就非常简单了。我介绍下具体的思路。<a class="headerlink" href="#_72" title="Permanent link">&para;</a></h5>
<h5 id="n-1">用递归公用表表达式中的种子查询，找出初代管理者。字段 n 表示代次，初始值为 1 ，表示是第一<a class="headerlink" href="#n-1" title="Permanent link">&para;</a></h5>
<h5 id="_73">代管理者。<a class="headerlink" href="#_73" title="Permanent link">&para;</a></h5>
<h5 id="_74">用递归公用表表达式中的递归查询，查出以这个递归公用表表达式中的人为管理者的人，并且代次<a class="headerlink" href="#_74" title="Permanent link">&para;</a></h5>
<h5 id="1_2">的值加 1 。直到没有人以这个递归公用表表达式中的人为管理者了，递归返回。<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h5>
<h5 id="3_1">在最后的查询中，选出所有代次大于等于 3 的人，他们肯定是第三代及以上代次的下属了，也就是<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h5>
<h5 id="_75">下下属了。这样就得到了我们需要的结果集。<a class="headerlink" href="#_75" title="Permanent link">&para;</a></h5>
<h5 id="3-3">这里看似也是 3 步，实际上是一个查询的 3 个部分，只需要执行一次就可以了。而且也不需要用临时表<a class="headerlink" href="#3-3" title="Permanent link">&para;</a></h5>
<h5 id="_76">保存中间结果，比刚刚的方法简单多了。<a class="headerlink" href="#_76" title="Permanent link">&para;</a></h5>
<h5 id="_77">代码实现：<a class="headerlink" href="#_77" title="Permanent link">&para;</a></h5>
<h5 id="_78">总之，递归公用表表达式对于查询一个有共同的根节点的树形结构数据，非常有用。它可以不受层级的<a class="headerlink" href="#_78" title="Permanent link">&para;</a></h5>
<h5 id="_79">限制，轻松查出所有节点的数据。如果用其他的查询方式，就比较复杂了。<a class="headerlink" href="#_79" title="Permanent link">&para;</a></h5>
<h3 id="3-3_1">3. 3 小 结<a class="headerlink" href="#3-3_1" title="Permanent link">&para;</a></h3>
<h5 id="_80">公用表表达式的作用是可以替代子查询，而且可以被多次引用。递归公用表表达式对查询有一个共同根<a class="headerlink" href="#_80" title="Permanent link">&para;</a></h5>
<h5 id="_81">节点的树形结构数据非常高效，可以轻松搞定其他查询方式难以处理的查询。<a class="headerlink" href="#_81" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>WITH RECURSIVE cte
AS
(
SELECT employee_id,last_name,manager_id, 1 AS n FROM employees WHERE employee_id = 100
-- 种子查询，找到第一代领导
UNION ALL
SELECT a.employee_id,a.last_name,a.manager_id,n+ 1 FROM employees AS a JOIN cte
ON (a.manager_id = cte.employee_id) -- 递归查询，找出以递归公用表表达式的人为领导的人
)
SELECT employee_id,last_name FROM cte WHERE n &gt;= 3 ;
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "header.autohide"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../../../../mkdocs/javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>