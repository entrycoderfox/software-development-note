
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="entrycoder的软件开发记事本">
      
      
        <meta name="author" content="entrycoder">
      
      
      
        <link rel="prev" href="../%E7%AC%AC15%E7%AB%A0_%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E5%87%BD%E6%95%B0/">
      
      
        <link rel="next" href="../%E7%AC%AC17%E7%AB%A0_%E8%A7%A6%E5%8F%91%E5%99%A8/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.15">
    
    
      
        <title>第16章_变量、流程控制与游标 - entrycoder的软件开发记事本</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../mkdocs/css/no-footer.css">
    
      <link rel="stylesheet" href="../../../../../mkdocs/css/unordered-list-symbols.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#16-_" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="entrycoder的软件开发记事本" class="md-header__button md-logo" aria-label="entrycoder的软件开发记事本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            entrycoder的软件开发记事本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第16章_变量、流程控制与游标
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../Environment/" class="md-tabs__link">
        系统环境
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../" class="md-tabs__link md-tabs__link--active">
        数据库
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        关于
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="entrycoder的软件开发记事本" class="md-nav__button md-logo" aria-label="entrycoder的软件开发记事本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    entrycoder的软件开发记事本
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../Environment/">系统环境</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          系统环境
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_2" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
          前端
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          前端
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Environment/front_end/vue_on_kylin/" class="md-nav__link">
        在Kylin上安装VUE-CLI等
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../">数据库</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          RDBMS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          RDBMS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" checked>
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
          MySQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2_1">
          <span class="md-nav__icon md-icon"></span>
          MySQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1_1" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2_1_1" id="__nav_2_2_1_1_label" tabindex="0">
          MySQ教程 尚硅谷
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_1_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2_1_1">
          <span class="md-nav__icon md-icon"></span>
          MySQ教程 尚硅谷
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BD%9C%E8%80%85%E7%9A%84%E8%AF%9D/" class="md-nav__link">
        作者的话
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BF%AE%E6%94%B9%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        修改记录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../%E7%9B%AE%E5%BD%95/" class="md-nav__link">
        目录
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1_1_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2_1_1_4" id="__nav_2_2_1_1_4_label" tabindex="0">
          文档-基础篇
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_2_1_1_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2_1_1_4">
          <span class="md-nav__icon md-icon"></span>
          文档-基础篇
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC00%E7%AB%A0_%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2/" class="md-nav__link">
        第00章_写在前面
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC01%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        第01章_数据库概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC02%E7%AB%A0_MySQL%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        第02章_MySQL环境搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC03%E7%AB%A0_%E5%9F%BA%E6%9C%AC%E7%9A%84SELECT%E8%AF%AD%E5%8F%A5/" class="md-nav__link">
        第03章_基本的SELECT语句
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC04%E7%AB%A0_%E8%BF%90%E7%AE%97%E7%AC%A6/" class="md-nav__link">
        第04章_运算符
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC05%E7%AB%A0_%E6%8E%92%E5%BA%8F%E4%B8%8E%E5%88%86%E9%A1%B5/" class="md-nav__link">
        第05章_排序与分页
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC06%E7%AB%A0_%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        第06章_多表查询
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC07%E7%AB%A0_%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0/" class="md-nav__link">
        第07章_单行函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC08%E7%AB%A0_%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0/" class="md-nav__link">
        第08章_聚合函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC09%E7%AB%A0_%E5%AD%90%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        第09章_子查询
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC10%E7%AB%A0_%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8/" class="md-nav__link">
        第10章_创建和管理表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC11%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B9%8B%E5%A2%9E%E5%88%A0%E6%94%B9/" class="md-nav__link">
        第11章_数据处理之增删改
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC12%E7%AB%A0_MySQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%B2%BE%E8%AE%B2/" class="md-nav__link">
        第12章_MySQL数据类型精讲
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC13%E7%AB%A0_%E7%BA%A6%E6%9D%9F/" class="md-nav__link">
        第13章_约束
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC14%E7%AB%A0_%E8%A7%86%E5%9B%BE/" class="md-nav__link">
        第14章_视图
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC15%E7%AB%A0_%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E5%87%BD%E6%95%B0/" class="md-nav__link">
        第15章_存储过程与函数
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          第16章_变量、流程控制与游标
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        第16章_变量、流程控制与游标
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    讲师：尚硅谷-宋红康（江湖人称：康师傅）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#httpwwwatguigucom" class="md-nav__link">
    官网： http://www.atguigu.com
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 变量
  </a>
  
    <nav class="md-nav" aria-label="1. 变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    在MySQL数据库的存储过程和函数中，可以使用变量来存储查询或计算的中间结果数据，或者输出最终
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    的结果数据。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_1" class="md-nav__link">
    在 MySQL 数据库中，变量分为系统变量以及用户自定义变量。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-1" class="md-nav__link">
    1. 1 系统变量
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-1-1" class="md-nav__link">
    1. 1. 1 系统变量分类
  </a>
  
    <nav class="md-nav" aria-label="1. 1. 1 系统变量分类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysqlmysql" class="md-nav__link">
    变量由系统定义，不是用户定义，属于服务器层面。启动MySQL服务，生成MySQL服务实例期间，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmysqlmysql" class="md-nav__link">
    MySQL将为MySQL服务器内存中的系统变量赋值，这些系统变量定义了当前MySQL服务实例的属性、特
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmyini" class="md-nav__link">
    征。这些系统变量的值要么是编译MySQL时参数的默认值，要么是配置文件（例如my.ini等）中的参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httpsdevmysqlcomdocrefman80enserver-system-" class="md-nav__link">
    值。大家可以通过网址 https://dev.mysql.com/doc/refman/8.0/en/server-system-
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variableshtml-mysql" class="md-nav__link">
    variables.html 查看MySQL文档的系统变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-session" class="md-nav__link">
    系统变量分为全局系统变量（需要添加global 关键字）以及会话系统变量（需要添加 session 关键
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local" class="md-nav__link">
    字），有时也把全局系统变量简称为全局变量，有时也把会话系统变量称为local变量。 如果不写，默认
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-set" class="md-nav__link">
    会话级别。 静态变量（在 MySQL 服务实例运行期间它们的值不能使用 set 动态修改）属于特殊的全局系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    统变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmysqlmysql_1" class="md-nav__link">
    每一个MySQL客户机成功连接MySQL服务器后，都会产生与之对应的会话。会话期间，MySQL服务实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_2" class="md-nav__link">
    会在MySQL服务器内存中生成与该会话对应的会话系统变量，这些会话系统变量的初始值是全局系统变
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    量值的复制。如下图：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    全局系统变量针对于所有会话（连接）有效，但不能跨重启
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    会话系统变量仅针对于当前会话（连接）有效。会话期间，当前会话对某个会话系统变量值的修
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    改，不会影响其他会话同一个会话系统变量的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2" class="md-nav__link">
    会话 1 对某个全局系统变量值的修改会导致会话 2 中同一个全局系统变量值的修改。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-max_connections" class="md-nav__link">
    在MySQL中有些系统变量只能是全局的，例如 max_connections 用于限制服务器的最大连接数；有些系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#character_set_client" class="md-nav__link">
    统变量作用域既可以是全局又可以是会话，例如 character_set_client 用于设置客户端的字符集；有些系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pseudo_thread_id-mysql-id" class="md-nav__link">
    统变量的作用域只能是当前会话，例如 pseudo_thread_id 用于标记当前会话的 MySQL 连接 ID。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-1-2" class="md-nav__link">
    1. 1. 2 查看系统变量
  </a>
  
    <nav class="md-nav" aria-label="1. 1. 2 查看系统变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    查看所有或部分系统变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    举例：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    查看指定系统变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-mysql-global" class="md-nav__link">
    作为 MySQL 编码规范，MySQL 中的系统变量以两个“@”开头，其中“@@global”仅用于标记全局系统变
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session" class="md-nav__link">
    量，“@@session”仅用于标记会话系统变量。“@@”首先标记会话系统变量，如果会话系统变量不存在，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    则标记全局系统变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    修改系统变量的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_3" class="md-nav__link">
    有些时候，数据库管理员需要修改系统变量的默认值，以便修改当前会话或者MySQL服务实例的属性、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    特征。具体方法：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-mysqlmysqlmysql" class="md-nav__link">
    方式 1 ：修改MySQL配置文件，继而修改MySQL系统变量的值（该方法需要重启MySQL服务）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mysqlset" class="md-nav__link">
    方式 2 ：在MySQL服务运行期间，使用“set”命令重新设置系统变量的值
  </a>
  
    <nav class="md-nav" aria-label="方式 2 ：在MySQL服务运行期间，使用“set”命令重新设置系统变量的值">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    #查看所有全局变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-global-variables" class="md-nav__link">
    SHOW GLOBAL VARIABLES;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    #查看所有会话变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-session-variables" class="md-nav__link">
    SHOW SESSION VARIABLES;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    或
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-variables" class="md-nav__link">
    SHOW VARIABLES;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    #查看满足条件的部分系统变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-global-variables-like" class="md-nav__link">
    SHOW GLOBAL VARIABLES LIKE '%标识符%';
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    #查看满足条件的部分会话变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-session-variables-like" class="md-nav__link">
    SHOW SESSION VARIABLES LIKE '%标识符%';
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    #查看指定的系统变量的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    #查看指定的会话变量的值
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    举例：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2_1" class="md-nav__link">
    1. 2 用户变量
  </a>
  
    <nav class="md-nav" aria-label="1. 2 用户变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-2-1" class="md-nav__link">
    1. 2. 1 用户变量分类
  </a>
  
    <nav class="md-nav" aria-label="1. 2. 1 用户变量分类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql-mysql" class="md-nav__link">
    用户变量是用户自己定义的，作为 MySQL 编码规范，MySQL 中的用户变量以一个“@”开头。根据作用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    范围不同，又分为会话用户变量和局部变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    会话用户变量：作用域和会话变量一样，只对当前连接会话有效。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-end" class="md-nav__link">
    局部变量：只在 BEGIN 和 END 语句块中有效。局部变量只能在存储过程和函数中使用。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-2" class="md-nav__link">
    1. 2. 2 会话用户变量
  </a>
  
    <nav class="md-nav" aria-label="1. 2. 2 会话用户变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    变量的定义
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    查看用户变量的值 （查看、比较、运算等）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    举例
  </a>
  
    <nav class="md-nav" aria-label="举例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    #为某个系统变量赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    #方式 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    #为某个会话变量赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    #方式 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    #方式 1 ：“=”或“:=”
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    SET @用户变量 = 值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_1" class="md-nav__link">
    SET @用户变量 := 值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-into" class="md-nav__link">
    #方式 2 ：“:=” 或 INTO关键字
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-from" class="md-nav__link">
    SELECT @用户变量 := 表达式 [FROM 等子句];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-into-from" class="md-nav__link">
    SELECT 表达式 INTO @用户变量 [FROM 等子句];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    SELECT @用户变量
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-3" class="md-nav__link">
    1. 2. 3 局部变量
  </a>
  
    <nav class="md-nav" aria-label="1. 2. 3 局部变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declare" class="md-nav__link">
    定义：可以使用DECLARE语句定义一个局部变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-end_1" class="md-nav__link">
    作用域：仅仅在定义它的 BEGIN ... END 中有效
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-end_2" class="md-nav__link">
    位置：只能放在 BEGIN ... END 中，而且只能放在第一句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    1 .定义变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    举例：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 .变量赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    方式 1 ：一般用于赋简单的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    方式 2 ：一般用于赋表中的字段值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3 .使用变量 （查看、比较、运算等）
  </a>
  
    <nav class="md-nav" aria-label="3 .使用变量 （查看、比较、运算等）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#begin" class="md-nav__link">
    BEGIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    #声明局部变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare-1-default" class="md-nav__link">
    DECLARE 变量名 1 变量数据类型 [DEFAULT 变量默认值];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare-23-default" class="md-nav__link">
    DECLARE 变量名2,变量名3,... 变量数据类型 [DEFAULT 变量默认值];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    #为局部变量赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-1" class="md-nav__link">
    SET 变量名1 = 值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-into-2-from" class="md-nav__link">
    SELECT 值 INTO 变量名2 [FROM 子句];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    #查看局部变量的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-123" class="md-nav__link">
    SELECT 变量1,变量2,变量3;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end" class="md-nav__link">
    END
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_2" class="md-nav__link">
    SET 变量名=值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_3" class="md-nav__link">
    SET 变量名:=值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-into-from_1" class="md-nav__link">
    SELECT 字段名或表达式 INTO 变量名 FROM 表;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select_1" class="md-nav__link">
    SELECT 局部变量名;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-employeesemployee_id-102-last_namesalary" class="md-nav__link">
    举例 1 ：声明局部变量，并分别赋值为employees表中employee_id为 102 的last_name和salary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    举例 2 ：声明两个变量，求和并打印 （分别使用会话用户变量、局部变量的方式实现）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-different_salaryinemp_id" class="md-nav__link">
    举例 3 ：创建存储过程“different_salary”查询某员工和他领导的薪资差距，并用IN参数emp_id接收员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idoutdif_salary" class="md-nav__link">
    id，用OUT参数dif_salary输出薪资差距结果。
  </a>
  
    <nav class="md-nav" aria-label="id，用OUT参数dif_salary输出薪资差距结果。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_1" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    #方式 1 ：使用用户变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    #方式 2 ：使用局部变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_2" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_3" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    #声明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_4" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-4" class="md-nav__link">
    1. 2. 4 对比会话用户变量与局部变量
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    2. 定义条件与处理程序
  </a>
  
    <nav class="md-nav" aria-label="2. 定义条件与处理程序">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    定义条件是事先定义程序执行过程中可能遇到的问题，处理程序定义了在遇到问题时应当采取的处理方
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    式，并且保证存储过程或函数在遇到警告或错误时能继续执行。这样可以增强存储程序处理问题的能
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    力，避免程序异常停止运行。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    说明：定义条件和处理程序在存储过程、存储函数中都是支持的。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-1" class="md-nav__link">
    2. 1 案例分析
  </a>
  
    <nav class="md-nav" aria-label="2. 1 案例分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updatedatanocondition" class="md-nav__link">
    案例分析： 创建一个名称为“UpdateDataNoCondition”的存储过程。代码如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    调用存储过程：
  </a>
  
    <nav class="md-nav" aria-label="调用存储过程：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#end_1" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_5" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    #调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    #查看
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    作用域 定义位置 语法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    会话用户变量 当前会话 会话的任何地方 加@符号，不用指定类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-end-begin-end" class="md-nav__link">
    局部变量 定义它的BEGIN END中 BEGIN END的第一句话 一般不用加@,需要指定类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_6" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_7" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#x-1-sql" class="md-nav__link">
    可以看到，此时@x变量的值为 1 。结合创建存储过程的SQL语句代码可以得出：在存储过程中未定义条件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlmysqlsql" class="md-nav__link">
    和处理程序，且当存储过程中执行的SQL语句报错时，MySQL数据库会抛出错误，并退出当前SQL逻辑，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    不再向下继续执行。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2" class="md-nav__link">
    2. 2 定义条件
  </a>
  
    <nav class="md-nav" aria-label="2. 2 定义条件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql_4" class="md-nav__link">
    定义条件就是给MySQL中的错误码命名，这有助于存储的程序代码更清晰。它将一个错误名字和指定的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare-handler" class="md-nav__link">
    错误条件关联起来。这个名字可以随后被用在定义处理程序的DECLARE HANDLER语句中。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare_1" class="md-nav__link">
    定义条件使用DECLARE语句，语法格式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    错误码的说明：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_error_codesqlstate_valuemysql" class="md-nav__link">
    MySQL_error_code和sqlstate_value都可以表示MySQL的错误。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_error_code" class="md-nav__link">
    MySQL_error_code是数值类型错误代码。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlstate_value-5" class="md-nav__link">
    sqlstate_value是长度为 5 的字符串类型错误代码。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-1418-hy000-1418-mysql_error_codehy000sqlstate_value" class="md-nav__link">
    例如，在ERROR 1418 (HY000)中， 1418 是MySQL_error_code，'HY000'是sqlstate_value。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-1142-42000-1142-mysql_error_code42000sqlstate_value" class="md-nav__link">
    例如，在ERROR 1142（ 42000 ）中， 1142 是MySQL_error_code，'42000'是sqlstate_value。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-field_not_be_nullmysqlerror-1048-23000" class="md-nav__link">
    举例 1 ： 定义“Field_Not_Be_NULL”错误名与MySQL中违反非空约束的错误类型是“ERROR 1048 (23000)”对
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    应。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-error-114842000command_not_allowed" class="md-nav__link">
    举例 2 ： 定义"ERROR 1148(42000)"错误，名称为command_not_allowed。
  </a>
  
    <nav class="md-nav" aria-label="举例 2 ： 定义"ERROR 1148(42000)"错误，名称为command_not_allowed。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declare-condition-for" class="md-nav__link">
    DECLARE 错误名称 CONDITION FOR 错误码（或错误条件）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3" class="md-nav__link">
    2. 3 定义处理程序
  </a>
  
    <nav class="md-nav" aria-label="2. 3 定义处理程序">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sqldeclare" class="md-nav__link">
    可以为SQL执行过程中发生的某种类型的错误定义特殊的处理程序。定义处理程序时，使用DECLARE语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    的语法如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-continueexitundo" class="md-nav__link">
    处理方式 ：处理方式有 3 个取值：CONTINUE、EXIT、UNDO。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    CONTINUE：表示遇到错误不处理，继续执行。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exit" class="md-nav__link">
    EXIT：表示遇到错误马上退出。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#undomysql" class="md-nav__link">
    UNDO：表示遇到错误后撤回之前的操作。MySQL中暂时不支持这样的操作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    错误类型 （即条件）可以有如下取值：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlstate-5-sqlstate_value" class="md-nav__link">
    SQLSTATE '字符串错误码'：表示长度为 5 的sqlstate_value类型的错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_error_code_1" class="md-nav__link">
    MySQL_error_code：匹配数值类型错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare-condition" class="md-nav__link">
    错误名称：表示DECLARE ... CONDITION定义的错误条件名称。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlwarning-01-sqlstate" class="md-nav__link">
    SQLWARNING：匹配所有以 01 开头的SQLSTATE错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#not-found-02-sqlstate" class="md-nav__link">
    NOT FOUND：匹配所有以 02 开头的SQLSTATE错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlexceptionsqlwarningnot-foundsqlstate" class="md-nav__link">
    SQLEXCEPTION：匹配所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    处理语句 ：如果出现上述条件之一，则采用对应的处理方式，并执行指定的处理语句。语句可以是
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-begin-end" class="md-nav__link">
    像“SET 变量 = 值”这样的简单语句，也可以是使用BEGIN ... END编写的复合语句。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    定义处理程序的几种方式，代码如下：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4" class="md-nav__link">
    2. 4 案例解决
  </a>
  
    <nav class="md-nav" aria-label="2. 4 案例解决">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sqlstate_valuemysql_error_code-1048" class="md-nav__link">
    在存储过程中，定义处理程序，捕获sqlstate_value值，当遇到MySQL_error_code值为 1048 时，执行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continueproc_value-1" class="md-nav__link">
    CONTINUE操作，并且将@proc_value的值设置为-1。
  </a>
  
    <nav class="md-nav" aria-label="CONTINUE操作，并且将@proc_value的值设置为-1。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declare-handler-for" class="md-nav__link">
    DECLARE 处理方式 HANDLER FOR 错误类型 处理语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    #方法 3 ：先定义条件，再调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-sqlwarning" class="md-nav__link">
    #方法 4 ：使用SQLWARNING
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-not-found" class="md-nav__link">
    #方法 5 ：使用NOT FOUND
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-sqlexception" class="md-nav__link">
    #方法 6 ：使用SQLEXCEPTION
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_8" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    调用过程：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    举例：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insertdatawithcondition" class="md-nav__link">
    创建一个名称为“InsertDataWithCondition”的存储过程，代码如下。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlstate_valuesqlstate_value-23000-exit" class="md-nav__link">
    在存储过程中，定义处理程序，捕获sqlstate_value值，当遇到sqlstate_value值为 23000 时，执行EXIT操
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proc_value-1" class="md-nav__link">
    作，并且将@proc_value的值设置为-1。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    调用存储过程：
  </a>
  
    <nav class="md-nav" aria-label="调用存储过程：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_9" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    #准备工作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_10" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_11" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    3. 流程控制
  </a>
  
    <nav class="md-nav" aria-label="3. 流程控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-sql" class="md-nav__link">
    解决复杂问题不可能通过一个 SQL 语句完成，我们需要执行多个 SQL 操作。流程控制语句的作用就是控
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    制存储过程中 SQL 语句的执行顺序，是我们完成复杂操作必不可少的一部分。只要是执行的程序，流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    就分为三大类：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    顺序结构：程序从上往下依次执行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    分支结构：程序按条件进行选择执行，从两条或多条路径中选择一条执行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    循环结构：程序满足一定条件下，重复执行一组语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-3" class="md-nav__link">
    针对于MySQL 的流程控制语句主要有 3 类。注意：只能用于存储程序。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-case" class="md-nav__link">
    条件判断语句：IF 语句和 CASE 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loopwhile-repeat" class="md-nav__link">
    循环语句：LOOP、WHILE 和 REPEAT 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterate-leave" class="md-nav__link">
    跳转语句：ITERATE 和 LEAVE 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-1-if" class="md-nav__link">
    3. 1 分支结构之 IF
  </a>
  
    <nav class="md-nav" aria-label="3. 1 分支结构之 IF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if" class="md-nav__link">
    IF 语句的语法结构是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#truefalse" class="md-nav__link">
    根据表达式的结果为TRUE或FALSE执行相应的语句。这里“[]”中的内容是可选的。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-begin-end" class="md-nav__link">
    特点：① 不同的表达式对应不同的操作 ② 使用在begin end中
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-update_salary_by_eid1inemp_id" class="md-nav__link">
    举例 2 ： 声明存储过程“update_salary_by_eid1”，定义IN参数emp_id，输入员工编号。判断该员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8000-5-500" class="md-nav__link">
    薪资如果低于 8000 元并且入职时间超过 5 年，就涨薪 500 元；否则就不变。
  </a>
  
    <nav class="md-nav" aria-label="薪资如果低于 8000 元并且入职时间超过 5 年，就涨薪 500 元；否则就不变。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-1-then-1" class="md-nav__link">
    IF 表达式 1 THEN 操作 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elseif-2-then-2" class="md-nav__link">
    [ELSEIF 表达式 2 THEN 操作2]......
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#else-n" class="md-nav__link">
    [ELSE 操作N]
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-if" class="md-nav__link">
    END IF
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-if_1" class="md-nav__link">
    END IF;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_12" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-update_salary_by_eid2inemp_id" class="md-nav__link">
    举例 3 ： 声明存储过程“update_salary_by_eid2”，定义IN参数emp_id，输入员工编号。判断该员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9000-5-500-100" class="md-nav__link">
    薪资如果低于 9000 元并且入职时间超过 5 年，就涨薪 500 元；否则就涨薪 100 元。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-update_salary_by_eid3inemp_id" class="md-nav__link">
    举例 4 ： 声明存储过程“update_salary_by_eid3”，定义IN参数emp_id，输入员工编号。判断该员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9000-9000-9000-10000" class="md-nav__link">
    薪资如果低于 9000 元，就更新薪资为 9000 元；薪资如果大于等于 9000 元且低于 10000 的，但是奖金
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#null001-100" class="md-nav__link">
    比例为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。
  </a>
  
    <nav class="md-nav" aria-label="比例为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_13" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_14" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_15" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_16" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-case" class="md-nav__link">
    3. 2 分支结构之 CASE
  </a>
  
    <nav class="md-nav" aria-label="3. 2 分支结构之 CASE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-1" class="md-nav__link">
    CASE 语句的语法结构 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-2" class="md-nav__link">
    CASE 语句的语法结构 2 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-1-val-1-2" class="md-nav__link">
    使用CASE流程控制语句的第 1 种格式，判断val值等于 1 、等于 2 ，或者两者都不等。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    举例 2 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-2-val-0-0-0" class="md-nav__link">
    使用CASE流程控制语句的第 2 种格式，判断val是否为空、小于 0 、大于 0 或者等于 0 。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-update_salary_by_eid4inemp_id" class="md-nav__link">
    举例 3 ： 声明存储过程“update_salary_by_eid4”，定义IN参数emp_id，输入员工编号。判断该员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9000-9000-9000-10000_1" class="md-nav__link">
    薪资如果低于 9000 元，就更新薪资为 9000 元；薪资大于等于 9000 元且低于 10000 的，但是奖金比例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#null001-100_1" class="md-nav__link">
    为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。
  </a>
  
    <nav class="md-nav" aria-label="为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_17" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case" class="md-nav__link">
    CASE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_18" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-update_salary_by_eid5inemp_id" class="md-nav__link">
    举例 4 ：声明存储过程update_salary_by_eid5，定义IN参数emp_id，输入员工编号。判断该员工的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0-50-1-100-2-200-3" class="md-nav__link">
    入职年限，如果是 0 年，薪资涨 50 ；如果是 1 年，薪资涨 100 ；如果是 2 年，薪资涨 200 ；如果是 3 年，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#300-4-400-500" class="md-nav__link">
    薪资涨 300 ；如果是 4 年，薪资涨 400 ；其他的涨薪 500 。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3-loop" class="md-nav__link">
    3. 3 循环结构之LOOP
  </a>
  
    <nav class="md-nav" aria-label="3. 3 循环结构之LOOP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#looploopleave" class="md-nav__link">
    LOOP循环语句用来重复执行某些语句。LOOP内的语句一直重复执行直到循环被退出（使用LEAVE子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    句），跳出循环过程。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop" class="md-nav__link">
    LOOP语句的基本格式如下：
  </a>
  
    <nav class="md-nav" aria-label="LOOP语句的基本格式如下：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case_1" class="md-nav__link">
    CASE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_19" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_20" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_21" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop_labelloop" class="md-nav__link">
    其中，loop_label表示LOOP语句的标注名称，该参数可以省略。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loopid-10" class="md-nav__link">
    使用LOOP语句进行循环操作，id值小于 10 时将重复执行循环过程。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_6" class="md-nav__link">
    举例 2 ： 当市场环境变好时，公司为了奖励大家，决定给大家涨工资。声明存储过程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_salary_loopoutnum" class="md-nav__link">
    “update_salary_loop()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨为
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-12000" class="md-nav__link">
    原来的1.1倍。直到全公司的平均薪资达到 12000 结束。并统计循环次数。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-4-while" class="md-nav__link">
    3. 4 循环结构之WHILE
  </a>
  
    <nav class="md-nav" aria-label="3. 4 循环结构之WHILE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whilewhile" class="md-nav__link">
    WHILE语句创建一个带条件判断的循环过程。WHILE在执行语句执行时，先对指定的表达式进行判断，如
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#while" class="md-nav__link">
    果为真，就执行循环内的语句，否则退出循环。WHILE语句的基本格式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#while_labelwhilewhile" class="md-nav__link">
    while_label为WHILE语句的标注名称；如果循环条件结果为真，WHILE语句内的语句或语句群被执行，直
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    至循环条件为假，退出循环。
  </a>
  
    <nav class="md-nav" aria-label="至循环条件为假，退出循环。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_22" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_2" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_23" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_10" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whilei-10" class="md-nav__link">
    WHILE语句示例，i值小于 10 时，将重复执行循环过程，代码如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_7" class="md-nav__link">
    举例 2 ： 市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。声明存储过程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_salary_whileoutnum" class="md-nav__link">
    “update_salary_while()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家降薪，薪资降
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#90-5000" class="md-nav__link">
    为原来的90%。直到全公司的平均薪资达到 5000 结束。并统计循环次数。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-5-repeat" class="md-nav__link">
    3. 5 循环结构之REPEAT
  </a>
  
    <nav class="md-nav" aria-label="3. 5 循环结构之REPEAT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repeatwhilerepeat" class="md-nav__link">
    REPEAT语句创建一个带条件判断的循环过程。与WHILE循环不同的是，REPEAT 循环首先会执行一次循
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#until-end-repeat" class="md-nav__link">
    环，然后在 UNTIL 中进行表达式的判断，如果满足条件就退出，即 END REPEAT；如果条件不满足，则会
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    就继续执行循环，直到满足退出条件为止。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat" class="md-nav__link">
    REPEAT语句的基本格式如下：
  </a>
  
    <nav class="md-nav" aria-label="REPEAT语句的基本格式如下：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_24" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_25" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    #调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_26" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_3" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_27" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat_labelrepeatrepeat" class="md-nav__link">
    repeat_label为REPEAT语句的标注名称，该参数可以省略；REPEAT语句内的语句或语句群被重复，直至
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expr_condition" class="md-nav__link">
    expr_condition为真。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_11" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_8" class="md-nav__link">
    举例 2 ： 当市场环境变好时，公司为了奖励大家，决定给大家涨工资。声明存储过程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_salary_repeatoutnum" class="md-nav__link">
    “update_salary_repeat()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-13000" class="md-nav__link">
    为原来的1.15倍。直到全公司的平均薪资达到 13000 结束。并统计循环次数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    对比三种循环结构：
  </a>
  
    <nav class="md-nav" aria-label="对比三种循环结构：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_28" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat_1" class="md-nav__link">
    REPEAT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_29" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_30" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat_2" class="md-nav__link">
    REPEAT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_4" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_31" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-leaveiterate" class="md-nav__link">
    1 、这三种循环都可以省略名称，但如果循环中添加了循环控制语句（LEAVE或ITERATE）则必须添加名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-loop-while-repeat" class="md-nav__link">
    称。 2 、 LOOP：一般用于实现简单的"死"循环 WHILE：先判断后执行 REPEAT：先执行后判断，无条件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    至少执行一次
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-6-leave" class="md-nav__link">
    3. 6 跳转语句之LEAVE语句
  </a>
  
    <nav class="md-nav" aria-label="3. 6 跳转语句之LEAVE语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leave-begin-end" class="md-nav__link">
    LEAVE语句：可以用在循环语句内，或者以 BEGIN 和 END 包裹起来的程序体内，表示跳出循环或者跳出
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leave-break" class="md-nav__link">
    程序体的操作。如果你有面向过程的编程语言的使用经验，你可以把 LEAVE 理解为 break。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    基本格式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labelleavebegin-end" class="md-nav__link">
    其中，label参数表示循环的标志。LEAVE和BEGIN ... END或循环一起被使用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-leave_beginintinnumbeginend" class="md-nav__link">
    举例 1 ： 创建存储过程 “leave_begin()”，声明INT类型的IN参数num。给BEGIN...END加标记名，并在
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beginendifnum" class="md-nav__link">
    BEGIN...END中使用IF语句判断num参数的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num0leavebeginend" class="md-nav__link">
    如果num&lt;=0，则使用LEAVE语句退出BEGIN...END；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num1employees" class="md-nav__link">
    如果num=1，则查询“employees”表的平均薪资；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num2employees" class="md-nav__link">
    如果num=2，则查询“employees”表的最低薪资；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num2employees_1" class="md-nav__link">
    如果num&gt;2，则查询“employees”表的最高薪资。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ifemployees" class="md-nav__link">
    IF语句结束后查询“employees”表的总人数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_9" class="md-nav__link">
    举例 2 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leave_while" class="md-nav__link">
    当市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。声明存储过程“leave_while()”，声明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outnumwhile90" class="md-nav__link">
    OUT参数num，输出循环次数，存储过程中使用WHILE循环给大家降低薪资为原来薪资的90%，直到全公
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10000" class="md-nav__link">
    司的平均薪资小于等于 10000 ，并统计循环次数。
  </a>
  
    <nav class="md-nav" aria-label="司的平均薪资小于等于 10000 ，并统计循环次数。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leave" class="md-nav__link">
    LEAVE 标记名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_32" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_33" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_34" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin_1" class="md-nav__link">
    BEGIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-7-iterate" class="md-nav__link">
    3. 7 跳转语句之ITERATE语句
  </a>
  
    <nav class="md-nav" aria-label="3. 7 跳转语句之ITERATE语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iteratelooprepeatwhile" class="md-nav__link">
    ITERATE语句：只能用在循环语句（LOOP、REPEAT和WHILE语句）内，表示重新开始循环，将执行顺序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterate-continue" class="md-nav__link">
    转到语句段开头处。如果你有面向过程的编程语言的使用经验，你可以把 ITERATE 理解为 continue，意
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    思为“再次循环”。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    语句基本格式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labeliterate" class="md-nav__link">
    label参数表示循环的标志。ITERATE语句必须跟在循环标志前面。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num-0-num-1" class="md-nav__link">
    举例： 定义局部变量num，初始值为 0 。循环结构中执行num + 1操作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num-10" class="md-nav__link">
    如果num &lt; 10，则继续执行循环；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num-15" class="md-nav__link">
    如果num &gt; 15，则退出循环结构；
  </a>
  
    <nav class="md-nav" aria-label="如果num &gt; 15，则退出循环结构；">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    #③ 循环体
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    #④ 迭代条件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-while" class="md-nav__link">
    END WHILE;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    #赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_5" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_35" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_36" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin_2" class="md-nav__link">
    BEGIN
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    4. 游标
  </a>
  
    <nav class="md-nav" aria-label="4. 游标">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-1" class="md-nav__link">
    4. 1 什么是游标（或光标）
  </a>
  
    <nav class="md-nav" aria-label="4. 1 什么是游标（或光标）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#where-having-limit" class="md-nav__link">
    虽然我们也可以通过筛选条件 WHERE 和 HAVING，或者是限定返回记录的关键字 LIMIT 返回一条记录，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    但是，却无法在结果集中像指针一样，向前定位一条记录、向后定位一条记录，或者是随意定位到某一
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    条记录，并对记录的数据进行处理。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    这个时候，就可以用到游标。游标，提供了一种灵活的操作方式，让我们能够对结果集中的每一条记录
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql_1" class="md-nav__link">
    进行定位，并对指向的记录中的数据进行操作的数据结构。 游标让 SQL 这种面向集合的语言有了面向过
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    程开发的能力。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql_2" class="md-nav__link">
    在 SQL 中，游标是一种临时的数据库对象，可以指向存储在数据库表中的数据行指针。这里游标充当了
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    指针的作用，我们可以通过操作游标来对数据行进行操作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_5" class="md-nav__link">
    MySQL中游标可以在存储过程和函数中使用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#employees-15000" class="md-nav__link">
    比如，我们查询了 employees 数据表中工资高于 15000 的员工都有哪些：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#108" class="md-nav__link">
    这里我们就可以通过游标来操作数据行，如图所示此时游标所在的行是“108”的记录，我们也可以在结果
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    集上滚动游标，指向结果集中的任意一行。
  </a>
  
    <nav class="md-nav" aria-label="集上滚动游标，指向结果集中的任意一行。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select_2" class="md-nav__link">
    SELECT '尚硅谷：让天下没有难学的技术';
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_6" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_37" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-2" class="md-nav__link">
    4. 2 使用游标步骤
  </a>
  
    <nav class="md-nav" aria-label="4. 2 使用游标步骤">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    游标必须在声明处理程序之前被声明，并且变量和条件还必须在声明游标或处理程序之前被声明。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbms" class="md-nav__link">
    如果我们想要使用游标，一般需要经历四个步骤。不同的 DBMS 中，使用游标的语法可能略有不同。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    第一步，声明游标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqldeclare" class="md-nav__link">
    在MySQL中，使用DECLARE关键字来声明游标，其语法的基本形式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlsql-serverdb2-mariadb-oracle-postgresql" class="md-nav__link">
    这个语法适用于 MySQL，SQL Server，DB2 和 MariaDB。如果是用 Oracle 或者 PostgreSQL，需要写成：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-select_statement" class="md-nav__link">
    要使用 SELECT 语句来获取数据结果集，而此时还没有开始遍历数据，这里 select_statement 代表的是
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select_3" class="md-nav__link">
    SELECT 语句，返回一个用于创建游标的结果集。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    比如：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    第二步，打开游标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    打开游标的语法如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select_4" class="md-nav__link">
    当我们定义好游标之后，如果想要使用游标，必须先打开游标。打开游标的时候 SELECT 语句的查询结
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    果集就会送到游标工作区，为后面游标的逐条读取结果集中的记录做准备。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    第三步，使用游标（从游标中取得数据）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    语法如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cursor_name-var_name" class="md-nav__link">
    这句的作用是使用 cursor_name 这个游标来读取当前行，并且将数据保存到 var_name 这个变量中，游
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#into" class="md-nav__link">
    标指针指到下一行。如果游标读取的数据行有多个列名，则在 INTO 关键字后面赋值给多个变量名即可。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#var_name" class="md-nav__link">
    注意：var_name必须在声明游标之前就定义好。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#into_1" class="md-nav__link">
    注意： 游标的查询结果集中的字段数，必须跟 INTO 后面的变量数一致 ，否则，在存储过程执行的时
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_6" class="md-nav__link">
    候，MySQL 会提示错误。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_82" class="md-nav__link">
    第四步，关闭游标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-close" class="md-nav__link">
    有 OPEN 就会有 CLOSE，也就是打开和关闭游标。当我们使用完游标后需要关闭掉该游标。因为游标会
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_83" class="md-nav__link">
    占用系统资源，如果不及时关闭， 游标会一直保持到存储过程结束 ，影响系统运行的效率。而关闭游标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_84" class="md-nav__link">
    的操作，会释放游标占用的系统资源。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_85" class="md-nav__link">
    关闭游标之后，我们就不能再检索查询结果中的数据行，如果需要检索只能再次打开游标。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-3" class="md-nav__link">
    4. 3 举例
  </a>
  
    <nav class="md-nav" aria-label="4. 3 举例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_count_by_limit_total_salaryin-limit_total_salarydouble" class="md-nav__link">
    创建存储过程“get_count_by_limit_total_salary()”，声明IN参数 limit_total_salary，DOUBLE类型；声明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outtotal_countint" class="md-nav__link">
    OUT参数total_count，INT类型。函数的功能可以实现累加薪资最高的几个员工的薪资值，直到薪资总和
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit_total_salarytotal_count" class="md-nav__link">
    达到limit_total_salary参数的值，返回累加的人数给total_count。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-5" class="md-nav__link">
    4. 5 小结
  </a>
  
    <nav class="md-nav" aria-label="4. 5 小结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql_7" class="md-nav__link">
    游标是 MySQL 的一个重要的功能，为逐条读取结果集中的数据，提供了完美的解决方案。跟在应用层
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_86" class="md-nav__link">
    面实现相同的功能相比，游标可以在存储程序中使用，效率高，程序也更加简洁。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_87" class="md-nav__link">
    但同时也会带来一些性能问题，比如在使用游标的过程中，会对数据行进行加锁，这样在业务并发量大
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_88" class="md-nav__link">
    的时候，不仅会影响业务之间的效率，还会消耗系统资源，造成内存不足，这是因为游标是在内存中进
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_89" class="md-nav__link">
    行的处理。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_90" class="md-nav__link">
    建议：养成用完之后就关闭的习惯，这样才能提高系统的整体效率。
  </a>
  
    <nav class="md-nav" aria-label="建议：养成用完之后就关闭的习惯，这样才能提高系统的整体效率。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_38" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin_3" class="md-nav__link">
    BEGIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat_3" class="md-nav__link">
    REPEAT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_91" class="md-nav__link">
    #使用游标（从游标中获取数据）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_7" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_39" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mysql-8-0" class="md-nav__link">
    补充：MySQL 8. 0 的新特性—全局变量的持久化
  </a>
  
    <nav class="md-nav" aria-label="补充：MySQL 8. 0 的新特性—全局变量的持久化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysqlset-global" class="md-nav__link">
    在MySQL数据库中，全局变量可以通过SET GLOBAL语句来设置。例如，设置服务器语句超时的限制，可
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max_execution_time" class="md-nav__link">
    以通过设置系统变量max_execution_time来实现：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-globalmysql" class="md-nav__link">
    使用SET GLOBAL语句设置的变量值只会临时生效。数据库重启后，服务器又会从MySQL配置文件中读取
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-80set-persist-1000" class="md-nav__link">
    变量的默认值。 MySQL 8.0版本新增了SET PERSIST命令。例如，设置服务器的最大连接数为 1000 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmysqld-autocnf" class="md-nav__link">
    MySQL会将该命令的配置保存到数据目录下的mysqld-auto.cnf文件中，下次启动时会读取该文件，用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_92" class="md-nav__link">
    其中的配置来覆盖默认的配置文件。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_93" class="md-nav__link">
    举例：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max_connections" class="md-nav__link">
    查看全局变量max_connections的值，结果如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max_connections_1" class="md-nav__link">
    设置全局变量max_connections的值：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmax_connections" class="md-nav__link">
    重启MySQL服务器，再次查询max_connections的值：
  </a>
  
    <nav class="md-nav" aria-label="重启MySQL服务器，再次查询max_connections的值：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-global-max_execution_time-2000" class="md-nav__link">
    SET GLOBAL MAX_EXECUTION_TIME= 2000 ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC17%E7%AB%A0_%E8%A7%A6%E5%8F%91%E5%99%A8/" class="md-nav__link">
        第17章_触发器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC18%E7%AB%A0_MySQL8%E5%85%B6%E5%AE%83%E6%96%B0%E7%89%B9%E6%80%A7/" class="md-nav__link">
        第18章_MySQL8其它新特性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%AC%AC19%E7%AB%A0_%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E/" class="md-nav__link">
        第19章_写在最后
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../..">关于</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          关于
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    讲师：尚硅谷-宋红康（江湖人称：康师傅）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#httpwwwatguigucom" class="md-nav__link">
    官网： http://www.atguigu.com
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 变量
  </a>
  
    <nav class="md-nav" aria-label="1. 变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    在MySQL数据库的存储过程和函数中，可以使用变量来存储查询或计算的中间结果数据，或者输出最终
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    的结果数据。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_1" class="md-nav__link">
    在 MySQL 数据库中，变量分为系统变量以及用户自定义变量。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-1" class="md-nav__link">
    1. 1 系统变量
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-1-1" class="md-nav__link">
    1. 1. 1 系统变量分类
  </a>
  
    <nav class="md-nav" aria-label="1. 1. 1 系统变量分类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysqlmysql" class="md-nav__link">
    变量由系统定义，不是用户定义，属于服务器层面。启动MySQL服务，生成MySQL服务实例期间，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmysqlmysql" class="md-nav__link">
    MySQL将为MySQL服务器内存中的系统变量赋值，这些系统变量定义了当前MySQL服务实例的属性、特
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmyini" class="md-nav__link">
    征。这些系统变量的值要么是编译MySQL时参数的默认值，要么是配置文件（例如my.ini等）中的参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httpsdevmysqlcomdocrefman80enserver-system-" class="md-nav__link">
    值。大家可以通过网址 https://dev.mysql.com/doc/refman/8.0/en/server-system-
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variableshtml-mysql" class="md-nav__link">
    variables.html 查看MySQL文档的系统变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-session" class="md-nav__link">
    系统变量分为全局系统变量（需要添加global 关键字）以及会话系统变量（需要添加 session 关键
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local" class="md-nav__link">
    字），有时也把全局系统变量简称为全局变量，有时也把会话系统变量称为local变量。 如果不写，默认
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-set" class="md-nav__link">
    会话级别。 静态变量（在 MySQL 服务实例运行期间它们的值不能使用 set 动态修改）属于特殊的全局系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    统变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmysqlmysql_1" class="md-nav__link">
    每一个MySQL客户机成功连接MySQL服务器后，都会产生与之对应的会话。会话期间，MySQL服务实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_2" class="md-nav__link">
    会在MySQL服务器内存中生成与该会话对应的会话系统变量，这些会话系统变量的初始值是全局系统变
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    量值的复制。如下图：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    全局系统变量针对于所有会话（连接）有效，但不能跨重启
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    会话系统变量仅针对于当前会话（连接）有效。会话期间，当前会话对某个会话系统变量值的修
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    改，不会影响其他会话同一个会话系统变量的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2" class="md-nav__link">
    会话 1 对某个全局系统变量值的修改会导致会话 2 中同一个全局系统变量值的修改。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-max_connections" class="md-nav__link">
    在MySQL中有些系统变量只能是全局的，例如 max_connections 用于限制服务器的最大连接数；有些系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#character_set_client" class="md-nav__link">
    统变量作用域既可以是全局又可以是会话，例如 character_set_client 用于设置客户端的字符集；有些系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pseudo_thread_id-mysql-id" class="md-nav__link">
    统变量的作用域只能是当前会话，例如 pseudo_thread_id 用于标记当前会话的 MySQL 连接 ID。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-1-2" class="md-nav__link">
    1. 1. 2 查看系统变量
  </a>
  
    <nav class="md-nav" aria-label="1. 1. 2 查看系统变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    查看所有或部分系统变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    举例：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    查看指定系统变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-mysql-global" class="md-nav__link">
    作为 MySQL 编码规范，MySQL 中的系统变量以两个“@”开头，其中“@@global”仅用于标记全局系统变
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session" class="md-nav__link">
    量，“@@session”仅用于标记会话系统变量。“@@”首先标记会话系统变量，如果会话系统变量不存在，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    则标记全局系统变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    修改系统变量的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_3" class="md-nav__link">
    有些时候，数据库管理员需要修改系统变量的默认值，以便修改当前会话或者MySQL服务实例的属性、
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    特征。具体方法：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-mysqlmysqlmysql" class="md-nav__link">
    方式 1 ：修改MySQL配置文件，继而修改MySQL系统变量的值（该方法需要重启MySQL服务）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mysqlset" class="md-nav__link">
    方式 2 ：在MySQL服务运行期间，使用“set”命令重新设置系统变量的值
  </a>
  
    <nav class="md-nav" aria-label="方式 2 ：在MySQL服务运行期间，使用“set”命令重新设置系统变量的值">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    #查看所有全局变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-global-variables" class="md-nav__link">
    SHOW GLOBAL VARIABLES;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    #查看所有会话变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-session-variables" class="md-nav__link">
    SHOW SESSION VARIABLES;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    或
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-variables" class="md-nav__link">
    SHOW VARIABLES;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    #查看满足条件的部分系统变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-global-variables-like" class="md-nav__link">
    SHOW GLOBAL VARIABLES LIKE '%标识符%';
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    #查看满足条件的部分会话变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-session-variables-like" class="md-nav__link">
    SHOW SESSION VARIABLES LIKE '%标识符%';
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    #查看指定的系统变量的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    #查看指定的会话变量的值
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    举例：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2_1" class="md-nav__link">
    1. 2 用户变量
  </a>
  
    <nav class="md-nav" aria-label="1. 2 用户变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-2-1" class="md-nav__link">
    1. 2. 1 用户变量分类
  </a>
  
    <nav class="md-nav" aria-label="1. 2. 1 用户变量分类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql-mysql" class="md-nav__link">
    用户变量是用户自己定义的，作为 MySQL 编码规范，MySQL 中的用户变量以一个“@”开头。根据作用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    范围不同，又分为会话用户变量和局部变量。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    会话用户变量：作用域和会话变量一样，只对当前连接会话有效。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-end" class="md-nav__link">
    局部变量：只在 BEGIN 和 END 语句块中有效。局部变量只能在存储过程和函数中使用。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-2" class="md-nav__link">
    1. 2. 2 会话用户变量
  </a>
  
    <nav class="md-nav" aria-label="1. 2. 2 会话用户变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    变量的定义
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    查看用户变量的值 （查看、比较、运算等）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    举例
  </a>
  
    <nav class="md-nav" aria-label="举例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    #为某个系统变量赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    #方式 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    #为某个会话变量赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    #方式 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    #方式 1 ：“=”或“:=”
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    SET @用户变量 = 值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_1" class="md-nav__link">
    SET @用户变量 := 值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-into" class="md-nav__link">
    #方式 2 ：“:=” 或 INTO关键字
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-from" class="md-nav__link">
    SELECT @用户变量 := 表达式 [FROM 等子句];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-into-from" class="md-nav__link">
    SELECT 表达式 INTO @用户变量 [FROM 等子句];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    SELECT @用户变量
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-3" class="md-nav__link">
    1. 2. 3 局部变量
  </a>
  
    <nav class="md-nav" aria-label="1. 2. 3 局部变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declare" class="md-nav__link">
    定义：可以使用DECLARE语句定义一个局部变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-end_1" class="md-nav__link">
    作用域：仅仅在定义它的 BEGIN ... END 中有效
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-end_2" class="md-nav__link">
    位置：只能放在 BEGIN ... END 中，而且只能放在第一句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    1 .定义变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    举例：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 .变量赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    方式 1 ：一般用于赋简单的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    方式 2 ：一般用于赋表中的字段值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3 .使用变量 （查看、比较、运算等）
  </a>
  
    <nav class="md-nav" aria-label="3 .使用变量 （查看、比较、运算等）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#begin" class="md-nav__link">
    BEGIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    #声明局部变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare-1-default" class="md-nav__link">
    DECLARE 变量名 1 变量数据类型 [DEFAULT 变量默认值];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare-23-default" class="md-nav__link">
    DECLARE 变量名2,变量名3,... 变量数据类型 [DEFAULT 变量默认值];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    #为局部变量赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-1" class="md-nav__link">
    SET 变量名1 = 值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-into-2-from" class="md-nav__link">
    SELECT 值 INTO 变量名2 [FROM 子句];
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    #查看局部变量的值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-123" class="md-nav__link">
    SELECT 变量1,变量2,变量3;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end" class="md-nav__link">
    END
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_2" class="md-nav__link">
    SET 变量名=值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_3" class="md-nav__link">
    SET 变量名:=值;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-into-from_1" class="md-nav__link">
    SELECT 字段名或表达式 INTO 变量名 FROM 表;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select_1" class="md-nav__link">
    SELECT 局部变量名;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-employeesemployee_id-102-last_namesalary" class="md-nav__link">
    举例 1 ：声明局部变量，并分别赋值为employees表中employee_id为 102 的last_name和salary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    举例 2 ：声明两个变量，求和并打印 （分别使用会话用户变量、局部变量的方式实现）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-different_salaryinemp_id" class="md-nav__link">
    举例 3 ：创建存储过程“different_salary”查询某员工和他领导的薪资差距，并用IN参数emp_id接收员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idoutdif_salary" class="md-nav__link">
    id，用OUT参数dif_salary输出薪资差距结果。
  </a>
  
    <nav class="md-nav" aria-label="id，用OUT参数dif_salary输出薪资差距结果。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_1" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    #方式 1 ：使用用户变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    #方式 2 ：使用局部变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_2" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_3" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    #声明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_4" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-4" class="md-nav__link">
    1. 2. 4 对比会话用户变量与局部变量
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    2. 定义条件与处理程序
  </a>
  
    <nav class="md-nav" aria-label="2. 定义条件与处理程序">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    定义条件是事先定义程序执行过程中可能遇到的问题，处理程序定义了在遇到问题时应当采取的处理方
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    式，并且保证存储过程或函数在遇到警告或错误时能继续执行。这样可以增强存储程序处理问题的能
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    力，避免程序异常停止运行。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    说明：定义条件和处理程序在存储过程、存储函数中都是支持的。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-1" class="md-nav__link">
    2. 1 案例分析
  </a>
  
    <nav class="md-nav" aria-label="2. 1 案例分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updatedatanocondition" class="md-nav__link">
    案例分析： 创建一个名称为“UpdateDataNoCondition”的存储过程。代码如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    调用存储过程：
  </a>
  
    <nav class="md-nav" aria-label="调用存储过程：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#end_1" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_5" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    #调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    #查看
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    作用域 定义位置 语法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    会话用户变量 当前会话 会话的任何地方 加@符号，不用指定类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-end-begin-end" class="md-nav__link">
    局部变量 定义它的BEGIN END中 BEGIN END的第一句话 一般不用加@,需要指定类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_6" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_7" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#x-1-sql" class="md-nav__link">
    可以看到，此时@x变量的值为 1 。结合创建存储过程的SQL语句代码可以得出：在存储过程中未定义条件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlmysqlsql" class="md-nav__link">
    和处理程序，且当存储过程中执行的SQL语句报错时，MySQL数据库会抛出错误，并退出当前SQL逻辑，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    不再向下继续执行。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2" class="md-nav__link">
    2. 2 定义条件
  </a>
  
    <nav class="md-nav" aria-label="2. 2 定义条件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql_4" class="md-nav__link">
    定义条件就是给MySQL中的错误码命名，这有助于存储的程序代码更清晰。它将一个错误名字和指定的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare-handler" class="md-nav__link">
    错误条件关联起来。这个名字可以随后被用在定义处理程序的DECLARE HANDLER语句中。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare_1" class="md-nav__link">
    定义条件使用DECLARE语句，语法格式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    错误码的说明：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_error_codesqlstate_valuemysql" class="md-nav__link">
    MySQL_error_code和sqlstate_value都可以表示MySQL的错误。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_error_code" class="md-nav__link">
    MySQL_error_code是数值类型错误代码。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlstate_value-5" class="md-nav__link">
    sqlstate_value是长度为 5 的字符串类型错误代码。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-1418-hy000-1418-mysql_error_codehy000sqlstate_value" class="md-nav__link">
    例如，在ERROR 1418 (HY000)中， 1418 是MySQL_error_code，'HY000'是sqlstate_value。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-1142-42000-1142-mysql_error_code42000sqlstate_value" class="md-nav__link">
    例如，在ERROR 1142（ 42000 ）中， 1142 是MySQL_error_code，'42000'是sqlstate_value。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-field_not_be_nullmysqlerror-1048-23000" class="md-nav__link">
    举例 1 ： 定义“Field_Not_Be_NULL”错误名与MySQL中违反非空约束的错误类型是“ERROR 1048 (23000)”对
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    应。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-error-114842000command_not_allowed" class="md-nav__link">
    举例 2 ： 定义"ERROR 1148(42000)"错误，名称为command_not_allowed。
  </a>
  
    <nav class="md-nav" aria-label="举例 2 ： 定义"ERROR 1148(42000)"错误，名称为command_not_allowed。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declare-condition-for" class="md-nav__link">
    DECLARE 错误名称 CONDITION FOR 错误码（或错误条件）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3" class="md-nav__link">
    2. 3 定义处理程序
  </a>
  
    <nav class="md-nav" aria-label="2. 3 定义处理程序">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sqldeclare" class="md-nav__link">
    可以为SQL执行过程中发生的某种类型的错误定义特殊的处理程序。定义处理程序时，使用DECLARE语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    的语法如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-continueexitundo" class="md-nav__link">
    处理方式 ：处理方式有 3 个取值：CONTINUE、EXIT、UNDO。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    CONTINUE：表示遇到错误不处理，继续执行。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exit" class="md-nav__link">
    EXIT：表示遇到错误马上退出。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#undomysql" class="md-nav__link">
    UNDO：表示遇到错误后撤回之前的操作。MySQL中暂时不支持这样的操作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    错误类型 （即条件）可以有如下取值：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlstate-5-sqlstate_value" class="md-nav__link">
    SQLSTATE '字符串错误码'：表示长度为 5 的sqlstate_value类型的错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_error_code_1" class="md-nav__link">
    MySQL_error_code：匹配数值类型错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declare-condition" class="md-nav__link">
    错误名称：表示DECLARE ... CONDITION定义的错误条件名称。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlwarning-01-sqlstate" class="md-nav__link">
    SQLWARNING：匹配所有以 01 开头的SQLSTATE错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#not-found-02-sqlstate" class="md-nav__link">
    NOT FOUND：匹配所有以 02 开头的SQLSTATE错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlexceptionsqlwarningnot-foundsqlstate" class="md-nav__link">
    SQLEXCEPTION：匹配所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE错误代码；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    处理语句 ：如果出现上述条件之一，则采用对应的处理方式，并执行指定的处理语句。语句可以是
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-begin-end" class="md-nav__link">
    像“SET 变量 = 值”这样的简单语句，也可以是使用BEGIN ... END编写的复合语句。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    定义处理程序的几种方式，代码如下：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4" class="md-nav__link">
    2. 4 案例解决
  </a>
  
    <nav class="md-nav" aria-label="2. 4 案例解决">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sqlstate_valuemysql_error_code-1048" class="md-nav__link">
    在存储过程中，定义处理程序，捕获sqlstate_value值，当遇到MySQL_error_code值为 1048 时，执行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continueproc_value-1" class="md-nav__link">
    CONTINUE操作，并且将@proc_value的值设置为-1。
  </a>
  
    <nav class="md-nav" aria-label="CONTINUE操作，并且将@proc_value的值设置为-1。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declare-handler-for" class="md-nav__link">
    DECLARE 处理方式 HANDLER FOR 错误类型 处理语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    #方法 3 ：先定义条件，再调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-sqlwarning" class="md-nav__link">
    #方法 4 ：使用SQLWARNING
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-not-found" class="md-nav__link">
    #方法 5 ：使用NOT FOUND
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-sqlexception" class="md-nav__link">
    #方法 6 ：使用SQLEXCEPTION
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_8" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    调用过程：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    举例：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insertdatawithcondition" class="md-nav__link">
    创建一个名称为“InsertDataWithCondition”的存储过程，代码如下。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlstate_valuesqlstate_value-23000-exit" class="md-nav__link">
    在存储过程中，定义处理程序，捕获sqlstate_value值，当遇到sqlstate_value值为 23000 时，执行EXIT操
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proc_value-1" class="md-nav__link">
    作，并且将@proc_value的值设置为-1。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    调用存储过程：
  </a>
  
    <nav class="md-nav" aria-label="调用存储过程：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_9" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    #准备工作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_10" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_11" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    3. 流程控制
  </a>
  
    <nav class="md-nav" aria-label="3. 流程控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-sql" class="md-nav__link">
    解决复杂问题不可能通过一个 SQL 语句完成，我们需要执行多个 SQL 操作。流程控制语句的作用就是控
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    制存储过程中 SQL 语句的执行顺序，是我们完成复杂操作必不可少的一部分。只要是执行的程序，流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    就分为三大类：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    顺序结构：程序从上往下依次执行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    分支结构：程序按条件进行选择执行，从两条或多条路径中选择一条执行
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    循环结构：程序满足一定条件下，重复执行一组语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-3" class="md-nav__link">
    针对于MySQL 的流程控制语句主要有 3 类。注意：只能用于存储程序。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-case" class="md-nav__link">
    条件判断语句：IF 语句和 CASE 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loopwhile-repeat" class="md-nav__link">
    循环语句：LOOP、WHILE 和 REPEAT 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterate-leave" class="md-nav__link">
    跳转语句：ITERATE 和 LEAVE 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-1-if" class="md-nav__link">
    3. 1 分支结构之 IF
  </a>
  
    <nav class="md-nav" aria-label="3. 1 分支结构之 IF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if" class="md-nav__link">
    IF 语句的语法结构是：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#truefalse" class="md-nav__link">
    根据表达式的结果为TRUE或FALSE执行相应的语句。这里“[]”中的内容是可选的。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-begin-end" class="md-nav__link">
    特点：① 不同的表达式对应不同的操作 ② 使用在begin end中
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-update_salary_by_eid1inemp_id" class="md-nav__link">
    举例 2 ： 声明存储过程“update_salary_by_eid1”，定义IN参数emp_id，输入员工编号。判断该员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8000-5-500" class="md-nav__link">
    薪资如果低于 8000 元并且入职时间超过 5 年，就涨薪 500 元；否则就不变。
  </a>
  
    <nav class="md-nav" aria-label="薪资如果低于 8000 元并且入职时间超过 5 年，就涨薪 500 元；否则就不变。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-1-then-1" class="md-nav__link">
    IF 表达式 1 THEN 操作 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elseif-2-then-2" class="md-nav__link">
    [ELSEIF 表达式 2 THEN 操作2]......
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#else-n" class="md-nav__link">
    [ELSE 操作N]
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-if" class="md-nav__link">
    END IF
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-if_1" class="md-nav__link">
    END IF;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_12" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-update_salary_by_eid2inemp_id" class="md-nav__link">
    举例 3 ： 声明存储过程“update_salary_by_eid2”，定义IN参数emp_id，输入员工编号。判断该员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9000-5-500-100" class="md-nav__link">
    薪资如果低于 9000 元并且入职时间超过 5 年，就涨薪 500 元；否则就涨薪 100 元。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-update_salary_by_eid3inemp_id" class="md-nav__link">
    举例 4 ： 声明存储过程“update_salary_by_eid3”，定义IN参数emp_id，输入员工编号。判断该员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9000-9000-9000-10000" class="md-nav__link">
    薪资如果低于 9000 元，就更新薪资为 9000 元；薪资如果大于等于 9000 元且低于 10000 的，但是奖金
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#null001-100" class="md-nav__link">
    比例为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。
  </a>
  
    <nav class="md-nav" aria-label="比例为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_13" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_14" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_15" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_16" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-case" class="md-nav__link">
    3. 2 分支结构之 CASE
  </a>
  
    <nav class="md-nav" aria-label="3. 2 分支结构之 CASE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-1" class="md-nav__link">
    CASE 语句的语法结构 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-2" class="md-nav__link">
    CASE 语句的语法结构 2 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-1-val-1-2" class="md-nav__link">
    使用CASE流程控制语句的第 1 种格式，判断val值等于 1 、等于 2 ，或者两者都不等。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    举例 2 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-2-val-0-0-0" class="md-nav__link">
    使用CASE流程控制语句的第 2 种格式，判断val是否为空、小于 0 、大于 0 或者等于 0 。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-update_salary_by_eid4inemp_id" class="md-nav__link">
    举例 3 ： 声明存储过程“update_salary_by_eid4”，定义IN参数emp_id，输入员工编号。判断该员工
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9000-9000-9000-10000_1" class="md-nav__link">
    薪资如果低于 9000 元，就更新薪资为 9000 元；薪资大于等于 9000 元且低于 10000 的，但是奖金比例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#null001-100_1" class="md-nav__link">
    为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。
  </a>
  
    <nav class="md-nav" aria-label="为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_17" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case" class="md-nav__link">
    CASE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_18" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-update_salary_by_eid5inemp_id" class="md-nav__link">
    举例 4 ：声明存储过程update_salary_by_eid5，定义IN参数emp_id，输入员工编号。判断该员工的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0-50-1-100-2-200-3" class="md-nav__link">
    入职年限，如果是 0 年，薪资涨 50 ；如果是 1 年，薪资涨 100 ；如果是 2 年，薪资涨 200 ；如果是 3 年，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#300-4-400-500" class="md-nav__link">
    薪资涨 300 ；如果是 4 年，薪资涨 400 ；其他的涨薪 500 。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3-loop" class="md-nav__link">
    3. 3 循环结构之LOOP
  </a>
  
    <nav class="md-nav" aria-label="3. 3 循环结构之LOOP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#looploopleave" class="md-nav__link">
    LOOP循环语句用来重复执行某些语句。LOOP内的语句一直重复执行直到循环被退出（使用LEAVE子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    句），跳出循环过程。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop" class="md-nav__link">
    LOOP语句的基本格式如下：
  </a>
  
    <nav class="md-nav" aria-label="LOOP语句的基本格式如下：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case_1" class="md-nav__link">
    CASE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_19" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_20" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_21" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loop_labelloop" class="md-nav__link">
    其中，loop_label表示LOOP语句的标注名称，该参数可以省略。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loopid-10" class="md-nav__link">
    使用LOOP语句进行循环操作，id值小于 10 时将重复执行循环过程。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_6" class="md-nav__link">
    举例 2 ： 当市场环境变好时，公司为了奖励大家，决定给大家涨工资。声明存储过程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_salary_loopoutnum" class="md-nav__link">
    “update_salary_loop()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨为
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-12000" class="md-nav__link">
    原来的1.1倍。直到全公司的平均薪资达到 12000 结束。并统计循环次数。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-4-while" class="md-nav__link">
    3. 4 循环结构之WHILE
  </a>
  
    <nav class="md-nav" aria-label="3. 4 循环结构之WHILE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whilewhile" class="md-nav__link">
    WHILE语句创建一个带条件判断的循环过程。WHILE在执行语句执行时，先对指定的表达式进行判断，如
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#while" class="md-nav__link">
    果为真，就执行循环内的语句，否则退出循环。WHILE语句的基本格式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#while_labelwhilewhile" class="md-nav__link">
    while_label为WHILE语句的标注名称；如果循环条件结果为真，WHILE语句内的语句或语句群被执行，直
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    至循环条件为假，退出循环。
  </a>
  
    <nav class="md-nav" aria-label="至循环条件为假，退出循环。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_22" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_2" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_23" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_10" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whilei-10" class="md-nav__link">
    WHILE语句示例，i值小于 10 时，将重复执行循环过程，代码如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_7" class="md-nav__link">
    举例 2 ： 市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。声明存储过程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_salary_whileoutnum" class="md-nav__link">
    “update_salary_while()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家降薪，薪资降
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#90-5000" class="md-nav__link">
    为原来的90%。直到全公司的平均薪资达到 5000 结束。并统计循环次数。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-5-repeat" class="md-nav__link">
    3. 5 循环结构之REPEAT
  </a>
  
    <nav class="md-nav" aria-label="3. 5 循环结构之REPEAT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repeatwhilerepeat" class="md-nav__link">
    REPEAT语句创建一个带条件判断的循环过程。与WHILE循环不同的是，REPEAT 循环首先会执行一次循
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#until-end-repeat" class="md-nav__link">
    环，然后在 UNTIL 中进行表达式的判断，如果满足条件就退出，即 END REPEAT；如果条件不满足，则会
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    就继续执行循环，直到满足退出条件为止。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat" class="md-nav__link">
    REPEAT语句的基本格式如下：
  </a>
  
    <nav class="md-nav" aria-label="REPEAT语句的基本格式如下：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_24" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_25" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    #调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_26" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_3" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_27" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat_labelrepeatrepeat" class="md-nav__link">
    repeat_label为REPEAT语句的标注名称，该参数可以省略；REPEAT语句内的语句或语句群被重复，直至
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expr_condition" class="md-nav__link">
    expr_condition为真。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1_11" class="md-nav__link">
    举例 1 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_8" class="md-nav__link">
    举例 2 ： 当市场环境变好时，公司为了奖励大家，决定给大家涨工资。声明存储过程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update_salary_repeatoutnum" class="md-nav__link">
    “update_salary_repeat()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-13000" class="md-nav__link">
    为原来的1.15倍。直到全公司的平均薪资达到 13000 结束。并统计循环次数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    对比三种循环结构：
  </a>
  
    <nav class="md-nav" aria-label="对比三种循环结构：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_28" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat_1" class="md-nav__link">
    REPEAT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_29" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_30" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat_2" class="md-nav__link">
    REPEAT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_4" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_31" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-leaveiterate" class="md-nav__link">
    1 、这三种循环都可以省略名称，但如果循环中添加了循环控制语句（LEAVE或ITERATE）则必须添加名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-loop-while-repeat" class="md-nav__link">
    称。 2 、 LOOP：一般用于实现简单的"死"循环 WHILE：先判断后执行 REPEAT：先执行后判断，无条件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    至少执行一次
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-6-leave" class="md-nav__link">
    3. 6 跳转语句之LEAVE语句
  </a>
  
    <nav class="md-nav" aria-label="3. 6 跳转语句之LEAVE语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leave-begin-end" class="md-nav__link">
    LEAVE语句：可以用在循环语句内，或者以 BEGIN 和 END 包裹起来的程序体内，表示跳出循环或者跳出
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leave-break" class="md-nav__link">
    程序体的操作。如果你有面向过程的编程语言的使用经验，你可以把 LEAVE 理解为 break。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    基本格式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labelleavebegin-end" class="md-nav__link">
    其中，label参数表示循环的标志。LEAVE和BEGIN ... END或循环一起被使用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-leave_beginintinnumbeginend" class="md-nav__link">
    举例 1 ： 创建存储过程 “leave_begin()”，声明INT类型的IN参数num。给BEGIN...END加标记名，并在
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beginendifnum" class="md-nav__link">
    BEGIN...END中使用IF语句判断num参数的值。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num0leavebeginend" class="md-nav__link">
    如果num&lt;=0，则使用LEAVE语句退出BEGIN...END；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num1employees" class="md-nav__link">
    如果num=1，则查询“employees”表的平均薪资；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num2employees" class="md-nav__link">
    如果num=2，则查询“employees”表的最低薪资；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num2employees_1" class="md-nav__link">
    如果num&gt;2，则查询“employees”表的最高薪资。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ifemployees" class="md-nav__link">
    IF语句结束后查询“employees”表的总人数。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_9" class="md-nav__link">
    举例 2 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leave_while" class="md-nav__link">
    当市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。声明存储过程“leave_while()”，声明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outnumwhile90" class="md-nav__link">
    OUT参数num，输出循环次数，存储过程中使用WHILE循环给大家降低薪资为原来薪资的90%，直到全公
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10000" class="md-nav__link">
    司的平均薪资小于等于 10000 ，并统计循环次数。
  </a>
  
    <nav class="md-nav" aria-label="司的平均薪资小于等于 10000 ，并统计循环次数。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leave" class="md-nav__link">
    LEAVE 标记名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_32" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_33" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_34" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin_1" class="md-nav__link">
    BEGIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-7-iterate" class="md-nav__link">
    3. 7 跳转语句之ITERATE语句
  </a>
  
    <nav class="md-nav" aria-label="3. 7 跳转语句之ITERATE语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iteratelooprepeatwhile" class="md-nav__link">
    ITERATE语句：只能用在循环语句（LOOP、REPEAT和WHILE语句）内，表示重新开始循环，将执行顺序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterate-continue" class="md-nav__link">
    转到语句段开头处。如果你有面向过程的编程语言的使用经验，你可以把 ITERATE 理解为 continue，意
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    思为“再次循环”。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    语句基本格式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labeliterate" class="md-nav__link">
    label参数表示循环的标志。ITERATE语句必须跟在循环标志前面。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num-0-num-1" class="md-nav__link">
    举例： 定义局部变量num，初始值为 0 。循环结构中执行num + 1操作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num-10" class="md-nav__link">
    如果num &lt; 10，则继续执行循环；
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#num-15" class="md-nav__link">
    如果num &gt; 15，则退出循环结构；
  </a>
  
    <nav class="md-nav" aria-label="如果num &gt; 15，则退出循环结构；">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    #③ 循环体
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    #④ 迭代条件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-while" class="md-nav__link">
    END WHILE;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    #赋值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_5" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_35" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_36" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin_2" class="md-nav__link">
    BEGIN
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    4. 游标
  </a>
  
    <nav class="md-nav" aria-label="4. 游标">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-1" class="md-nav__link">
    4. 1 什么是游标（或光标）
  </a>
  
    <nav class="md-nav" aria-label="4. 1 什么是游标（或光标）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#where-having-limit" class="md-nav__link">
    虽然我们也可以通过筛选条件 WHERE 和 HAVING，或者是限定返回记录的关键字 LIMIT 返回一条记录，
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    但是，却无法在结果集中像指针一样，向前定位一条记录、向后定位一条记录，或者是随意定位到某一
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    条记录，并对记录的数据进行处理。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    这个时候，就可以用到游标。游标，提供了一种灵活的操作方式，让我们能够对结果集中的每一条记录
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql_1" class="md-nav__link">
    进行定位，并对指向的记录中的数据进行操作的数据结构。 游标让 SQL 这种面向集合的语言有了面向过
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    程开发的能力。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql_2" class="md-nav__link">
    在 SQL 中，游标是一种临时的数据库对象，可以指向存储在数据库表中的数据行指针。这里游标充当了
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    指针的作用，我们可以通过操作游标来对数据行进行操作。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_5" class="md-nav__link">
    MySQL中游标可以在存储过程和函数中使用。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#employees-15000" class="md-nav__link">
    比如，我们查询了 employees 数据表中工资高于 15000 的员工都有哪些：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#108" class="md-nav__link">
    这里我们就可以通过游标来操作数据行，如图所示此时游标所在的行是“108”的记录，我们也可以在结果
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    集上滚动游标，指向结果集中的任意一行。
  </a>
  
    <nav class="md-nav" aria-label="集上滚动游标，指向结果集中的任意一行。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select_2" class="md-nav__link">
    SELECT '尚硅谷：让天下没有难学的技术';
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_6" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_37" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-2" class="md-nav__link">
    4. 2 使用游标步骤
  </a>
  
    <nav class="md-nav" aria-label="4. 2 使用游标步骤">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    游标必须在声明处理程序之前被声明，并且变量和条件还必须在声明游标或处理程序之前被声明。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbms" class="md-nav__link">
    如果我们想要使用游标，一般需要经历四个步骤。不同的 DBMS 中，使用游标的语法可能略有不同。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    第一步，声明游标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqldeclare" class="md-nav__link">
    在MySQL中，使用DECLARE关键字来声明游标，其语法的基本形式如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlsql-serverdb2-mariadb-oracle-postgresql" class="md-nav__link">
    这个语法适用于 MySQL，SQL Server，DB2 和 MariaDB。如果是用 Oracle 或者 PostgreSQL，需要写成：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-select_statement" class="md-nav__link">
    要使用 SELECT 语句来获取数据结果集，而此时还没有开始遍历数据，这里 select_statement 代表的是
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select_3" class="md-nav__link">
    SELECT 语句，返回一个用于创建游标的结果集。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    比如：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    第二步，打开游标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    打开游标的语法如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select_4" class="md-nav__link">
    当我们定义好游标之后，如果想要使用游标，必须先打开游标。打开游标的时候 SELECT 语句的查询结
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    果集就会送到游标工作区，为后面游标的逐条读取结果集中的记录做准备。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    第三步，使用游标（从游标中取得数据）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    语法如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cursor_name-var_name" class="md-nav__link">
    这句的作用是使用 cursor_name 这个游标来读取当前行，并且将数据保存到 var_name 这个变量中，游
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#into" class="md-nav__link">
    标指针指到下一行。如果游标读取的数据行有多个列名，则在 INTO 关键字后面赋值给多个变量名即可。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#var_name" class="md-nav__link">
    注意：var_name必须在声明游标之前就定义好。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#into_1" class="md-nav__link">
    注意： 游标的查询结果集中的字段数，必须跟 INTO 后面的变量数一致 ，否则，在存储过程执行的时
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_6" class="md-nav__link">
    候，MySQL 会提示错误。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_82" class="md-nav__link">
    第四步，关闭游标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-close" class="md-nav__link">
    有 OPEN 就会有 CLOSE，也就是打开和关闭游标。当我们使用完游标后需要关闭掉该游标。因为游标会
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_83" class="md-nav__link">
    占用系统资源，如果不及时关闭， 游标会一直保持到存储过程结束 ，影响系统运行的效率。而关闭游标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_84" class="md-nav__link">
    的操作，会释放游标占用的系统资源。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_85" class="md-nav__link">
    关闭游标之后，我们就不能再检索查询结果中的数据行，如果需要检索只能再次打开游标。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-3" class="md-nav__link">
    4. 3 举例
  </a>
  
    <nav class="md-nav" aria-label="4. 3 举例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_count_by_limit_total_salaryin-limit_total_salarydouble" class="md-nav__link">
    创建存储过程“get_count_by_limit_total_salary()”，声明IN参数 limit_total_salary，DOUBLE类型；声明
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outtotal_countint" class="md-nav__link">
    OUT参数total_count，INT类型。函数的功能可以实现累加薪资最高的几个员工的薪资值，直到薪资总和
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit_total_salarytotal_count" class="md-nav__link">
    达到limit_total_salary参数的值，返回累加的人数给total_count。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-5" class="md-nav__link">
    4. 5 小结
  </a>
  
    <nav class="md-nav" aria-label="4. 5 小结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysql_7" class="md-nav__link">
    游标是 MySQL 的一个重要的功能，为逐条读取结果集中的数据，提供了完美的解决方案。跟在应用层
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_86" class="md-nav__link">
    面实现相同的功能相比，游标可以在存储程序中使用，效率高，程序也更加简洁。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_87" class="md-nav__link">
    但同时也会带来一些性能问题，比如在使用游标的过程中，会对数据行进行加锁，这样在业务并发量大
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_88" class="md-nav__link">
    的时候，不仅会影响业务之间的效率，还会消耗系统资源，造成内存不足，这是因为游标是在内存中进
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_89" class="md-nav__link">
    行的处理。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_90" class="md-nav__link">
    建议：养成用完之后就关闭的习惯，这样才能提高系统的整体效率。
  </a>
  
    <nav class="md-nav" aria-label="建议：养成用完之后就关闭的习惯，这样才能提高系统的整体效率。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delimiter_38" class="md-nav__link">
    DELIMITER //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin_3" class="md-nav__link">
    BEGIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeat_3" class="md-nav__link">
    REPEAT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_91" class="md-nav__link">
    #使用游标（从游标中获取数据）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end_7" class="md-nav__link">
    END //
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delimiter_39" class="md-nav__link">
    DELIMITER ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mysql-8-0" class="md-nav__link">
    补充：MySQL 8. 0 的新特性—全局变量的持久化
  </a>
  
    <nav class="md-nav" aria-label="补充：MySQL 8. 0 的新特性—全局变量的持久化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysqlset-global" class="md-nav__link">
    在MySQL数据库中，全局变量可以通过SET GLOBAL语句来设置。例如，设置服务器语句超时的限制，可
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max_execution_time" class="md-nav__link">
    以通过设置系统变量max_execution_time来实现：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-globalmysql" class="md-nav__link">
    使用SET GLOBAL语句设置的变量值只会临时生效。数据库重启后，服务器又会从MySQL配置文件中读取
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-80set-persist-1000" class="md-nav__link">
    变量的默认值。 MySQL 8.0版本新增了SET PERSIST命令。例如，设置服务器的最大连接数为 1000 ：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmysqld-autocnf" class="md-nav__link">
    MySQL会将该命令的配置保存到数据目录下的mysqld-auto.cnf文件中，下次启动时会读取该文件，用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_92" class="md-nav__link">
    其中的配置来覆盖默认的配置文件。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_93" class="md-nav__link">
    举例：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max_connections" class="md-nav__link">
    查看全局变量max_connections的值，结果如下：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max_connections_1" class="md-nav__link">
    设置全局变量max_connections的值：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlmax_connections" class="md-nav__link">
    重启MySQL服务器，再次查询max_connections的值：
  </a>
  
    <nav class="md-nav" aria-label="重启MySQL服务器，再次查询max_connections的值：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-global-max_execution_time-2000" class="md-nav__link">
    SET GLOBAL MAX_EXECUTION_TIME= 2000 ;
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  




<h1 id="16-_">第 16 章_变量、流程控制与游标<a class="headerlink" href="#16-_" title="Permanent link">&para;</a></h1>
<h5 id="-">讲师：尚硅谷-宋红康（江湖人称：康师傅）<a class="headerlink" href="#-" title="Permanent link">&para;</a></h5>
<h5 id="httpwwwatguigucom">官网： http://www.atguigu.com<a class="headerlink" href="#httpwwwatguigucom" title="Permanent link">&para;</a></h5>
<h2 id="1">1. 变量<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<h5 id="mysql">在MySQL数据库的存储过程和函数中，可以使用变量来存储查询或计算的中间结果数据，或者输出最终<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h5>
<h5 id="_1">的结果数据。<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h5>
<h5 id="mysql_1">在 MySQL 数据库中，变量分为系统变量以及用户自定义变量。<a class="headerlink" href="#mysql_1" title="Permanent link">&para;</a></h5>
<h2 id="1-1">1. 1 系统变量<a class="headerlink" href="#1-1" title="Permanent link">&para;</a></h2>
<h2 id="1-1-1">1. 1. 1 系统变量分类<a class="headerlink" href="#1-1-1" title="Permanent link">&para;</a></h2>
<h5 id="mysqlmysql">变量由系统定义，不是用户定义，属于服务器层面。启动MySQL服务，生成MySQL服务实例期间，<a class="headerlink" href="#mysqlmysql" title="Permanent link">&para;</a></h5>
<h5 id="mysqlmysqlmysql">MySQL将为MySQL服务器内存中的系统变量赋值，这些系统变量定义了当前MySQL服务实例的属性、特<a class="headerlink" href="#mysqlmysqlmysql" title="Permanent link">&para;</a></h5>
<h5 id="mysqlmyini">征。这些系统变量的值要么是编译MySQL时参数的默认值，要么是配置文件（例如my.ini等）中的参数<a class="headerlink" href="#mysqlmyini" title="Permanent link">&para;</a></h5>
<h5 id="httpsdevmysqlcomdocrefman80enserver-system-">值。大家可以通过网址 https://dev.mysql.com/doc/refman/8.0/en/server-system-<a class="headerlink" href="#httpsdevmysqlcomdocrefman80enserver-system-" title="Permanent link">&para;</a></h5>
<h5 id="variableshtml-mysql">variables.html 查看MySQL文档的系统变量。<a class="headerlink" href="#variableshtml-mysql" title="Permanent link">&para;</a></h5>
<h5 id="global-session">系统变量分为全局系统变量（需要添加global 关键字）以及会话系统变量（需要添加 session 关键<a class="headerlink" href="#global-session" title="Permanent link">&para;</a></h5>
<h5 id="local">字），有时也把全局系统变量简称为全局变量，有时也把会话系统变量称为local变量。 如果不写，默认<a class="headerlink" href="#local" title="Permanent link">&para;</a></h5>
<h5 id="mysql-set">会话级别。 静态变量（在 MySQL 服务实例运行期间它们的值不能使用 set 动态修改）属于特殊的全局系<a class="headerlink" href="#mysql-set" title="Permanent link">&para;</a></h5>
<h5 id="_2">统变量。<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h5>
<h5 id="mysqlmysqlmysql_1">每一个MySQL客户机成功连接MySQL服务器后，都会产生与之对应的会话。会话期间，MySQL服务实例<a class="headerlink" href="#mysqlmysqlmysql_1" title="Permanent link">&para;</a></h5>
<h5 id="mysql_2">会在MySQL服务器内存中生成与该会话对应的会话系统变量，这些会话系统变量的初始值是全局系统变<a class="headerlink" href="#mysql_2" title="Permanent link">&para;</a></h5>
<h5 id="_3">量值的复制。如下图：<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h5>
<h5 id="_4">全局系统变量针对于所有会话（连接）有效，但不能跨重启<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h5>
<h5 id="_5">会话系统变量仅针对于当前会话（连接）有效。会话期间，当前会话对某个会话系统变量值的修<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h5>
<h5 id="_6">改，不会影响其他会话同一个会话系统变量的值。<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h5>
<h5 id="1-2">会话 1 对某个全局系统变量值的修改会导致会话 2 中同一个全局系统变量值的修改。<a class="headerlink" href="#1-2" title="Permanent link">&para;</a></h5>
<h5 id="mysql-max_connections">在MySQL中有些系统变量只能是全局的，例如 max_connections 用于限制服务器的最大连接数；有些系<a class="headerlink" href="#mysql-max_connections" title="Permanent link">&para;</a></h5>
<h5 id="character_set_client">统变量作用域既可以是全局又可以是会话，例如 character_set_client 用于设置客户端的字符集；有些系<a class="headerlink" href="#character_set_client" title="Permanent link">&para;</a></h5>
<h5 id="pseudo_thread_id-mysql-id">统变量的作用域只能是当前会话，例如 pseudo_thread_id 用于标记当前会话的 MySQL 连接 ID。<a class="headerlink" href="#pseudo_thread_id-mysql-id" title="Permanent link">&para;</a></h5>
<h4 id="1-1-2">1. 1. 2 查看系统变量<a class="headerlink" href="#1-1-2" title="Permanent link">&para;</a></h4>
<h5 id="_7">查看所有或部分系统变量<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h5>
<h5 id="_8">举例：<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h5>
<h5 id="_9">查看指定系统变量<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h5>
<h5 id="mysql-mysql-global">作为 MySQL 编码规范，MySQL 中的系统变量以两个“@”开头，其中“@@global”仅用于标记全局系统变<a class="headerlink" href="#mysql-mysql-global" title="Permanent link">&para;</a></h5>
<h5 id="session">量，“@@session”仅用于标记会话系统变量。“@@”首先标记会话系统变量，如果会话系统变量不存在，<a class="headerlink" href="#session" title="Permanent link">&para;</a></h5>
<h5 id="_10">则标记全局系统变量。<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h5>
<h5 id="_11">修改系统变量的值<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h5>
<h5 id="mysql_3">有些时候，数据库管理员需要修改系统变量的默认值，以便修改当前会话或者MySQL服务实例的属性、<a class="headerlink" href="#mysql_3" title="Permanent link">&para;</a></h5>
<h5 id="_12">特征。具体方法：<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h5>
<h5 id="1-mysqlmysqlmysql">方式 1 ：修改MySQL配置文件，继而修改MySQL系统变量的值（该方法需要重启MySQL服务）<a class="headerlink" href="#1-mysqlmysqlmysql" title="Permanent link">&para;</a></h5>
<h5 id="2-mysqlset">方式 2 ：在MySQL服务运行期间，使用“set”命令重新设置系统变量的值<a class="headerlink" href="#2-mysqlset" title="Permanent link">&para;</a></h5>
<h6 id="_13">#查看所有全局变量<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h6>
<h6 id="show-global-variables">SHOW GLOBAL VARIABLES;<a class="headerlink" href="#show-global-variables" title="Permanent link">&para;</a></h6>
<h6 id="_14">#查看所有会话变量<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h6>
<h6 id="show-session-variables">SHOW SESSION VARIABLES;<a class="headerlink" href="#show-session-variables" title="Permanent link">&para;</a></h6>
<h6 id="_15">或<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h6>
<h6 id="show-variables">SHOW VARIABLES;<a class="headerlink" href="#show-variables" title="Permanent link">&para;</a></h6>
<h6 id="_16">#查看满足条件的部分系统变量。<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h6>
<h6 id="show-global-variables-like">SHOW GLOBAL VARIABLES LIKE '%标识符%';<a class="headerlink" href="#show-global-variables-like" title="Permanent link">&para;</a></h6>
<h6 id="_17">#查看满足条件的部分会话变量<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h6>
<h6 id="show-session-variables-like">SHOW SESSION VARIABLES LIKE '%标识符%';<a class="headerlink" href="#show-session-variables-like" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SHOW GLOBAL VARIABLES LIKE &#39;admin_%&#39;;
</code></pre></div>
<h6 id="_18">#查看指定的系统变量的值<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SELECT @@global.变量名;
</code></pre></div>
<h6 id="_19">#查看指定的会话变量的值<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SELECT @@session.变量名;
#或者
SELECT @@变量名;
</code></pre></div>
<h5 id="_20">举例：<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h5>
<h3 id="1-2_1">1. 2 用户变量<a class="headerlink" href="#1-2_1" title="Permanent link">&para;</a></h3>
<h4 id="1-2-1">1. 2. 1 用户变量分类<a class="headerlink" href="#1-2-1" title="Permanent link">&para;</a></h4>
<h5 id="mysql-mysql">用户变量是用户自己定义的，作为 MySQL 编码规范，MySQL 中的用户变量以一个“@”开头。根据作用<a class="headerlink" href="#mysql-mysql" title="Permanent link">&para;</a></h5>
<h5 id="_21">范围不同，又分为会话用户变量和局部变量。<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h5>
<h5 id="_22">会话用户变量：作用域和会话变量一样，只对当前连接会话有效。<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h5>
<h5 id="begin-end">局部变量：只在 BEGIN 和 END 语句块中有效。局部变量只能在存储过程和函数中使用。<a class="headerlink" href="#begin-end" title="Permanent link">&para;</a></h5>
<h4 id="1-2-2">1. 2. 2 会话用户变量<a class="headerlink" href="#1-2-2" title="Permanent link">&para;</a></h4>
<h5 id="_23">变量的定义<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h5>
<h5 id="_24">查看用户变量的值 （查看、比较、运算等）<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h5>
<h5 id="_25">举例<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h5>
<h6 id="_26">#为某个系统变量赋值<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h6>
<h6 id="1_1">#方式 1 ：<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SET @@global.变量名=变量值;
#方式 2 ：
SET GLOBAL 变量名=变量值;
</code></pre></div>
<h6 id="_27">#为某个会话变量赋值<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h6>
<h6 id="1_2">#方式 1 ：<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SET @@session.变量名=变量值;
#方式 2 ：
SET SESSION 变量名=变量值;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT @@global.autocommit;
SET GLOBAL autocommit= 0 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT @@session.tx_isolation;
SET @@session.tx_isolation=&#39;read-uncommitted&#39;;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET GLOBAL max_connections = 1000 ;
SELECT @@global.max_connections;
</code></pre></div>
<h6 id="1_3">#方式 1 ：“=”或“:=”<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h6>
<h6 id="set">SET @用户变量 = 值;<a class="headerlink" href="#set" title="Permanent link">&para;</a></h6>
<h6 id="set_1">SET @用户变量 := 值;<a class="headerlink" href="#set_1" title="Permanent link">&para;</a></h6>
<h6 id="2-into">#方式 2 ：“:=” 或 INTO关键字<a class="headerlink" href="#2-into" title="Permanent link">&para;</a></h6>
<h6 id="select-from">SELECT @用户变量 := 表达式 [FROM 等子句];<a class="headerlink" href="#select-from" title="Permanent link">&para;</a></h6>
<h6 id="select-into-from">SELECT 表达式 INTO @用户变量 [FROM 等子句];<a class="headerlink" href="#select-into-from" title="Permanent link">&para;</a></h6>
<h6 id="select">SELECT @用户变量<a class="headerlink" href="#select" title="Permanent link">&para;</a></h6>
<h4 id="1-2-3">1. 2. 3 局部变量<a class="headerlink" href="#1-2-3" title="Permanent link">&para;</a></h4>
<h5 id="declare">定义：可以使用DECLARE语句定义一个局部变量<a class="headerlink" href="#declare" title="Permanent link">&para;</a></h5>
<h5 id="begin-end_1">作用域：仅仅在定义它的 BEGIN ... END 中有效<a class="headerlink" href="#begin-end_1" title="Permanent link">&para;</a></h5>
<h5 id="begin-end_2">位置：只能放在 BEGIN ... END 中，而且只能放在第一句<a class="headerlink" href="#begin-end_2" title="Permanent link">&para;</a></h5>
<h5 id="1_4">1 .定义变量<a class="headerlink" href="#1_4" title="Permanent link">&para;</a></h5>
<h5 id="_28">举例：<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h5>
<h5 id="2">2 .变量赋值<a class="headerlink" href="#2" title="Permanent link">&para;</a></h5>
<h5 id="1_5">方式 1 ：一般用于赋简单的值<a class="headerlink" href="#1_5" title="Permanent link">&para;</a></h5>
<h5 id="2_1">方式 2 ：一般用于赋表中的字段值<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h5>
<h5 id="3">3 .使用变量 （查看、比较、运算等）<a class="headerlink" href="#3" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>SET @a = 1 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT @a;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT @num := COUNT(*) FROM employees;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT @num;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT AVG(salary) INTO @avgsalary FROM employees;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT @avgsalary;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT @big;  #查看某个未声明的变量时，将得到NULL值
</code></pre></div>
<h6 id="begin">BEGIN<a class="headerlink" href="#begin" title="Permanent link">&para;</a></h6>
<h6 id="_29">#声明局部变量<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h6>
<h6 id="declare-1-default">DECLARE 变量名 1 变量数据类型 [DEFAULT 变量默认值];<a class="headerlink" href="#declare-1-default" title="Permanent link">&para;</a></h6>
<h6 id="declare-23-default">DECLARE 变量名2,变量名3,... 变量数据类型 [DEFAULT 变量默认值];<a class="headerlink" href="#declare-23-default" title="Permanent link">&para;</a></h6>
<h6 id="_30">#为局部变量赋值<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h6>
<h6 id="set-1">SET 变量名1 = 值;<a class="headerlink" href="#set-1" title="Permanent link">&para;</a></h6>
<h6 id="select-into-2-from">SELECT 值 INTO 变量名2 [FROM 子句];<a class="headerlink" href="#select-into-2-from" title="Permanent link">&para;</a></h6>
<h6 id="_31">#查看局部变量的值<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h6>
<h6 id="select-123">SELECT 变量1,变量2,变量3;<a class="headerlink" href="#select-123" title="Permanent link">&para;</a></h6>
<h6 id="end">END<a class="headerlink" href="#end" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>DECLARE 变量名 类型 [default 值];  # 如果没有DEFAULT子句，初始值为NULL
</code></pre></div>
<div class="highlight"><pre><span></span><code>DECLARE myparam INT DEFAULT 100 ;
</code></pre></div>
<h6 id="set_2">SET 变量名=值;<a class="headerlink" href="#set_2" title="Permanent link">&para;</a></h6>
<h6 id="set_3">SET 变量名:=值;<a class="headerlink" href="#set_3" title="Permanent link">&para;</a></h6>
<h6 id="select-into-from_1">SELECT 字段名或表达式 INTO 变量名 FROM 表;<a class="headerlink" href="#select-into-from_1" title="Permanent link">&para;</a></h6>
<h6 id="select_1">SELECT 局部变量名;<a class="headerlink" href="#select_1" title="Permanent link">&para;</a></h6>
<h5 id="1-employeesemployee_id-102-last_namesalary">举例 1 ：声明局部变量，并分别赋值为employees表中employee_id为 102 的last_name和salary<a class="headerlink" href="#1-employeesemployee_id-102-last_namesalary" title="Permanent link">&para;</a></h5>
<h5 id="2_2">举例 2 ：声明两个变量，求和并打印 （分别使用会话用户变量、局部变量的方式实现）<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h5>
<h5 id="3-different_salaryinemp_id">举例 3 ：创建存储过程“different_salary”查询某员工和他领导的薪资差距，并用IN参数emp_id接收员工<a class="headerlink" href="#3-different_salaryinemp_id" title="Permanent link">&para;</a></h5>
<h5 id="idoutdif_salary">id，用OUT参数dif_salary输出薪资差距结果。<a class="headerlink" href="#idoutdif_salary" title="Permanent link">&para;</a></h5>
<h6 id="delimiter">DELIMITER //<a class="headerlink" href="#delimiter" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE set_value()
BEGIN
DECLARE emp_name VARCHAR( 25 );
DECLARE sal DOUBLE( 10 , 2 );
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT last_name,salary INTO emp_name,sal
FROM employees
WHERE employee_id = 102 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT emp_name,sal;
END //
</code></pre></div>
<h6 id="delimiter_1">DELIMITER ;<a class="headerlink" href="#delimiter_1" title="Permanent link">&para;</a></h6>
<h6 id="1_6">#方式 1 ：使用用户变量<a class="headerlink" href="#1_6" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SET @m= 1 ;
SET @n= 1 ;
SET @sum=@m+@n;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT @sum;
</code></pre></div>
<h6 id="2_3">#方式 2 ：使用局部变量<a class="headerlink" href="#2_3" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_2">DELIMITER //<a class="headerlink" href="#delimiter_2" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE add_value()
BEGIN
#局部变量
DECLARE m INT DEFAULT 1 ;
DECLARE n INT DEFAULT 3 ;
DECLARE SUM INT;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET SUM = m+n;
SELECT SUM;
END //
</code></pre></div>
<h6 id="delimiter_3">DELIMITER ;<a class="headerlink" href="#delimiter_3" title="Permanent link">&para;</a></h6>
<h6 id="_32">#声明<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_4">DELIMITER //<a class="headerlink" href="#delimiter_4" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE different_salary(IN emp_id INT,OUT dif_salary DOUBLE)
BEGIN
#声明局部变量
DECLARE emp_sal,mgr_sal DOUBLE DEFAULT 0.0;
DECLARE mgr_id INT;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT salary INTO emp_sal FROM employees WHERE employee_id = emp_id;
SELECT manager_id INTO mgr_id FROM employees WHERE employee_id = emp_id;
SELECT salary INTO mgr_sal FROM employees WHERE employee_id = mgr_id;
</code></pre></div>
<h4 id="1-2-4">1. 2. 4 对比会话用户变量与局部变量<a class="headerlink" href="#1-2-4" title="Permanent link">&para;</a></h4>
<h2 id="2_4">2. 定义条件与处理程序<a class="headerlink" href="#2_4" title="Permanent link">&para;</a></h2>
<h5 id="_33">定义条件是事先定义程序执行过程中可能遇到的问题，处理程序定义了在遇到问题时应当采取的处理方<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h5>
<h5 id="_34">式，并且保证存储过程或函数在遇到警告或错误时能继续执行。这样可以增强存储程序处理问题的能<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h5>
<h5 id="_35">力，避免程序异常停止运行。<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h5>
<h5 id="_36">说明：定义条件和处理程序在存储过程、存储函数中都是支持的。<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h5>
<h3 id="2-1">2. 1 案例分析<a class="headerlink" href="#2-1" title="Permanent link">&para;</a></h3>
<h5 id="updatedatanocondition">案例分析： 创建一个名称为“UpdateDataNoCondition”的存储过程。代码如下：<a class="headerlink" href="#updatedatanocondition" title="Permanent link">&para;</a></h5>
<h5 id="_37">调用存储过程：<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>SET dif_salary = mgr_sal - emp_sal;
</code></pre></div>
<h6 id="end_1">END //<a class="headerlink" href="#end_1" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_5">DELIMITER ;<a class="headerlink" href="#delimiter_5" title="Permanent link">&para;</a></h6>
<h6 id="_38">#调用<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SET @emp_id = 102 ;
CALL different_salary(@emp_id,@diff_sal);
</code></pre></div>
<h6 id="_39">#查看<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SELECT @diff_sal;
</code></pre></div>
<h6 id="_40">作用域 定义位置 语法<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h6>
<h6 id="_41">会话用户变量 当前会话 会话的任何地方 加@符号，不用指定类型<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h6>
<h6 id="begin-end-begin-end">局部变量 定义它的BEGIN END中 BEGIN END的第一句话 一般不用加@,需要指定类型<a class="headerlink" href="#begin-end-begin-end" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_6">DELIMITER //<a class="headerlink" href="#delimiter_6" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE UpdateDataNoCondition()
BEGIN
SET @x = 1 ;
UPDATE employees SET email = NULL WHERE last_name = &#39;Abel&#39;;
SET @x = 2 ;
UPDATE employees SET email = &#39;aabbel&#39; WHERE last_name = &#39;Abel&#39;;
SET @x = 3 ;
END //
</code></pre></div>
<h6 id="delimiter_7">DELIMITER ;<a class="headerlink" href="#delimiter_7" title="Permanent link">&para;</a></h6>
<h5 id="x-1-sql">可以看到，此时@x变量的值为 1 。结合创建存储过程的SQL语句代码可以得出：在存储过程中未定义条件<a class="headerlink" href="#x-1-sql" title="Permanent link">&para;</a></h5>
<h5 id="sqlmysqlsql">和处理程序，且当存储过程中执行的SQL语句报错时，MySQL数据库会抛出错误，并退出当前SQL逻辑，<a class="headerlink" href="#sqlmysqlsql" title="Permanent link">&para;</a></h5>
<h5 id="_42">不再向下继续执行。<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h5>
<h3 id="2-2">2. 2 定义条件<a class="headerlink" href="#2-2" title="Permanent link">&para;</a></h3>
<h5 id="mysql_4">定义条件就是给MySQL中的错误码命名，这有助于存储的程序代码更清晰。它将一个错误名字和指定的<a class="headerlink" href="#mysql_4" title="Permanent link">&para;</a></h5>
<h5 id="declare-handler">错误条件关联起来。这个名字可以随后被用在定义处理程序的DECLARE HANDLER语句中。<a class="headerlink" href="#declare-handler" title="Permanent link">&para;</a></h5>
<h5 id="declare_1">定义条件使用DECLARE语句，语法格式如下：<a class="headerlink" href="#declare_1" title="Permanent link">&para;</a></h5>
<h5 id="_43">错误码的说明：<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h5>
<h5 id="mysql_error_codesqlstate_valuemysql">MySQL_error_code和sqlstate_value都可以表示MySQL的错误。<a class="headerlink" href="#mysql_error_codesqlstate_valuemysql" title="Permanent link">&para;</a></h5>
<h5 id="mysql_error_code">MySQL_error_code是数值类型错误代码。<a class="headerlink" href="#mysql_error_code" title="Permanent link">&para;</a></h5>
<h5 id="sqlstate_value-5">sqlstate_value是长度为 5 的字符串类型错误代码。<a class="headerlink" href="#sqlstate_value-5" title="Permanent link">&para;</a></h5>
<h5 id="error-1418-hy000-1418-mysql_error_codehy000sqlstate_value">例如，在ERROR 1418 (HY000)中， 1418 是MySQL_error_code，'HY000'是sqlstate_value。<a class="headerlink" href="#error-1418-hy000-1418-mysql_error_codehy000sqlstate_value" title="Permanent link">&para;</a></h5>
<h5 id="error-1142-42000-1142-mysql_error_code42000sqlstate_value">例如，在ERROR 1142（ 42000 ）中， 1142 是MySQL_error_code，'42000'是sqlstate_value。<a class="headerlink" href="#error-1142-42000-1142-mysql_error_code42000sqlstate_value" title="Permanent link">&para;</a></h5>
<h5 id="1-field_not_be_nullmysqlerror-1048-23000">举例 1 ： 定义“Field_Not_Be_NULL”错误名与MySQL中违反非空约束的错误类型是“ERROR 1048 (23000)”对<a class="headerlink" href="#1-field_not_be_nullmysqlerror-1048-23000" title="Permanent link">&para;</a></h5>
<h5 id="_44">应。<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h5>
<h5 id="2-error-114842000command_not_allowed">举例 2 ： 定义"ERROR 1148(42000)"错误，名称为command_not_allowed。<a class="headerlink" href="#2-error-114842000command_not_allowed" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>mysql&gt; CALL UpdateDataNoCondition();
ERROR 1048 ( 23000 ): Column &#39;email&#39; cannot be null
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT @x;
+------+
| @x |
+------+
| 1 |
+------+
1 row in set (0.00 sec)
</code></pre></div>
<h6 id="declare-condition-for">DECLARE 错误名称 CONDITION FOR 错误码（或错误条件）<a class="headerlink" href="#declare-condition-for" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>#使用MySQL_error_code
DECLARE Field_Not_Be_NULL CONDITION FOR 1048 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>#使用sqlstate_value
DECLARE Field_Not_Be_NULL CONDITION FOR SQLSTATE &#39;23000&#39;;
</code></pre></div>
<div class="highlight"><pre><span></span><code>#使用MySQL_error_code
DECLARE command_not_allowed CONDITION FOR 1148 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>#使用sqlstate_value
DECLARE command_not_allowed CONDITION FOR SQLSTATE &#39;42000&#39;;
</code></pre></div>
<h3 id="2-3">2. 3 定义处理程序<a class="headerlink" href="#2-3" title="Permanent link">&para;</a></h3>
<h5 id="sqldeclare">可以为SQL执行过程中发生的某种类型的错误定义特殊的处理程序。定义处理程序时，使用DECLARE语句<a class="headerlink" href="#sqldeclare" title="Permanent link">&para;</a></h5>
<h5 id="_45">的语法如下：<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h5>
<h5 id="3-continueexitundo">处理方式 ：处理方式有 3 个取值：CONTINUE、EXIT、UNDO。<a class="headerlink" href="#3-continueexitundo" title="Permanent link">&para;</a></h5>
<h5 id="continue">CONTINUE：表示遇到错误不处理，继续执行。<a class="headerlink" href="#continue" title="Permanent link">&para;</a></h5>
<h5 id="exit">EXIT：表示遇到错误马上退出。<a class="headerlink" href="#exit" title="Permanent link">&para;</a></h5>
<h5 id="undomysql">UNDO：表示遇到错误后撤回之前的操作。MySQL中暂时不支持这样的操作。<a class="headerlink" href="#undomysql" title="Permanent link">&para;</a></h5>
<h5 id="_46">错误类型 （即条件）可以有如下取值：<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h5>
<h5 id="sqlstate-5-sqlstate_value">SQLSTATE '字符串错误码'：表示长度为 5 的sqlstate_value类型的错误代码；<a class="headerlink" href="#sqlstate-5-sqlstate_value" title="Permanent link">&para;</a></h5>
<h5 id="mysql_error_code_1">MySQL_error_code：匹配数值类型错误代码；<a class="headerlink" href="#mysql_error_code_1" title="Permanent link">&para;</a></h5>
<h5 id="declare-condition">错误名称：表示DECLARE ... CONDITION定义的错误条件名称。<a class="headerlink" href="#declare-condition" title="Permanent link">&para;</a></h5>
<h5 id="sqlwarning-01-sqlstate">SQLWARNING：匹配所有以 01 开头的SQLSTATE错误代码；<a class="headerlink" href="#sqlwarning-01-sqlstate" title="Permanent link">&para;</a></h5>
<h5 id="not-found-02-sqlstate">NOT FOUND：匹配所有以 02 开头的SQLSTATE错误代码；<a class="headerlink" href="#not-found-02-sqlstate" title="Permanent link">&para;</a></h5>
<h5 id="sqlexceptionsqlwarningnot-foundsqlstate">SQLEXCEPTION：匹配所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE错误代码；<a class="headerlink" href="#sqlexceptionsqlwarningnot-foundsqlstate" title="Permanent link">&para;</a></h5>
<h5 id="_47">处理语句 ：如果出现上述条件之一，则采用对应的处理方式，并执行指定的处理语句。语句可以是<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h5>
<h5 id="set-begin-end">像“SET 变量 = 值”这样的简单语句，也可以是使用BEGIN ... END编写的复合语句。<a class="headerlink" href="#set-begin-end" title="Permanent link">&para;</a></h5>
<h5 id="_48">定义处理程序的几种方式，代码如下：<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h5>
<h3 id="2-4">2. 4 案例解决<a class="headerlink" href="#2-4" title="Permanent link">&para;</a></h3>
<h5 id="sqlstate_valuemysql_error_code-1048">在存储过程中，定义处理程序，捕获sqlstate_value值，当遇到MySQL_error_code值为 1048 时，执行<a class="headerlink" href="#sqlstate_valuemysql_error_code-1048" title="Permanent link">&para;</a></h5>
<h5 id="continueproc_value-1">CONTINUE操作，并且将@proc_value的值设置为-1。<a class="headerlink" href="#continueproc_value-1" title="Permanent link">&para;</a></h5>
<h6 id="declare-handler-for">DECLARE 处理方式 HANDLER FOR 错误类型 处理语句<a class="headerlink" href="#declare-handler-for" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>#方法 1 ：捕获sqlstate_value
DECLARE CONTINUE HANDLER FOR SQLSTATE &#39;42S02&#39; SET @info = &#39;NO_SUCH_TABLE&#39;;
</code></pre></div>
<div class="highlight"><pre><span></span><code>#方法 2 ：捕获mysql_error_value
DECLARE CONTINUE HANDLER FOR 1146 SET @info = &#39;NO_SUCH_TABLE&#39;;
</code></pre></div>
<h6 id="3_1">#方法 3 ：先定义条件，再调用<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>DECLARE no_such_table CONDITION FOR 1146 ;
DECLARE CONTINUE HANDLER FOR NO_SUCH_TABLE SET @info = &#39;NO_SUCH_TABLE&#39;;
</code></pre></div>
<h6 id="4-sqlwarning">#方法 4 ：使用SQLWARNING<a class="headerlink" href="#4-sqlwarning" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>DECLARE EXIT HANDLER FOR SQLWARNING SET @info = &#39;ERROR&#39;;
</code></pre></div>
<h6 id="5-not-found">#方法 5 ：使用NOT FOUND<a class="headerlink" href="#5-not-found" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>DECLARE EXIT HANDLER FOR NOT FOUND SET @info = &#39;NO_SUCH_TABLE&#39;;
</code></pre></div>
<h6 id="6-sqlexception">#方法 6 ：使用SQLEXCEPTION<a class="headerlink" href="#6-sqlexception" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>DECLARE EXIT HANDLER FOR SQLEXCEPTION SET @info = &#39;ERROR&#39;;
</code></pre></div>
<h6 id="delimiter_8">DELIMITER //<a class="headerlink" href="#delimiter_8" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE UpdateDataNoCondition()
BEGIN
#定义处理程序
DECLARE CONTINUE HANDLER FOR 1048 SET @proc_value = - 1 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET @x = 1 ;
</code></pre></div>
<h5 id="_49">调用过程：<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h5>
<h5 id="_50">举例：<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h5>
<h5 id="insertdatawithcondition">创建一个名称为“InsertDataWithCondition”的存储过程，代码如下。<a class="headerlink" href="#insertdatawithcondition" title="Permanent link">&para;</a></h5>
<h5 id="sqlstate_valuesqlstate_value-23000-exit">在存储过程中，定义处理程序，捕获sqlstate_value值，当遇到sqlstate_value值为 23000 时，执行EXIT操<a class="headerlink" href="#sqlstate_valuesqlstate_value-23000-exit" title="Permanent link">&para;</a></h5>
<h5 id="proc_value-1">作，并且将@proc_value的值设置为-1。<a class="headerlink" href="#proc_value-1" title="Permanent link">&para;</a></h5>
<h5 id="_51">调用存储过程：<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>UPDATE employees SET email = NULL WHERE last_name = &#39;Abel&#39;;
SET @x = 2 ;
UPDATE employees SET email = &#39;aabbel&#39; WHERE last_name = &#39;Abel&#39;;
SET @x = 3 ;
END //
</code></pre></div>
<h6 id="delimiter_9">DELIMITER ;<a class="headerlink" href="#delimiter_9" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>mysql&gt; CALL UpdateDataWithCondition();
Query OK, 0 rows affected (0.01 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT @x,@proc_value;
+------+-------------+
| @x | @proc_value |
+------+-------------+
| 3 | - 1 |
+------+-------------+
1 row in set (0.00 sec)
</code></pre></div>
<h6 id="_52">#准备工作<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE TABLE departments
AS
SELECT * FROM atguigudb.`departments`;
</code></pre></div>
<div class="highlight"><pre><span></span><code>ALTER TABLE departments
ADD CONSTRAINT uk_dept_name UNIQUE(department_id);
</code></pre></div>
<h6 id="delimiter_10">DELIMITER //<a class="headerlink" href="#delimiter_10" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE InsertDataWithCondition()
BEGIN
DECLARE duplicate_entry CONDITION FOR SQLSTATE &#39;23000&#39; ;
DECLARE EXIT HANDLER FOR duplicate_entry SET @proc_value = - 1 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET @x = 1 ;
INSERT INTO departments(department_name) VALUES(&#39;测试&#39;);
SET @x = 2 ;
INSERT INTO departments(department_name) VALUES(&#39;测试&#39;);
SET @x = 3 ;
END //
</code></pre></div>
<h6 id="delimiter_11">DELIMITER ;<a class="headerlink" href="#delimiter_11" title="Permanent link">&para;</a></h6>
<h2 id="3_2">3. 流程控制<a class="headerlink" href="#3_2" title="Permanent link">&para;</a></h2>
<h5 id="sql-sql">解决复杂问题不可能通过一个 SQL 语句完成，我们需要执行多个 SQL 操作。流程控制语句的作用就是控<a class="headerlink" href="#sql-sql" title="Permanent link">&para;</a></h5>
<h5 id="sql">制存储过程中 SQL 语句的执行顺序，是我们完成复杂操作必不可少的一部分。只要是执行的程序，流程<a class="headerlink" href="#sql" title="Permanent link">&para;</a></h5>
<h5 id="_53">就分为三大类：<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h5>
<h5 id="_54">顺序结构：程序从上往下依次执行<a class="headerlink" href="#_54" title="Permanent link">&para;</a></h5>
<h5 id="_55">分支结构：程序按条件进行选择执行，从两条或多条路径中选择一条执行<a class="headerlink" href="#_55" title="Permanent link">&para;</a></h5>
<h5 id="_56">循环结构：程序满足一定条件下，重复执行一组语句<a class="headerlink" href="#_56" title="Permanent link">&para;</a></h5>
<h5 id="mysql-3">针对于MySQL 的流程控制语句主要有 3 类。注意：只能用于存储程序。<a class="headerlink" href="#mysql-3" title="Permanent link">&para;</a></h5>
<h5 id="if-case">条件判断语句：IF 语句和 CASE 语句<a class="headerlink" href="#if-case" title="Permanent link">&para;</a></h5>
<h5 id="loopwhile-repeat">循环语句：LOOP、WHILE 和 REPEAT 语句<a class="headerlink" href="#loopwhile-repeat" title="Permanent link">&para;</a></h5>
<h5 id="iterate-leave">跳转语句：ITERATE 和 LEAVE 语句<a class="headerlink" href="#iterate-leave" title="Permanent link">&para;</a></h5>
<h3 id="3-1-if">3. 1 分支结构之 IF<a class="headerlink" href="#3-1-if" title="Permanent link">&para;</a></h3>
<h5 id="if">IF 语句的语法结构是：<a class="headerlink" href="#if" title="Permanent link">&para;</a></h5>
<h5 id="truefalse">根据表达式的结果为TRUE或FALSE执行相应的语句。这里“[]”中的内容是可选的。<a class="headerlink" href="#truefalse" title="Permanent link">&para;</a></h5>
<h5 id="1-2-begin-end">特点：① 不同的表达式对应不同的操作 ② 使用在begin end中<a class="headerlink" href="#1-2-begin-end" title="Permanent link">&para;</a></h5>
<h5 id="1_7">举例 1 ：<a class="headerlink" href="#1_7" title="Permanent link">&para;</a></h5>
<h5 id="2-update_salary_by_eid1inemp_id">举例 2 ： 声明存储过程“update_salary_by_eid1”，定义IN参数emp_id，输入员工编号。判断该员工<a class="headerlink" href="#2-update_salary_by_eid1inemp_id" title="Permanent link">&para;</a></h5>
<h5 id="8000-5-500">薪资如果低于 8000 元并且入职时间超过 5 年，就涨薪 500 元；否则就不变。<a class="headerlink" href="#8000-5-500" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>mysql&gt; CALL InsertDataWithCondition();
Query OK, 0 rows affected (0.01 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; SELECT @x,@proc_value;
+------+-------------+
| @x | @proc_value |
+------+-------------+
| 2 | - 1 |
+------+-------------+
1 row in set (0.00 sec)
</code></pre></div>
<h6 id="if-1-then-1">IF 表达式 1 THEN 操作 1<a class="headerlink" href="#if-1-then-1" title="Permanent link">&para;</a></h6>
<h6 id="elseif-2-then-2">[ELSEIF 表达式 2 THEN 操作2]......<a class="headerlink" href="#elseif-2-then-2" title="Permanent link">&para;</a></h6>
<h6 id="else-n">[ELSE 操作N]<a class="headerlink" href="#else-n" title="Permanent link">&para;</a></h6>
<h6 id="end-if">END IF<a class="headerlink" href="#end-if" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>IF val IS NULL
THEN SELECT &#39;val is null&#39;;
ELSE SELECT &#39;val is not null&#39;;
</code></pre></div>
<h6 id="end-if_1">END IF;<a class="headerlink" href="#end-if_1" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_12">DELIMITER //<a class="headerlink" href="#delimiter_12" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE update_salary_by_eid1(IN emp_id INT)
BEGIN
</code></pre></div>
<h5 id="3-update_salary_by_eid2inemp_id">举例 3 ： 声明存储过程“update_salary_by_eid2”，定义IN参数emp_id，输入员工编号。判断该员工<a class="headerlink" href="#3-update_salary_by_eid2inemp_id" title="Permanent link">&para;</a></h5>
<h5 id="9000-5-500-100">薪资如果低于 9000 元并且入职时间超过 5 年，就涨薪 500 元；否则就涨薪 100 元。<a class="headerlink" href="#9000-5-500-100" title="Permanent link">&para;</a></h5>
<h5 id="4-update_salary_by_eid3inemp_id">举例 4 ： 声明存储过程“update_salary_by_eid3”，定义IN参数emp_id，输入员工编号。判断该员工<a class="headerlink" href="#4-update_salary_by_eid3inemp_id" title="Permanent link">&para;</a></h5>
<h5 id="9000-9000-9000-10000">薪资如果低于 9000 元，就更新薪资为 9000 元；薪资如果大于等于 9000 元且低于 10000 的，但是奖金<a class="headerlink" href="#9000-9000-9000-10000" title="Permanent link">&para;</a></h5>
<h5 id="null001-100">比例为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。<a class="headerlink" href="#null001-100" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>DECLARE emp_salary DOUBLE;
DECLARE hire_year DOUBLE;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT salary INTO emp_salary FROM employees WHERE employee_id = emp_id;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT DATEDIFF(CURDATE(),hire_date)/365 INTO hire_year
FROM employees WHERE employee_id = emp_id;
</code></pre></div>
<div class="highlight"><pre><span></span><code>IF emp_salary &lt; 8000 AND hire_year &gt; 5
THEN UPDATE employees SET salary = salary + 500 WHERE employee_id = emp_id;
END IF;
END //
</code></pre></div>
<h6 id="delimiter_13">DELIMITER ;<a class="headerlink" href="#delimiter_13" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_14">DELIMITER //<a class="headerlink" href="#delimiter_14" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE update_salary_by_eid2(IN emp_id INT)
BEGIN
DECLARE emp_salary DOUBLE;
DECLARE hire_year DOUBLE;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT salary INTO emp_salary FROM employees WHERE employee_id = emp_id;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT DATEDIFF(CURDATE(),hire_date)/365 INTO hire_year
FROM employees WHERE employee_id = emp_id;
</code></pre></div>
<div class="highlight"><pre><span></span><code>IF emp_salary &lt; 8000 AND hire_year &gt; 5
THEN UPDATE employees SET salary = salary + 500 WHERE employee_id =
emp_id;
ELSE
UPDATE employees SET salary = salary + 100 WHERE employee_id = emp_id;
END IF;
END //
</code></pre></div>
<h6 id="delimiter_15">DELIMITER ;<a class="headerlink" href="#delimiter_15" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_16">DELIMITER //<a class="headerlink" href="#delimiter_16" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE update_salary_by_eid3(IN emp_id INT)
BEGIN
DECLARE emp_salary DOUBLE;
DECLARE bonus DECIMAL( 3 , 2 );
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT salary INTO emp_salary FROM employees WHERE employee_id = emp_id;
SELECT commission_pct INTO bonus FROM employees WHERE employee_id = emp_id;
</code></pre></div>
<div class="highlight"><pre><span></span><code>IF emp_salary &lt; 9000
THEN UPDATE employees SET salary = 9000 WHERE employee_id = emp_id;
</code></pre></div>
<h3 id="3-2-case">3. 2 分支结构之 CASE<a class="headerlink" href="#3-2-case" title="Permanent link">&para;</a></h3>
<h5 id="case-1">CASE 语句的语法结构 1 ：<a class="headerlink" href="#case-1" title="Permanent link">&para;</a></h5>
<h5 id="case-2">CASE 语句的语法结构 2 ：<a class="headerlink" href="#case-2" title="Permanent link">&para;</a></h5>
<h5 id="1_8">举例 1 ：<a class="headerlink" href="#1_8" title="Permanent link">&para;</a></h5>
<h5 id="case-1-val-1-2">使用CASE流程控制语句的第 1 种格式，判断val值等于 1 、等于 2 ，或者两者都不等。<a class="headerlink" href="#case-1-val-1-2" title="Permanent link">&para;</a></h5>
<h5 id="2_5">举例 2 ：<a class="headerlink" href="#2_5" title="Permanent link">&para;</a></h5>
<h5 id="case-2-val-0-0-0">使用CASE流程控制语句的第 2 种格式，判断val是否为空、小于 0 、大于 0 或者等于 0 。<a class="headerlink" href="#case-2-val-0-0-0" title="Permanent link">&para;</a></h5>
<h5 id="3-update_salary_by_eid4inemp_id">举例 3 ： 声明存储过程“update_salary_by_eid4”，定义IN参数emp_id，输入员工编号。判断该员工<a class="headerlink" href="#3-update_salary_by_eid4inemp_id" title="Permanent link">&para;</a></h5>
<h5 id="9000-9000-9000-10000_1">薪资如果低于 9000 元，就更新薪资为 9000 元；薪资大于等于 9000 元且低于 10000 的，但是奖金比例<a class="headerlink" href="#9000-9000-9000-10000_1" title="Permanent link">&para;</a></h5>
<h5 id="null001-100_1">为NULL的，就更新奖金比例为0.01；其他的涨薪 100 元。<a class="headerlink" href="#null001-100_1" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>ELSEIF emp_salary &lt; 10000 AND bonus IS NULL
THEN UPDATE employees SET commission_pct = 0.01 WHERE employee_id =
emp_id;
ELSE
UPDATE employees SET salary = salary + 100 WHERE employee_id = emp_id;
END IF;
END //
</code></pre></div>
<h6 id="delimiter_17">DELIMITER ;<a class="headerlink" href="#delimiter_17" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>#情况一：类似于switch
CASE 表达式
WHEN 值 1 THEN 结果 1 或语句1(如果是语句，需要加分号)
WHEN 值 2 THEN 结果 2 或语句2(如果是语句，需要加分号)
...
ELSE 结果n或语句n(如果是语句，需要加分号)
END [case]（如果是放在begin end中需要加上case，如果放在select后面不需要）
</code></pre></div>
<div class="highlight"><pre><span></span><code>#情况二：类似于多重if
CASE
WHEN 条件 1 THEN 结果 1 或语句1(如果是语句，需要加分号)
WHEN 条件 2 THEN 结果 2 或语句2(如果是语句，需要加分号)
...
ELSE 结果n或语句n(如果是语句，需要加分号)
END [case]（如果是放在begin end中需要加上case，如果放在select后面不需要）
</code></pre></div>
<div class="highlight"><pre><span></span><code>CASE val
WHEN 1 THEN SELECT &#39;val is 1&#39;;
WHEN 2 THEN SELECT &#39;val is 2&#39;;
ELSE SELECT &#39;val is not 1 or 2&#39;;
END CASE;
</code></pre></div>
<h6 id="case">CASE<a class="headerlink" href="#case" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>WHEN val IS NULL THEN SELECT &#39;val is null&#39;;
WHEN val &lt; 0 THEN SELECT &#39;val is less than 0&#39;;
WHEN val &gt; 0 THEN SELECT &#39;val is greater than 0&#39;;
ELSE SELECT &#39;val is 0&#39;;
END CASE;
</code></pre></div>
<h6 id="delimiter_18">DELIMITER //<a class="headerlink" href="#delimiter_18" title="Permanent link">&para;</a></h6>
<h5 id="4-update_salary_by_eid5inemp_id">举例 4 ：声明存储过程update_salary_by_eid5，定义IN参数emp_id，输入员工编号。判断该员工的<a class="headerlink" href="#4-update_salary_by_eid5inemp_id" title="Permanent link">&para;</a></h5>
<h5 id="0-50-1-100-2-200-3">入职年限，如果是 0 年，薪资涨 50 ；如果是 1 年，薪资涨 100 ；如果是 2 年，薪资涨 200 ；如果是 3 年，<a class="headerlink" href="#0-50-1-100-2-200-3" title="Permanent link">&para;</a></h5>
<h5 id="300-4-400-500">薪资涨 300 ；如果是 4 年，薪资涨 400 ；其他的涨薪 500 。<a class="headerlink" href="#300-4-400-500" title="Permanent link">&para;</a></h5>
<h3 id="3-3-loop">3. 3 循环结构之LOOP<a class="headerlink" href="#3-3-loop" title="Permanent link">&para;</a></h3>
<h5 id="looploopleave">LOOP循环语句用来重复执行某些语句。LOOP内的语句一直重复执行直到循环被退出（使用LEAVE子<a class="headerlink" href="#looploopleave" title="Permanent link">&para;</a></h5>
<h5 id="_57">句），跳出循环过程。<a class="headerlink" href="#_57" title="Permanent link">&para;</a></h5>
<h5 id="loop">LOOP语句的基本格式如下：<a class="headerlink" href="#loop" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE update_salary_by_eid4(IN emp_id INT)
BEGIN
DECLARE emp_sal DOUBLE;
DECLARE bonus DECIMAL( 3 , 2 );
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT salary INTO emp_sal FROM employees WHERE employee_id = emp_id;
SELECT commission_pct INTO bonus FROM employees WHERE employee_id = emp_id;
</code></pre></div>
<h6 id="case_1">CASE<a class="headerlink" href="#case_1" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>WHEN emp_sal&lt; 9000
THEN UPDATE employees SET salary= 9000 WHERE employee_id = emp_id;
WHEN emp_sal&lt; 10000 AND bonus IS NULL
THEN UPDATE employees SET commission_pct=0.01 WHERE employee_id = emp_id;
ELSE
UPDATE employees SET salary=salary+ 100 WHERE employee_id = emp_id;
END CASE;
END //
</code></pre></div>
<h6 id="delimiter_19">DELIMITER ;<a class="headerlink" href="#delimiter_19" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_20">DELIMITER //<a class="headerlink" href="#delimiter_20" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE update_salary_by_eid5(IN emp_id INT)
BEGIN
DECLARE emp_sal DOUBLE;
DECLARE hire_year DOUBLE;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT salary INTO emp_sal FROM employees WHERE employee_id = emp_id;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT ROUND(DATEDIFF(CURDATE(),hire_date)/365) INTO hire_year FROM employees
WHERE employee_id = emp_id;
</code></pre></div>
<div class="highlight"><pre><span></span><code>CASE hire_year
WHEN 0 THEN UPDATE employees SET salary=salary+ 50 WHERE employee_id = emp_id;
WHEN 1 THEN UPDATE employees SET salary=salary+ 100 WHERE employee_id = emp_id;
WHEN 2 THEN UPDATE employees SET salary=salary+ 200 WHERE employee_id = emp_id;
WHEN 3 THEN UPDATE employees SET salary=salary+ 300 WHERE employee_id = emp_id;
WHEN 4 THEN UPDATE employees SET salary=salary+ 400 WHERE employee_id = emp_id;
ELSE UPDATE employees SET salary=salary+ 500 WHERE employee_id = emp_id;
END CASE;
END //
</code></pre></div>
<h6 id="delimiter_21">DELIMITER ;<a class="headerlink" href="#delimiter_21" title="Permanent link">&para;</a></h6>
<h5 id="loop_labelloop">其中，loop_label表示LOOP语句的标注名称，该参数可以省略。<a class="headerlink" href="#loop_labelloop" title="Permanent link">&para;</a></h5>
<h5 id="1_9">举例 1 ：<a class="headerlink" href="#1_9" title="Permanent link">&para;</a></h5>
<h5 id="loopid-10">使用LOOP语句进行循环操作，id值小于 10 时将重复执行循环过程。<a class="headerlink" href="#loopid-10" title="Permanent link">&para;</a></h5>
<h5 id="2_6">举例 2 ： 当市场环境变好时，公司为了奖励大家，决定给大家涨工资。声明存储过程<a class="headerlink" href="#2_6" title="Permanent link">&para;</a></h5>
<h5 id="update_salary_loopoutnum">“update_salary_loop()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨为<a class="headerlink" href="#update_salary_loopoutnum" title="Permanent link">&para;</a></h5>
<h5 id="11-12000">原来的1.1倍。直到全公司的平均薪资达到 12000 结束。并统计循环次数。<a class="headerlink" href="#11-12000" title="Permanent link">&para;</a></h5>
<h3 id="3-4-while">3. 4 循环结构之WHILE<a class="headerlink" href="#3-4-while" title="Permanent link">&para;</a></h3>
<h5 id="whilewhile">WHILE语句创建一个带条件判断的循环过程。WHILE在执行语句执行时，先对指定的表达式进行判断，如<a class="headerlink" href="#whilewhile" title="Permanent link">&para;</a></h5>
<h5 id="while">果为真，就执行循环内的语句，否则退出循环。WHILE语句的基本格式如下：<a class="headerlink" href="#while" title="Permanent link">&para;</a></h5>
<h5 id="while_labelwhilewhile">while_label为WHILE语句的标注名称；如果循环条件结果为真，WHILE语句内的语句或语句群被执行，直<a class="headerlink" href="#while_labelwhilewhile" title="Permanent link">&para;</a></h5>
<h5 id="_58">至循环条件为假，退出循环。<a class="headerlink" href="#_58" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>[loop_label:] LOOP
循环执行的语句
END LOOP [loop_label]
</code></pre></div>
<div class="highlight"><pre><span></span><code>DECLARE id INT DEFAULT 0 ;
add_loop:LOOP
SET id = id + 1 ;
IF id &gt;= 10 THEN LEAVE add_loop;
END IF;
</code></pre></div>
<div class="highlight"><pre><span></span><code>END LOOP add_loop;
</code></pre></div>
<h6 id="delimiter_22">DELIMITER //<a class="headerlink" href="#delimiter_22" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE update_salary_loop(OUT num INT)
BEGIN
DECLARE avg_salary DOUBLE;
DECLARE loop_count INT DEFAULT 0 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT AVG(salary) INTO avg_salary FROM employees;
</code></pre></div>
<div class="highlight"><pre><span></span><code>label_loop:LOOP
IF avg_salary &gt;= 12000 THEN LEAVE label_loop;
END IF;
</code></pre></div>
<div class="highlight"><pre><span></span><code>UPDATE employees SET salary = salary * 1.1;
SET loop_count = loop_count + 1 ;
SELECT AVG(salary) INTO avg_salary FROM employees;
END LOOP label_loop;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET num = loop_count;
</code></pre></div>
<h6 id="end_2">END //<a class="headerlink" href="#end_2" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_23">DELIMITER ;<a class="headerlink" href="#delimiter_23" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>[while_label:] WHILE 循环条件 DO
循环体
END WHILE [while_label];
</code></pre></div>
<h5 id="1_10">举例 1 ：<a class="headerlink" href="#1_10" title="Permanent link">&para;</a></h5>
<h5 id="whilei-10">WHILE语句示例，i值小于 10 时，将重复执行循环过程，代码如下：<a class="headerlink" href="#whilei-10" title="Permanent link">&para;</a></h5>
<h5 id="2_7">举例 2 ： 市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。声明存储过程<a class="headerlink" href="#2_7" title="Permanent link">&para;</a></h5>
<h5 id="update_salary_whileoutnum">“update_salary_while()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家降薪，薪资降<a class="headerlink" href="#update_salary_whileoutnum" title="Permanent link">&para;</a></h5>
<h5 id="90-5000">为原来的90%。直到全公司的平均薪资达到 5000 结束。并统计循环次数。<a class="headerlink" href="#90-5000" title="Permanent link">&para;</a></h5>
<h3 id="3-5-repeat">3. 5 循环结构之REPEAT<a class="headerlink" href="#3-5-repeat" title="Permanent link">&para;</a></h3>
<h5 id="repeatwhilerepeat">REPEAT语句创建一个带条件判断的循环过程。与WHILE循环不同的是，REPEAT 循环首先会执行一次循<a class="headerlink" href="#repeatwhilerepeat" title="Permanent link">&para;</a></h5>
<h5 id="until-end-repeat">环，然后在 UNTIL 中进行表达式的判断，如果满足条件就退出，即 END REPEAT；如果条件不满足，则会<a class="headerlink" href="#until-end-repeat" title="Permanent link">&para;</a></h5>
<h5 id="_59">就继续执行循环，直到满足退出条件为止。<a class="headerlink" href="#_59" title="Permanent link">&para;</a></h5>
<h5 id="repeat">REPEAT语句的基本格式如下：<a class="headerlink" href="#repeat" title="Permanent link">&para;</a></h5>
<h6 id="delimiter_24">DELIMITER //<a class="headerlink" href="#delimiter_24" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE test_while()
BEGIN
DECLARE i INT DEFAULT 0 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>WHILE i &lt; 10 DO
SET i = i + 1 ;
END WHILE;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT i;
END //
</code></pre></div>
<h6 id="delimiter_25">DELIMITER ;<a class="headerlink" href="#delimiter_25" title="Permanent link">&para;</a></h6>
<h6 id="_60">#调用<a class="headerlink" href="#_60" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CALL test_while();
</code></pre></div>
<h6 id="delimiter_26">DELIMITER //<a class="headerlink" href="#delimiter_26" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE update_salary_while(OUT num INT)
BEGIN
DECLARE avg_sal DOUBLE ;
DECLARE while_count INT DEFAULT 0 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT AVG(salary) INTO avg_sal FROM employees;
</code></pre></div>
<div class="highlight"><pre><span></span><code>WHILE avg_sal &gt; 5000 DO
UPDATE employees SET salary = salary * 0.9;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET while_count = while_count + 1 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT AVG(salary) INTO avg_sal FROM employees;
END WHILE;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET num = while_count;
</code></pre></div>
<h6 id="end_3">END //<a class="headerlink" href="#end_3" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_27">DELIMITER ;<a class="headerlink" href="#delimiter_27" title="Permanent link">&para;</a></h6>
<h5 id="repeat_labelrepeatrepeat">repeat_label为REPEAT语句的标注名称，该参数可以省略；REPEAT语句内的语句或语句群被重复，直至<a class="headerlink" href="#repeat_labelrepeatrepeat" title="Permanent link">&para;</a></h5>
<h5 id="expr_condition">expr_condition为真。<a class="headerlink" href="#expr_condition" title="Permanent link">&para;</a></h5>
<h5 id="1_11">举例 1 ：<a class="headerlink" href="#1_11" title="Permanent link">&para;</a></h5>
<h5 id="2_8">举例 2 ： 当市场环境变好时，公司为了奖励大家，决定给大家涨工资。声明存储过程<a class="headerlink" href="#2_8" title="Permanent link">&para;</a></h5>
<h5 id="update_salary_repeatoutnum">“update_salary_repeat()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨<a class="headerlink" href="#update_salary_repeatoutnum" title="Permanent link">&para;</a></h5>
<h5 id="115-13000">为原来的1.15倍。直到全公司的平均薪资达到 13000 结束。并统计循环次数。<a class="headerlink" href="#115-13000" title="Permanent link">&para;</a></h5>
<h5 id="_61">对比三种循环结构：<a class="headerlink" href="#_61" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>[repeat_label:] REPEAT
　　　　循环体的语句
UNTIL 结束循环的条件表达式
END REPEAT [repeat_label]
</code></pre></div>
<h6 id="delimiter_28">DELIMITER //<a class="headerlink" href="#delimiter_28" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE test_repeat()
BEGIN
DECLARE i INT DEFAULT 0 ;
</code></pre></div>
<h6 id="repeat_1">REPEAT<a class="headerlink" href="#repeat_1" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SET i = i + 1 ;
UNTIL i &gt;= 10
END REPEAT;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT i;
END //
</code></pre></div>
<h6 id="delimiter_29">DELIMITER ;<a class="headerlink" href="#delimiter_29" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_30">DELIMITER //<a class="headerlink" href="#delimiter_30" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE update_salary_repeat(OUT num INT)
BEGIN
DECLARE avg_sal DOUBLE ;
DECLARE repeat_count INT DEFAULT 0 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT AVG(salary) INTO avg_sal FROM employees;
</code></pre></div>
<h6 id="repeat_2">REPEAT<a class="headerlink" href="#repeat_2" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>UPDATE employees SET salary = salary * 1.15;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET repeat_count = repeat_count + 1 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT AVG(salary) INTO avg_sal FROM employees;
UNTIL avg_sal &gt;= 13000
END REPEAT;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET num = repeat_count;
</code></pre></div>
<h6 id="end_4">END //<a class="headerlink" href="#end_4" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_31">DELIMITER ;<a class="headerlink" href="#delimiter_31" title="Permanent link">&para;</a></h6>
<h5 id="1-leaveiterate">1 、这三种循环都可以省略名称，但如果循环中添加了循环控制语句（LEAVE或ITERATE）则必须添加名<a class="headerlink" href="#1-leaveiterate" title="Permanent link">&para;</a></h5>
<h5 id="2-loop-while-repeat">称。 2 、 LOOP：一般用于实现简单的"死"循环 WHILE：先判断后执行 REPEAT：先执行后判断，无条件<a class="headerlink" href="#2-loop-while-repeat" title="Permanent link">&para;</a></h5>
<h5 id="_62">至少执行一次<a class="headerlink" href="#_62" title="Permanent link">&para;</a></h5>
<h3 id="3-6-leave">3. 6 跳转语句之LEAVE语句<a class="headerlink" href="#3-6-leave" title="Permanent link">&para;</a></h3>
<h5 id="leave-begin-end">LEAVE语句：可以用在循环语句内，或者以 BEGIN 和 END 包裹起来的程序体内，表示跳出循环或者跳出<a class="headerlink" href="#leave-begin-end" title="Permanent link">&para;</a></h5>
<h5 id="leave-break">程序体的操作。如果你有面向过程的编程语言的使用经验，你可以把 LEAVE 理解为 break。<a class="headerlink" href="#leave-break" title="Permanent link">&para;</a></h5>
<h5 id="_63">基本格式如下：<a class="headerlink" href="#_63" title="Permanent link">&para;</a></h5>
<h5 id="labelleavebegin-end">其中，label参数表示循环的标志。LEAVE和BEGIN ... END或循环一起被使用。<a class="headerlink" href="#labelleavebegin-end" title="Permanent link">&para;</a></h5>
<h5 id="1-leave_beginintinnumbeginend">举例 1 ： 创建存储过程 “leave_begin()”，声明INT类型的IN参数num。给BEGIN...END加标记名，并在<a class="headerlink" href="#1-leave_beginintinnumbeginend" title="Permanent link">&para;</a></h5>
<h5 id="beginendifnum">BEGIN...END中使用IF语句判断num参数的值。<a class="headerlink" href="#beginendifnum" title="Permanent link">&para;</a></h5>
<h5 id="num0leavebeginend">如果num&lt;=0，则使用LEAVE语句退出BEGIN...END；<a class="headerlink" href="#num0leavebeginend" title="Permanent link">&para;</a></h5>
<h5 id="num1employees">如果num=1，则查询“employees”表的平均薪资；<a class="headerlink" href="#num1employees" title="Permanent link">&para;</a></h5>
<h5 id="num2employees">如果num=2，则查询“employees”表的最低薪资；<a class="headerlink" href="#num2employees" title="Permanent link">&para;</a></h5>
<h5 id="num2employees_1">如果num&gt;2，则查询“employees”表的最高薪资。<a class="headerlink" href="#num2employees_1" title="Permanent link">&para;</a></h5>
<h5 id="ifemployees">IF语句结束后查询“employees”表的总人数。<a class="headerlink" href="#ifemployees" title="Permanent link">&para;</a></h5>
<h5 id="2_9">举例 2 ：<a class="headerlink" href="#2_9" title="Permanent link">&para;</a></h5>
<h5 id="leave_while">当市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。声明存储过程“leave_while()”，声明<a class="headerlink" href="#leave_while" title="Permanent link">&para;</a></h5>
<h5 id="outnumwhile90">OUT参数num，输出循环次数，存储过程中使用WHILE循环给大家降低薪资为原来薪资的90%，直到全公<a class="headerlink" href="#outnumwhile90" title="Permanent link">&para;</a></h5>
<h5 id="10000">司的平均薪资小于等于 10000 ，并统计循环次数。<a class="headerlink" href="#10000" title="Permanent link">&para;</a></h5>
<h6 id="leave">LEAVE 标记名<a class="headerlink" href="#leave" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_32">DELIMITER //<a class="headerlink" href="#delimiter_32" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE leave_begin(IN num INT)
</code></pre></div>
<div class="highlight"><pre><span></span><code>begin_label: BEGIN
IF num&lt;= 0
THEN LEAVE begin_label;
ELSEIF num= 1
THEN SELECT AVG(salary) FROM employees;
ELSEIF num= 2
THEN SELECT MIN(salary) FROM employees;
ELSE
SELECT MAX(salary) FROM employees;
END IF;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT COUNT(*) FROM employees;
END //
</code></pre></div>
<h6 id="delimiter_33">DELIMITER ;<a class="headerlink" href="#delimiter_33" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_34">DELIMITER //<a class="headerlink" href="#delimiter_34" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE leave_while(OUT num INT)
</code></pre></div>
<h6 id="begin_1">BEGIN<a class="headerlink" href="#begin_1" title="Permanent link">&para;</a></h6>
<h6 id="_64"><a class="headerlink" href="#_64" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>DECLARE avg_sal DOUBLE;#记录平均工资
</code></pre></div>
<h3 id="3-7-iterate">3. 7 跳转语句之ITERATE语句<a class="headerlink" href="#3-7-iterate" title="Permanent link">&para;</a></h3>
<h5 id="iteratelooprepeatwhile">ITERATE语句：只能用在循环语句（LOOP、REPEAT和WHILE语句）内，表示重新开始循环，将执行顺序<a class="headerlink" href="#iteratelooprepeatwhile" title="Permanent link">&para;</a></h5>
<h5 id="iterate-continue">转到语句段开头处。如果你有面向过程的编程语言的使用经验，你可以把 ITERATE 理解为 continue，意<a class="headerlink" href="#iterate-continue" title="Permanent link">&para;</a></h5>
<h5 id="_65">思为“再次循环”。<a class="headerlink" href="#_65" title="Permanent link">&para;</a></h5>
<h5 id="_66">语句基本格式如下：<a class="headerlink" href="#_66" title="Permanent link">&para;</a></h5>
<h5 id="labeliterate">label参数表示循环的标志。ITERATE语句必须跟在循环标志前面。<a class="headerlink" href="#labeliterate" title="Permanent link">&para;</a></h5>
<h5 id="num-0-num-1">举例： 定义局部变量num，初始值为 0 。循环结构中执行num + 1操作。<a class="headerlink" href="#num-0-num-1" title="Permanent link">&para;</a></h5>
<h5 id="num-10">如果num &lt; 10，则继续执行循环；<a class="headerlink" href="#num-10" title="Permanent link">&para;</a></h5>
<h5 id="num-15">如果num &gt; 15，则退出循环结构；<a class="headerlink" href="#num-15" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>DECLARE while_count INT DEFAULT 0 ; #记录循环次数
</code></pre></div>
<div class="highlight"><pre><span></span><code>SELECT AVG(salary) INTO avg_sal FROM employees; #① 初始化条件
</code></pre></div>
<div class="highlight"><pre><span></span><code>while_label:WHILE TRUE DO #② 循环条件
</code></pre></div>
<h6 id="3_3">#③ 循环体<a class="headerlink" href="#3_3" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>IF avg_sal &lt;= 10000 THEN
LEAVE while_label;
END IF;
</code></pre></div>
<div class="highlight"><pre><span></span><code>UPDATE employees SET salary = salary * 0.9;
SET while_count = while_count + 1 ;
</code></pre></div>
<h6 id="4">#④ 迭代条件<a class="headerlink" href="#4" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SELECT AVG(salary) INTO avg_sal FROM employees;
</code></pre></div>
<h6 id="end-while">END WHILE;<a class="headerlink" href="#end-while" title="Permanent link">&para;</a></h6>
<h6 id="_67">#赋值<a class="headerlink" href="#_67" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SET num = while_count;
</code></pre></div>
<h6 id="end_5">END //<a class="headerlink" href="#end_5" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_35">DELIMITER ;<a class="headerlink" href="#delimiter_35" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>ITERATE label
</code></pre></div>
<h6 id="delimiter_36">DELIMITER //<a class="headerlink" href="#delimiter_36" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE test_iterate()
</code></pre></div>
<h6 id="begin_2">BEGIN<a class="headerlink" href="#begin_2" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>DECLARE num INT DEFAULT 0 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>my_loop:LOOP
SET num = num + 1 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>IF num &lt; 10
THEN ITERATE my_loop;
ELSEIF num &gt; 15
</code></pre></div>
<h2 id="4_1">4. 游标<a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h2>
<h3 id="4-1">4. 1 什么是游标（或光标）<a class="headerlink" href="#4-1" title="Permanent link">&para;</a></h3>
<h5 id="where-having-limit">虽然我们也可以通过筛选条件 WHERE 和 HAVING，或者是限定返回记录的关键字 LIMIT 返回一条记录，<a class="headerlink" href="#where-having-limit" title="Permanent link">&para;</a></h5>
<h5 id="_68">但是，却无法在结果集中像指针一样，向前定位一条记录、向后定位一条记录，或者是随意定位到某一<a class="headerlink" href="#_68" title="Permanent link">&para;</a></h5>
<h5 id="_69">条记录，并对记录的数据进行处理。<a class="headerlink" href="#_69" title="Permanent link">&para;</a></h5>
<h5 id="_70">这个时候，就可以用到游标。游标，提供了一种灵活的操作方式，让我们能够对结果集中的每一条记录<a class="headerlink" href="#_70" title="Permanent link">&para;</a></h5>
<h5 id="sql_1">进行定位，并对指向的记录中的数据进行操作的数据结构。 游标让 SQL 这种面向集合的语言有了面向过<a class="headerlink" href="#sql_1" title="Permanent link">&para;</a></h5>
<h5 id="_71">程开发的能力。<a class="headerlink" href="#_71" title="Permanent link">&para;</a></h5>
<h5 id="sql_2">在 SQL 中，游标是一种临时的数据库对象，可以指向存储在数据库表中的数据行指针。这里游标充当了<a class="headerlink" href="#sql_2" title="Permanent link">&para;</a></h5>
<h5 id="_72">指针的作用，我们可以通过操作游标来对数据行进行操作。<a class="headerlink" href="#_72" title="Permanent link">&para;</a></h5>
<h5 id="mysql_5">MySQL中游标可以在存储过程和函数中使用。<a class="headerlink" href="#mysql_5" title="Permanent link">&para;</a></h5>
<h5 id="employees-15000">比如，我们查询了 employees 数据表中工资高于 15000 的员工都有哪些：<a class="headerlink" href="#employees-15000" title="Permanent link">&para;</a></h5>
<h5 id="108">这里我们就可以通过游标来操作数据行，如图所示此时游标所在的行是“108”的记录，我们也可以在结果<a class="headerlink" href="#108" title="Permanent link">&para;</a></h5>
<h5 id="_73">集上滚动游标，指向结果集中的任意一行。<a class="headerlink" href="#_73" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>THEN LEAVE my_loop;
END IF;
</code></pre></div>
<h6 id="select_2">SELECT '尚硅谷：让天下没有难学的技术';<a class="headerlink" href="#select_2" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>END LOOP my_loop;
</code></pre></div>
<h6 id="end_6">END //<a class="headerlink" href="#end_6" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_37">DELIMITER ;<a class="headerlink" href="#delimiter_37" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SELECT employee_id,last_name,salary FROM employees
WHERE salary &gt; 15000 ;
</code></pre></div>
<h3 id="4-2">4. 2 使用游标步骤<a class="headerlink" href="#4-2" title="Permanent link">&para;</a></h3>
<h5 id="_74">游标必须在声明处理程序之前被声明，并且变量和条件还必须在声明游标或处理程序之前被声明。<a class="headerlink" href="#_74" title="Permanent link">&para;</a></h5>
<h5 id="dbms">如果我们想要使用游标，一般需要经历四个步骤。不同的 DBMS 中，使用游标的语法可能略有不同。<a class="headerlink" href="#dbms" title="Permanent link">&para;</a></h5>
<h5 id="_75">第一步，声明游标<a class="headerlink" href="#_75" title="Permanent link">&para;</a></h5>
<h5 id="mysqldeclare">在MySQL中，使用DECLARE关键字来声明游标，其语法的基本形式如下：<a class="headerlink" href="#mysqldeclare" title="Permanent link">&para;</a></h5>
<h5 id="mysqlsql-serverdb2-mariadb-oracle-postgresql">这个语法适用于 MySQL，SQL Server，DB2 和 MariaDB。如果是用 Oracle 或者 PostgreSQL，需要写成：<a class="headerlink" href="#mysqlsql-serverdb2-mariadb-oracle-postgresql" title="Permanent link">&para;</a></h5>
<h5 id="select-select_statement">要使用 SELECT 语句来获取数据结果集，而此时还没有开始遍历数据，这里 select_statement 代表的是<a class="headerlink" href="#select-select_statement" title="Permanent link">&para;</a></h5>
<h5 id="select_3">SELECT 语句，返回一个用于创建游标的结果集。<a class="headerlink" href="#select_3" title="Permanent link">&para;</a></h5>
<h5 id="_76">比如：<a class="headerlink" href="#_76" title="Permanent link">&para;</a></h5>
<h5 id="_77">第二步，打开游标<a class="headerlink" href="#_77" title="Permanent link">&para;</a></h5>
<h5 id="_78">打开游标的语法如下：<a class="headerlink" href="#_78" title="Permanent link">&para;</a></h5>
<h5 id="select_4">当我们定义好游标之后，如果想要使用游标，必须先打开游标。打开游标的时候 SELECT 语句的查询结<a class="headerlink" href="#select_4" title="Permanent link">&para;</a></h5>
<h5 id="_79">果集就会送到游标工作区，为后面游标的逐条读取结果集中的记录做准备。<a class="headerlink" href="#_79" title="Permanent link">&para;</a></h5>
<h5 id="_80">第三步，使用游标（从游标中取得数据）<a class="headerlink" href="#_80" title="Permanent link">&para;</a></h5>
<h5 id="_81">语法如下：<a class="headerlink" href="#_81" title="Permanent link">&para;</a></h5>
<h5 id="cursor_name-var_name">这句的作用是使用 cursor_name 这个游标来读取当前行，并且将数据保存到 var_name 这个变量中，游<a class="headerlink" href="#cursor_name-var_name" title="Permanent link">&para;</a></h5>
<h5 id="into">标指针指到下一行。如果游标读取的数据行有多个列名，则在 INTO 关键字后面赋值给多个变量名即可。<a class="headerlink" href="#into" title="Permanent link">&para;</a></h5>
<h5 id="var_name">注意：var_name必须在声明游标之前就定义好。<a class="headerlink" href="#var_name" title="Permanent link">&para;</a></h5>
<h5 id="into_1">注意： 游标的查询结果集中的字段数，必须跟 INTO 后面的变量数一致 ，否则，在存储过程执行的时<a class="headerlink" href="#into_1" title="Permanent link">&para;</a></h5>
<h5 id="mysql_6">候，MySQL 会提示错误。<a class="headerlink" href="#mysql_6" title="Permanent link">&para;</a></h5>
<h5 id="_82">第四步，关闭游标<a class="headerlink" href="#_82" title="Permanent link">&para;</a></h5>
<h5 id="open-close">有 OPEN 就会有 CLOSE，也就是打开和关闭游标。当我们使用完游标后需要关闭掉该游标。因为游标会<a class="headerlink" href="#open-close" title="Permanent link">&para;</a></h5>
<h5 id="_83">占用系统资源，如果不及时关闭， 游标会一直保持到存储过程结束 ，影响系统运行的效率。而关闭游标<a class="headerlink" href="#_83" title="Permanent link">&para;</a></h5>
<h5 id="_84">的操作，会释放游标占用的系统资源。<a class="headerlink" href="#_84" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>DECLARE cursor_name CURSOR FOR select_statement;
</code></pre></div>
<div class="highlight"><pre><span></span><code>DECLARE cursor_name CURSOR IS select_statement;
</code></pre></div>
<div class="highlight"><pre><span></span><code>DECLARE cur_emp CURSOR FOR
SELECT employee_id,salary FROM employees;
</code></pre></div>
<div class="highlight"><pre><span></span><code>DECLARE cursor_fruit CURSOR FOR
SELECT f_name, f_price FROM fruits ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>OPEN cursor_name
</code></pre></div>
<div class="highlight"><pre><span></span><code>OPEN cur_emp ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>FETCH cursor_name INTO var_name [, var_name] ...
</code></pre></div>
<div class="highlight"><pre><span></span><code>FETCH cur_emp INTO emp_id, emp_sal ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>CLOSE cursor_name
</code></pre></div>
<h5 id="_85">关闭游标之后，我们就不能再检索查询结果中的数据行，如果需要检索只能再次打开游标。<a class="headerlink" href="#_85" title="Permanent link">&para;</a></h5>
<h3 id="4-3">4. 3 举例<a class="headerlink" href="#4-3" title="Permanent link">&para;</a></h3>
<h5 id="get_count_by_limit_total_salaryin-limit_total_salarydouble">创建存储过程“get_count_by_limit_total_salary()”，声明IN参数 limit_total_salary，DOUBLE类型；声明<a class="headerlink" href="#get_count_by_limit_total_salaryin-limit_total_salarydouble" title="Permanent link">&para;</a></h5>
<h5 id="outtotal_countint">OUT参数total_count，INT类型。函数的功能可以实现累加薪资最高的几个员工的薪资值，直到薪资总和<a class="headerlink" href="#outtotal_countint" title="Permanent link">&para;</a></h5>
<h5 id="limit_total_salarytotal_count">达到limit_total_salary参数的值，返回累加的人数给total_count。<a class="headerlink" href="#limit_total_salarytotal_count" title="Permanent link">&para;</a></h5>
<h3 id="4-5">4. 5 小结<a class="headerlink" href="#4-5" title="Permanent link">&para;</a></h3>
<h5 id="mysql_7">游标是 MySQL 的一个重要的功能，为逐条读取结果集中的数据，提供了完美的解决方案。跟在应用层<a class="headerlink" href="#mysql_7" title="Permanent link">&para;</a></h5>
<h5 id="_86">面实现相同的功能相比，游标可以在存储程序中使用，效率高，程序也更加简洁。<a class="headerlink" href="#_86" title="Permanent link">&para;</a></h5>
<h5 id="_87">但同时也会带来一些性能问题，比如在使用游标的过程中，会对数据行进行加锁，这样在业务并发量大<a class="headerlink" href="#_87" title="Permanent link">&para;</a></h5>
<h5 id="_88">的时候，不仅会影响业务之间的效率，还会消耗系统资源，造成内存不足，这是因为游标是在内存中进<a class="headerlink" href="#_88" title="Permanent link">&para;</a></h5>
<h5 id="_89">行的处理。<a class="headerlink" href="#_89" title="Permanent link">&para;</a></h5>
<h5 id="_90">建议：养成用完之后就关闭的习惯，这样才能提高系统的整体效率。<a class="headerlink" href="#_90" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>CLOSE cur_emp;
</code></pre></div>
<h6 id="delimiter_38">DELIMITER //<a class="headerlink" href="#delimiter_38" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>CREATE PROCEDURE get_count_by_limit_total_salary(IN limit_total_salary DOUBLE,OUT
total_count INT)
</code></pre></div>
<h6 id="begin_3">BEGIN<a class="headerlink" href="#begin_3" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>DECLARE sum_salary DOUBLE DEFAULT 0 ;  #记录累加的总工资
DECLARE cursor_salary DOUBLE DEFAULT 0 ; #记录某一个工资值
DECLARE emp_count INT DEFAULT 0 ; #记录循环个数
#定义游标
DECLARE emp_cursor CURSOR FOR SELECT salary FROM employees ORDER BY salary DESC;
#打开游标
OPEN emp_cursor;
</code></pre></div>
<h6 id="repeat_3">REPEAT<a class="headerlink" href="#repeat_3" title="Permanent link">&para;</a></h6>
<h6 id="_91">#使用游标（从游标中获取数据）<a class="headerlink" href="#_91" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>FETCH emp_cursor INTO cursor_salary;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET sum_salary = sum_salary + cursor_salary;
SET emp_count = emp_count + 1 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>UNTIL sum_salary &gt;= limit_total_salary
END REPEAT;
</code></pre></div>
<div class="highlight"><pre><span></span><code>SET total_count = emp_count;
#关闭游标
CLOSE emp_cursor;
</code></pre></div>
<h6 id="end_7">END //<a class="headerlink" href="#end_7" title="Permanent link">&para;</a></h6>
<h6 id="delimiter_39">DELIMITER ;<a class="headerlink" href="#delimiter_39" title="Permanent link">&para;</a></h6>
<h2 id="mysql-8-0">补充：MySQL 8. 0 的新特性—全局变量的持久化<a class="headerlink" href="#mysql-8-0" title="Permanent link">&para;</a></h2>
<h5 id="mysqlset-global">在MySQL数据库中，全局变量可以通过SET GLOBAL语句来设置。例如，设置服务器语句超时的限制，可<a class="headerlink" href="#mysqlset-global" title="Permanent link">&para;</a></h5>
<h5 id="max_execution_time">以通过设置系统变量max_execution_time来实现：<a class="headerlink" href="#max_execution_time" title="Permanent link">&para;</a></h5>
<h5 id="set-globalmysql">使用SET GLOBAL语句设置的变量值只会临时生效。数据库重启后，服务器又会从MySQL配置文件中读取<a class="headerlink" href="#set-globalmysql" title="Permanent link">&para;</a></h5>
<h5 id="mysql-80set-persist-1000">变量的默认值。 MySQL 8.0版本新增了SET PERSIST命令。例如，设置服务器的最大连接数为 1000 ：<a class="headerlink" href="#mysql-80set-persist-1000" title="Permanent link">&para;</a></h5>
<h5 id="mysqlmysqld-autocnf">MySQL会将该命令的配置保存到数据目录下的mysqld-auto.cnf文件中，下次启动时会读取该文件，用<a class="headerlink" href="#mysqlmysqld-autocnf" title="Permanent link">&para;</a></h5>
<h5 id="_92">其中的配置来覆盖默认的配置文件。<a class="headerlink" href="#_92" title="Permanent link">&para;</a></h5>
<h5 id="_93">举例：<a class="headerlink" href="#_93" title="Permanent link">&para;</a></h5>
<h5 id="max_connections">查看全局变量max_connections的值，结果如下：<a class="headerlink" href="#max_connections" title="Permanent link">&para;</a></h5>
<h5 id="max_connections_1">设置全局变量max_connections的值：<a class="headerlink" href="#max_connections_1" title="Permanent link">&para;</a></h5>
<h5 id="mysqlmax_connections">重启MySQL服务器，再次查询max_connections的值：<a class="headerlink" href="#mysqlmax_connections" title="Permanent link">&para;</a></h5>
<h6 id="set-global-max_execution_time-2000">SET GLOBAL MAX_EXECUTION_TIME= 2000 ;<a class="headerlink" href="#set-global-max_execution_time-2000" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code>SET PERSIST global max_connections = 1000 ;
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; show variables like &#39;%max_connections%&#39;;
+------------------------+-------+
| Variable_name | Value |
+------------------------+-------+
| max_connections | 151 |
| mysqlx_max_connections | 100 |
+------------------------+-------+
2 rows in set, 1 warning (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; set persist max_connections= 1000 ;
Query OK, 0 rows affected (0.00 sec)
</code></pre></div>
<div class="highlight"><pre><span></span><code>mysql&gt; show variables like &#39;%max_connections%&#39;;
+------------------------+-------+
| Variable_name | Value |
+------------------------+-------+
| max_connections | 1000 |
| mysqlx_max_connections | 100 |
+------------------------+-------+
2 rows in set, 1 warning (0.00 sec)
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "header.autohide"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../../../../mkdocs/javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>